<div class="coupon-section"><h3>Have a Coupon?</h3><div class="coupon-form"><input type="text" id="couponCode" placeholder="Enter coupon code"><button onclick="applyCoupon()">Apply</button></div><div id="couponMessage"></div>{% if request.session.applied_coupon %}<div class="applied-coupon"><span>Coupon: {{ request.session.applied_coupon.code }}</span><span class="discount">-{{ request.session.applied_coupon.discount_amount }} QAR</span><button onclick="removeCoupon()">Remove</button></div>{% endif %}</div>
<script>
function applyCoupon(){const code=document.getElementById('couponCode').value;fetch('{% url "promotions:apply_coupon" %}',{method:'POST',headers:{'X-CSRFToken':'{{ csrf_token }}','Content-Type':'application/x-www-form-urlencoded'},body:'coupon_code='+code}).then(r=>r.json()).then(data=>{if(data.success){location.reload();}else{alert(data.error);}});}
function removeCoupon(){fetch('{% url "promotions:remove_coupon" %}',{method:'POST',headers:{'X-CSRFToken':'{{ csrf_token }}'}}).then(()=>location.reload());}
</script>