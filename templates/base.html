{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html class="no-js" dir="ltr" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="IE=edge" http-equiv="X-UA-Compatible" />
  <meta content="width=device-width,initial-scale=1" name="viewport" />
  <link href="{% url 'home' %}" rel="canonical" />

  <title>{% block title %}Al Ameen Optics{% endblock %}</title>

  <meta property="og:site_name" content="Al Ameen Optics" />
  <meta property="og:title" content="Al Ameen Optics - Your Vision Matters More" />
  <meta property="og:type" content="website" />
  <meta name="description" content="Al Ameen Optics - Premium eyewear, sunglasses, contact lenses and eye care since 1927." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <!-- Theme CSS -->
  <link href="{% static 'cdn/shop/t/6/assets/xo-webcomponents.min.css' %}" media="all" rel="stylesheet" type="text/css">
  <link href="{% static 'cdn/shop/t/6/assets/main.css' %}" media="all" rel="stylesheet" type="text/css">

  <script defer src="{% static 'cdn/shop/t/6/assets/xo-webcomponents.min.js' %}"></script>
  <script defer src="{% static 'cdn/shop/t/6/assets/vendors.js' %}"></script>
  <script defer src="{% static 'cdn/shop/t/6/assets/main.js' %}"></script>

  <style>
    /* ============================================================
       CSS CUSTOM PROPERTIES â€” AL AMEEN OPTICS THEME
       ============================================================ */
    :root {
      --aa-white:        #ffffff;
      --aa-bg:           #eef3f8;
      --aa-bg-header:    #d8e6f0;
      --aa-bg-topbar:    #c9dcea;
      --aa-bg-nav:       #eef3f8;
      --aa-bg-footer:    #d8e6f0;
      --aa-dark:         #1a2a3a;
      --aa-mid:          #3a5068;
      --aa-accent:       #1a6fa8;
      --aa-accent-hover: #155f90;
      --aa-red:          #e03030;
      --aa-border:       #c5d8e8;
      --aa-radius:       8px;
      --aa-shadow:       0 2px 12px rgba(26,42,58,.10);
      --font-body:       'Jost', sans-serif;
      --font-display:    'Playfair Display', serif;

      --z-base:          1;
      --z-content:       10;
      --z-sticky:        100;
      --z-header:        10000;
      --z-modal-overlay: 50000;
      --z-modal:         50001;
      --z-mobile-menu:   20000;
      --z-toast:         99999;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 62.5%; scroll-behavior: smooth; }
    body {
      font-family: var(--font-body);
      font-size: 1.5rem;
      color: var(--aa-dark);
      background: var(--aa-bg);
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }
    a { text-decoration: none; color: inherit; }
    ul, ol { list-style: none; }
    img { display: block; max-width: 100%; }
    button { cursor: pointer; font-family: inherit; }

    /* Modals always above header */
    .modal, .aa-modal, [role="dialog"], .modal-overlay, .modal-backdrop,
    .fancybox-container, .swal2-container, .aa-quick-view-overlay {
      z-index: var(--z-modal-overlay) !important;
    }
    .modal-dialog, .aa-modal__inner, .modal-content, .aa-quick-view {
      z-index: var(--z-modal) !important;
    }

    /* â”€â”€ ANNOUNCEMENT BAR â”€â”€ */
    .aa-topbar {
      background: var(--aa-accent);
      color: #fff;
      text-align: center;
      padding: 8px 20px;
      font-size: 1.3rem;
      font-weight: 500;
      letter-spacing: .04em;
      position: relative;
      z-index: var(--z-sticky);
    }
    .aa-topbar a { color: #fff; text-decoration: underline; }
    .aa-topbar__close { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #fff; font-size: 1.6rem; line-height: 1; opacity: .8; }
    .aa-topbar__close:hover { opacity: 1; }

    /* â”€â”€ HEADER â”€â”€ */
    .aa-header-wrap {
      background: var(--aa-bg-header);
      border-bottom: 1px solid var(--aa-border);
      position: sticky;
      top: 0;
      z-index: var(--z-header);
      box-shadow: var(--aa-shadow);
    }
    .aa-header { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 20px; max-width: 1400px; margin: 0 auto; padding: 10px 24px; }
    .aa-header__left { display: flex; align-items: center; gap: 12px; }

    .aa-eyetest-btn { display: flex; align-items: center; gap: 8px; background: var(--aa-white); border: 1.5px solid var(--aa-border); border-radius: 50px; padding: 7px 14px 7px 8px; font-size: 1.1rem; font-weight: 700; color: var(--aa-dark); text-transform: uppercase; letter-spacing: .05em; transition: all .25s; white-space: nowrap; }
    .aa-eyetest-btn:hover { background: var(--aa-accent); border-color: var(--aa-accent); color: #fff; }
    .aa-eyetest-btn__avatar { width: 34px; height: 34px; border-radius: 50%; background: var(--aa-accent); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .aa-eyetest-btn__avatar svg { fill: #fff; }
    .aa-eyetest-btn__text { display: flex; flex-direction: column; line-height: 1.2; }
    .aa-eyetest-btn__sub { font-size: .9rem; font-weight: 400; opacity: .7; }

    .aa-header__logo { display: flex; justify-content: center; align-items: center; }
    .aa-header__logo a { display: flex; align-items: center; gap: 10px; }
    .aa-logo-img { height: 56px; width: auto; }
    .aa-logo-text { display: flex; flex-direction: column; align-items: center; line-height: 1.1; }
    .aa-logo-text__ar { font-family: var(--font-display); font-size: 2.2rem; font-weight: 700; color: var(--aa-accent); letter-spacing: .02em; }
    .aa-logo-text__en { font-size: 2rem; font-weight: 700; color: var(--aa-dark); letter-spacing: .08em; }
    .aa-logo-text__sub { font-size: 1rem; letter-spacing: .15em; color: var(--aa-mid); text-transform: uppercase; margin-top: 1px; }

    .aa-header__right { display: flex; align-items: center; gap: 6px; justify-content: flex-end; }

    .aa-header__icon-btn { position: relative; display: flex; align-items: center; justify-content: center; width: 42px; height: 42px; border-radius: 50%; border: none; background: transparent; color: var(--aa-dark); font-size: 2rem; transition: background .2s, color .2s; }
    .aa-header__icon-btn:hover { background: rgba(26,111,168,.1); color: var(--aa-accent); }

    .aa-header__badge {
      position: absolute;
      top: 2px;
      right: 2px;
      background: var(--aa-red);
      color: #fff;
      font-size: 1rem;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      border-radius: 9px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
      line-height: 1;
      transition: transform .3s cubic-bezier(.34,1.56,.64,1);
    }
    /* Hide badge when count is 0 */
    .aa-header__badge[data-count="0"] { display: none; }

    .aa-wishlist-pulse .bi-heart,
    .aa-wishlist-pulse .bi-heart-fill { animation: heartPulse .4s cubic-bezier(.34,1.56,.64,1); }
    @keyframes heartPulse { 0% { transform: scale(1); } 50% { transform: scale(1.4); } 100% { transform: scale(1); } }

    .aa-header__search { display: flex; align-items: center; background: var(--aa-white); border: 1.5px solid var(--aa-border); border-radius: 50px; overflow: hidden; height: 40px; flex: 1; max-width: 400px; transition: border-color .2s, box-shadow .2s; }
    .aa-header__search:focus-within { border-color: var(--aa-accent); box-shadow: 0 0 0 3px rgba(26,111,168,.12); }
    .aa-header__search input { flex: 1; border: none; outline: none; padding: 0 16px; font-family: var(--font-body); font-size: 1.4rem; color: var(--aa-dark); background: transparent; }
    .aa-header__search input::placeholder { color: #9ab; }
    .aa-header__search button { width: 44px; height: 100%; border: none; background: var(--aa-accent); color: #fff; font-size: 1.6rem; display: flex; align-items: center; justify-content: center; transition: background .2s; flex-shrink: 0; }
    .aa-header__search button:hover { background: var(--aa-accent-hover); }

    .aa-header__account-links { display: flex; align-items: center; gap: 4px; }
    .aa-header__account-links a { font-size: 1.3rem; font-weight: 500; color: var(--aa-mid); padding: 4px 8px; border-radius: 4px; white-space: nowrap; transition: color .2s; }
    .aa-header__account-links a:hover { color: var(--aa-accent); }
    .aa-header__account-links .divider { width: 1px; height: 16px; background: var(--aa-border); }

    /* â”€â”€ NAVIGATION â”€â”€ */
    .aa-nav-wrap { background: var(--aa-bg-nav); border-bottom: 1px solid var(--aa-border); }
    .aa-nav { max-width: 1400px; margin: 0 auto; padding: 0 24px; display: flex; align-items: center; gap: 0; }
    .aa-nav__list { display: flex; align-items: stretch; gap: 0; flex: 1; }
    .aa-nav__item { position: relative; }
    .aa-nav__link { display: flex; align-items: center; gap: 5px; padding: 14px 18px; font-size: 1.35rem; font-weight: 600; color: var(--aa-dark); letter-spacing: .03em; white-space: nowrap; border-bottom: 3px solid transparent; transition: color .2s, border-color .2s; text-transform: uppercase; }
    .aa-nav__link:hover, .aa-nav__link.active { color: var(--aa-accent); border-bottom-color: var(--aa-accent); }
    .aa-nav__link .bi-chevron-down { font-size: 1rem; transition: transform .2s; }
    .aa-nav__item:hover .aa-nav__link .bi-chevron-down { transform: rotate(180deg); }
    .aa-nav__sale-tag { background: var(--aa-red); color: #fff; font-size: 1rem; font-weight: 700; padding: 2px 6px; border-radius: 3px; margin-left: 4px; letter-spacing: .03em; }

    .aa-nav__dropdown { display: none; position: absolute; top: 100%; left: 0; min-width: 220px; background: var(--aa-white); border: 1px solid var(--aa-border); border-top: 3px solid var(--aa-accent); border-radius: 0 0 var(--aa-radius) var(--aa-radius); box-shadow: 0 8px 24px rgba(0,0,0,.12); z-index: 9999; padding: 8px 0; animation: dropIn .18s ease; }
    @keyframes dropIn { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
    .aa-nav__item:hover .aa-nav__dropdown { display: block; }
    .aa-nav__dropdown a { display: block; padding: 10px 20px; font-size: 1.35rem; color: var(--aa-dark); font-weight: 500; transition: background .15s, color .15s, padding-left .15s; }
    .aa-nav__dropdown a:hover { background: var(--aa-bg); color: var(--aa-accent); padding-left: 26px; }
    .aa-nav__dropdown hr { margin: 6px 16px; border: none; border-top: 1px solid var(--aa-border); }

    .aa-nav__mega { left: 0; min-width: 700px; padding: 28px 32px; display: none; grid-template-columns: repeat(4, 1fr); gap: 24px; }
    .aa-nav__item:hover .aa-nav__mega { display: grid; }
    .aa-mega__col h4 { font-size: 1.2rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; color: var(--aa-accent); margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid var(--aa-border); display: inline-block; }
    .aa-mega__col a { display: block; padding: 6px 0; font-size: 1.3rem; color: var(--aa-mid); }
    .aa-mega__col a:hover { color: var(--aa-accent); padding-left: 6px; }

    /* â”€â”€ MOBILE MENU â”€â”€ */
    .aa-mobile-menu-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.45); z-index: var(--z-mobile-menu); animation: fadeIn .2s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .aa-mobile-menu-overlay.open { display: block; }
    .aa-mobile-menu { position: fixed; top: 0; left: 0; bottom: 0; width: 300px; background: var(--aa-white); z-index: calc(var(--z-mobile-menu) + 1); transform: translateX(-100%); transition: transform .3s ease; display: flex; flex-direction: column; overflow-y: auto; }
    .aa-mobile-menu.open { transform: translateX(0); }
    .aa-mobile-menu__header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid var(--aa-border); background: var(--aa-bg-header); }
    .aa-mobile-menu__close { background: none; border: none; font-size: 2.4rem; color: var(--aa-dark); line-height: 1; }
    .aa-mobile-menu__search { padding: 12px 16px; border-bottom: 1px solid var(--aa-border); }
    .aa-mobile-menu__search form { display: flex; background: var(--aa-bg); border: 1px solid var(--aa-border); border-radius: 50px; overflow: hidden; }
    .aa-mobile-menu__search input { flex: 1; border: none; background: transparent; padding: 10px 14px; font-size: 1.4rem; outline: none; }
    .aa-mobile-menu__search button { padding: 0 14px; background: none; border: none; font-size: 1.8rem; color: var(--aa-accent); }
    .aa-mobile-nav__item { border-bottom: 1px solid var(--aa-border); }
    .aa-mobile-nav__link { display: flex; justify-content: space-between; align-items: center; padding: 14px 20px; font-size: 1.5rem; font-weight: 600; color: var(--aa-dark); }
    .aa-mobile-nav__link:hover { color: var(--aa-accent); background: var(--aa-bg); }
    .aa-mobile-nav__sub { display: none; background: var(--aa-bg); padding: 4px 0 8px; }
    .aa-mobile-nav__sub.open { display: block; }
    .aa-mobile-nav__sub a { display: block; padding: 9px 32px; font-size: 1.35rem; color: var(--aa-mid); }
    .aa-mobile-nav__sub a:hover { color: var(--aa-accent); }
    .aa-mobile-menu__footer { padding: 20px; margin-top: auto; border-top: 1px solid var(--aa-border); display: flex; flex-direction: column; gap: 10px; }
    .aa-mobile-menu__footer a { display: flex; align-items: center; gap: 10px; font-size: 1.4rem; font-weight: 500; color: var(--aa-mid); padding: 8px 0; }
    .aa-mobile-menu__footer a:hover { color: var(--aa-accent); }
    .aa-mobile-menu__footer i { font-size: 1.8rem; }

    /* â”€â”€ CONTENT â”€â”€ */
    #aa-content { min-height: 60vh; }

    /* â”€â”€ FLASH MESSAGES â”€â”€ */
    .aa-messages { max-width: 900px; margin: 16px auto; padding: 0 20px; display: flex; flex-direction: column; gap: 8px; }
    .aa-message { display: flex; align-items: center; gap: 12px; padding: 12px 18px; border-radius: var(--aa-radius); font-size: 1.4rem; font-weight: 500; border-left: 4px solid; }
    .aa-message--success { background: #e6f9ee; border-color: #2eb85c; color: #1a5c35; }
    .aa-message--error, .aa-message--danger  { background: #fdf0f0; border-color: var(--aa-red); color: #7a1a1a; }
    .aa-message--warning { background: #fff8e6; border-color: #f0ad00; color: #6b4d00; }
    .aa-message--info    { background: #e8f2fb; border-color: var(--aa-accent); color: #0d3c65; }
    .aa-message__close { margin-left: auto; background: none; border: none; font-size: 1.8rem; opacity: .6; line-height: 1; }
    .aa-message__close:hover { opacity: 1; }

    /* â”€â”€ TOAST â”€â”€ */
    #aa-toast-container { position: fixed; top: 24px; right: 24px; z-index: var(--z-toast); display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
    .aa-toast { pointer-events: all; display: flex; align-items: center; gap: 12px; background: var(--aa-white); padding: 14px 20px; border-radius: var(--aa-radius); box-shadow: 0 8px 24px rgba(0,0,0,.16); min-width: 280px; max-width: 360px; transform: translateX(120%); transition: transform .35s cubic-bezier(.34,1.56,.64,1); border-left: 4px solid var(--aa-accent); font-size: 1.4rem; font-weight: 500; }
    .aa-toast.show { transform: translateX(0); }
    .aa-toast.success { border-color: #2eb85c; }
    .aa-toast.error   { border-color: var(--aa-red); }
    .aa-toast.warning { border-color: #f0ad00; }
    .aa-toast i { font-size: 2rem; }
    .aa-toast.success i { color: #2eb85c; }
    .aa-toast.error   i { color: var(--aa-red); }
    .aa-toast.warning i { color: #f0ad00; }
    .aa-toast.info    i { color: var(--aa-accent); }

    /* â”€â”€ FOOTER â”€â”€ */
    .aa-footer { background: var(--aa-bg-footer); border-top: 1px solid var(--aa-border); margin-top: 60px; }
    .aa-footer__top { background: var(--aa-dark); color: #fff; padding: 40px 24px; }
    .aa-footer__top-inner { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: 1fr 2fr 1fr; align-items: center; gap: 30px; }
    .aa-footer__tagline { text-align: center; font-family: var(--font-display); font-size: 2.2rem; font-weight: 400; font-style: italic; opacity: .9; letter-spacing: .03em; }
    .aa-footer__top-cta { text-align: right; }
    .aa-footer__top-cta a { display: inline-flex; align-items: center; gap: 8px; padding: 11px 24px; background: var(--aa-accent); color: #fff; border-radius: 50px; font-size: 1.35rem; font-weight: 600; transition: background .2s; }
    .aa-footer__top-cta a:hover { background: var(--aa-accent-hover); }
    .aa-footer__main { max-width: 1400px; margin: 0 auto; padding: 48px 24px 36px; display: grid; grid-template-columns: 1.4fr 1fr 1fr 1fr 1.4fr; gap: 32px; }
    .aa-footer__col h4 { font-size: 1.4rem; font-weight: 700; text-transform: uppercase; letter-spacing: .1em; color: var(--aa-dark); margin-bottom: 16px; padding-bottom: 10px; border-bottom: 2px solid var(--aa-accent); display: inline-block; }
    .aa-footer__col ul { display: flex; flex-direction: column; gap: 9px; }
    .aa-footer__col ul li a { font-size: 1.35rem; color: var(--aa-mid); transition: color .2s, padding-left .2s; }
    .aa-footer__col ul li a:hover { color: var(--aa-accent); padding-left: 4px; }
    .aa-footer__newsletter p { font-size: 1.35rem; color: var(--aa-mid); margin-bottom: 14px; line-height: 1.6; }
    .aa-footer__newsletter-form { display: flex; border: 1.5px solid var(--aa-border); border-radius: 50px; overflow: hidden; background: var(--aa-white); }
    .aa-footer__newsletter-form input { flex: 1; border: none; outline: none; padding: 11px 16px; font-size: 1.35rem; font-family: var(--font-body); background: transparent; color: var(--aa-dark); }
    .aa-footer__newsletter-form button { background: var(--aa-accent); border: none; color: #fff; padding: 0 18px; font-size: 1.6rem; display: flex; align-items: center; justify-content: center; transition: background .2s; }
    .aa-footer__newsletter-form button:hover { background: var(--aa-accent-hover); }
    .aa-footer__social { display: flex; gap: 10px; margin-top: 20px; }
    .aa-footer__social a { width: 38px; height: 38px; border-radius: 50%; background: var(--aa-dark); color: #fff; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; transition: background .2s, transform .2s; }
    .aa-footer__social a:hover { background: var(--aa-accent); transform: translateY(-3px); }
    .aa-footer__bottom { background: var(--aa-dark); color: rgba(255,255,255,.65); padding: 16px 24px; }
    .aa-footer__bottom-inner { max-width: 1400px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
    .aa-footer__bottom p { font-size: 1.25rem; }
    .aa-footer__bottom-links { display: flex; gap: 20px; }
    .aa-footer__bottom-links a { font-size: 1.25rem; color: rgba(255,255,255,.55); transition: color .2s; }
    .aa-footer__bottom-links a:hover { color: #fff; }
    .aa-footer__payments { display: flex; align-items: center; gap: 8px; font-size: 1.25rem; }
    .aa-footer__payments i { font-size: 2rem; opacity: .7; }

    /* â”€â”€ BUTTONS â”€â”€ */
    .aa-btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 22px; border-radius: 50px; font-size: 1.4rem; font-weight: 600; border: 2px solid transparent; transition: all .25s; letter-spacing: .03em; }
    .aa-btn--primary { background: var(--aa-accent); color: #fff; border-color: var(--aa-accent); flex: 1; }
    .aa-btn--primary:hover { background: var(--aa-accent-hover); border-color: var(--aa-accent-hover); }
    .aa-btn--outline { background: transparent; color: var(--aa-dark); border-color: var(--aa-border); }
    .aa-btn--outline:hover { border-color: var(--aa-accent); color: var(--aa-accent); }
    .aa-btn--dark { background: var(--aa-dark); color: #fff; border-color: var(--aa-dark); flex: 1; }
    .aa-btn--dark:hover { background: #2a3d52; }

    /* â”€â”€ RESPONSIVE â”€â”€ */
    @media (max-width: 1100px) { .aa-footer__main { grid-template-columns: 1fr 1fr 1fr; } .aa-footer__top-inner { grid-template-columns: 1fr 1fr; } .aa-footer__top-cta { display: none; } }
    @media (max-width: 900px)  { .aa-nav-wrap { display: none; } .aa-header { grid-template-columns: auto 1fr auto; } .aa-header__search { display: none; } .aa-header__account-links { display: none; } .aa-footer__main { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 600px)  { .aa-footer__main { grid-template-columns: 1fr; } .aa-footer__top-inner { grid-template-columns: 1fr; text-align: center; } .aa-footer__tagline { font-size: 1.8rem; } .aa-footer__bottom-inner { flex-direction: column; text-align: center; } .aa-header { padding: 8px 14px; gap: 10px; } .aa-eyetest-btn__text { display: none; } .aa-eyetest-btn { padding: 7px 8px; } }

    /* â”€â”€ UTILITY â”€â”€ */
    .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    .aa-container { max-width: 1400px; margin: 0 auto; padding: 0 24px; }
    .aa-section { padding: 60px 0; }

    {% block extra_styles %}{% endblock %}
  </style>
<style id="aa-search-css">

/* â”€â”€ Search Wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.aa-search-wrap {
  position: relative;
  flex: 1;
  max-width: 520px;
  margin-right: 24px;
}

.aa-search-form {
  display: flex;
  align-items: center;
  background: var(--aa-white);
  border: 1.5px solid var(--aa-border);
  border-radius: 50px;
  overflow: visible;
  height: 42px;
  transition: border-color .2s, box-shadow .2s;
  position: relative;
  z-index: 2;
}
.aa-search-wrap.focused .aa-search-form {
  border-color: var(--aa-accent);
  box-shadow: 0 0 0 3px rgba(26,111,168,.13);
  border-radius: 18px 18px 0 0;
  border-bottom-color: transparent;
}
.aa-search-wrap.focused.empty .aa-search-form {
  border-radius: 50px;
  border-bottom-color: var(--aa-accent);
}

.aa-search-input {
  flex: 1;
  border: none;
  outline: none;
  padding: 0 16px 0 18px;
  font-family: var(--font-body);
  font-size: 1.35rem;
  color: var(--aa-dark);
  background: transparent;
  min-width: 0;
}
.aa-search-input::placeholder { color: #9ab; }

.aa-search-clear {
  display: none;
  background: none;
  border: none;
  padding: 0 4px 0 0;
  color: #bbb;
  font-size: 1.6rem;
  line-height: 1;
  cursor: pointer;
  transition: color .2s;
  flex-shrink: 0;
}
.aa-search-clear:hover { color: var(--aa-accent); }
.aa-search-wrap.has-value .aa-search-clear { display: flex; align-items: center; }

.aa-search-submit {
  width: 46px;
  height: 42px;
  border: none;
  background: var(--aa-accent);
  color: #fff;
  font-size: 1.55rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 0 50px 50px 0;
  transition: background .2s;
  flex-shrink: 0;
  cursor: pointer;
}
.aa-search-submit:hover { background: var(--aa-accent-hover); }

/* â”€â”€ Dropdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.aa-search-dropdown {
  position: absolute;
  top: calc(100% - 2px);
  left: 0; right: 0;
  background: var(--aa-white);
  border: 1.5px solid var(--aa-accent);
  border-top: none;
  border-radius: 0 0 18px 18px;
  box-shadow: 0 16px 40px rgba(26,42,58,.18);
  z-index: 99999;
  overflow: hidden;
  display: none;
  max-height: 480px;
  overflow-y: auto;
}
.aa-search-wrap.focused:not(.empty) .aa-search-dropdown.has-results,
.aa-search-wrap.focused .aa-search-dropdown.show-popular { display: block; }

/* Scrollbar */
.aa-search-dropdown::-webkit-scrollbar { width: 4px; }
.aa-search-dropdown::-webkit-scrollbar-track { background: transparent; }
.aa-search-dropdown::-webkit-scrollbar-thumb { background: var(--aa-border); border-radius: 2px; }

/* Section label */
.aa-dd-section-label {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px 6px;
  font-size: 1.05rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .1em;
  color: var(--aa-accent);
}
.aa-dd-section-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--aa-border);
}

/* Item row */
.aa-dd-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 16px;
  text-decoration: none;
  color: var(--aa-dark);
  font-size: 1.3rem;
  border-bottom: 1px solid #f3f7fb;
  cursor: pointer;
  transition: background .15s, padding-left .15s;
  position: relative;
}
.aa-dd-item:last-child { border-bottom: none; }
.aa-dd-item:hover,
.aa-dd-item.highlighted { background: #eef3f8; padding-left: 22px; }

/* Thumb */
.aa-dd-thumb {
  width: 42px;
  height: 42px;
  border-radius: 8px;
  background: var(--aa-bg);
  object-fit: contain;
  flex-shrink: 0;
  border: 1px solid var(--aa-border);
  padding: 4px;
}
.aa-dd-icon {
  width: 42px;
  height: 42px;
  border-radius: 8px;
  background: var(--aa-bg);
  border: 1px solid var(--aa-border);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: 1.6rem;
}

/* Text */
.aa-dd-text { flex: 1; min-width: 0; }
.aa-dd-name {
  font-weight: 600;
  color: var(--aa-dark);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 1.3rem;
}
.aa-dd-name mark {
  background: transparent;
  color: var(--aa-accent);
  font-weight: 700;
}
.aa-dd-sub {
  font-size: 1.1rem;
  color: #8aa;
  margin-top: 1px;
}

/* Price tag */
.aa-dd-price {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--aa-accent);
  flex-shrink: 0;
  white-space: nowrap;
}

/* Type badge */
.aa-dd-badge {
  font-size: .95rem;
  font-weight: 700;
  padding: 2px 7px;
  border-radius: 4px;
  flex-shrink: 0;
  white-space: nowrap;
}
.aa-dd-badge--brand    { background: #e8f4ff; color: #1a6fa8; }
.aa-dd-badge--category { background: #eef8ee; color: #2a8a2a; }
.aa-dd-badge--popular  { background: #fff4e5; color: #c07000; }

/* View all row */
.aa-dd-viewall {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 14px 16px;
  background: #f5f9fd;
  color: var(--aa-accent);
  font-size: 1.25rem;
  font-weight: 700;
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: .06em;
  border-top: 1px solid var(--aa-border);
  transition: background .2s;
}
.aa-dd-viewall:hover { background: var(--aa-bg); color: var(--aa-accent); }

/* Loading spinner */
.aa-dd-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 24px;
  color: #9ab;
  font-size: 1.3rem;
}
.aa-dd-spinner {
  width: 18px; height: 18px;
  border: 2px solid var(--aa-border);
  border-top-color: var(--aa-accent);
  border-radius: 50%;
  animation: aaSearchSpin .7s linear infinite;
}
@keyframes aaSearchSpin { to { transform: rotate(360deg); } }

/* No results */
.aa-dd-empty {
  text-align: center;
  padding: 28px 20px;
  color: #9ab;
  font-size: 1.3rem;
}
.aa-dd-empty span { display: block; font-size: 2.4rem; margin-bottom: 8px; }

/* Recent tag with remove */
.aa-dd-recent-remove {
  background: none;
  border: none;
  color: #bbb;
  font-size: 1.4rem;
  line-height: 1;
  cursor: pointer;
  padding: 0 4px;
  flex-shrink: 0;
  transition: color .2s;
}
.aa-dd-recent-remove:hover { color: var(--aa-red); }

/* Popular pill tags (shown when input empty) */
.aa-dd-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 12px 16px 16px;
}
.aa-dd-pill {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  background: var(--aa-bg);
  border: 1.5px solid var(--aa-border);
  border-radius: 50px;
  padding: 6px 14px;
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--aa-mid);
  text-decoration: none;
  transition: all .2s;
  white-space: nowrap;
}
.aa-dd-pill:hover {
  background: var(--aa-accent);
  border-color: var(--aa-accent);
  color: #fff;
  transform: translateY(-1px);
}

/* â”€â”€ Mobile Search (full-width overlay style) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.aa-mobile-search-wrap {
  position: relative;
  padding: 12px 16px;
  border-bottom: 1px solid var(--aa-border);
  background: var(--aa-bg-header);
}
.aa-mobile-search-form {
  display: flex;
  background: var(--aa-white);
  border: 1.5px solid var(--aa-border);
  border-radius: 50px;
  overflow: hidden;
  height: 42px;
  transition: border-color .2s;
}
.aa-mobile-search-form:focus-within {
  border-color: var(--aa-accent);
  box-shadow: 0 0 0 3px rgba(26,111,168,.1);
}
.aa-mobile-search-input {
  flex: 1;
  border: none;
  outline: none;
  padding: 0 14px;
  font-size: 1.4rem;
  font-family: var(--font-body);
  color: var(--aa-dark);
  background: transparent;
}
.aa-mobile-search-input::placeholder { color: #9ab; }
.aa-mobile-search-btn {
  width: 44px;
  background: var(--aa-accent);
  border: none;
  color: #fff;
  font-size: 1.6rem;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
}
.aa-mobile-search-btn:hover { background: var(--aa-accent-hover); }

.aa-mobile-dd {
  position: absolute;
  left: 16px; right: 16px;
  top: calc(100% - 12px);
  background: var(--aa-white);
  border: 1.5px solid var(--aa-accent);
  border-radius: 0 0 14px 14px;
  box-shadow: 0 12px 30px rgba(26,42,58,.16);
  z-index: 999999;
  display: none;
  max-height: 360px;
  overflow-y: auto;
}
.aa-mobile-dd.open { display: block; }

/* â”€â”€ Search toggle btn in header (mobile) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.aa-search-toggle-btn {
  position: relative;
  display: none;
  align-items: center;
  justify-content: center;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: none;
  background: transparent;
  color: var(--aa-dark);
  font-size: 2rem;
  transition: background .2s, color .2s;
}
.aa-search-toggle-btn:hover { background: rgba(26,111,168,.1); color: var(--aa-accent); }

@media (max-width: 900px) {
  .aa-search-toggle-btn { display: flex; }
  /* Hide desktop search in nav (already hidden by nav-wrap display:none on mobile) */
}
@media (max-width: 600px) {
  .aa-mobile-search-wrap { padding: 10px 12px; }
}

</style>
  {% block extra_head %}{% endblock %}
</head>

<body>
<div id="xo-root">

  <!-- TOAST CONTAINER -->
  <div id="aa-toast-container" aria-live="polite"></div>

  <!-- ANNOUNCEMENT BAR -->
  <div class="aa-topbar" id="aa-topbar">
    ðŸŽ‰ Free Eye Test in Store â€”
    <a href="{% url 'content:eye_test_booking' %}">Book Now</a>
    &nbsp;Â·&nbsp;
    Free Shipping on orders above QAR 200
    <button class="aa-topbar__close" onclick="document.getElementById('aa-topbar').style.display='none'" aria-label="Close">Ã—</button>
  </div>

  <!-- HEADER -->
  <div class="aa-header-wrap">
    <header class="aa-header">

      <!-- LEFT: Book Eye Test -->
      <div class="aa-header__left">
        <a href="{% url 'content:eye_test_booking' %}" class="aa-eyetest-btn">
          <div class="aa-eyetest-btn__avatar">
            <svg width="20" height="20" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
          </div>
          <div class="aa-eyetest-btn__text">
            <span>Book Free Eyetest</span>
          </div>
        </a>
      </div>

      <!-- CENTRE: Logo -->
      <div class="aa-header__logo">
        <a href="{% url 'catalog:home' %}">
          {% if LOGO_URL %}
            <img src="{{ LOGO_URL }}" alt="Al Ameen Optics" class="aa-logo-img">
          {% else %}
          <div class="aa-logo-text">
            <span class="aa-logo-text__ar">Ù†Ø¸Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù…ÙŠÙ†</span>
            <span class="aa-logo-text__en">Al Am<span style="color:var(--aa-accent)">een</span></span>
            <span class="aa-logo-text__sub">Optics</span>
          </div>
          {% endif %}
        </a>
      </div>

      <!-- RIGHT: Icons --> 
      <div class="aa-header__right">

        <!-- Account links (desktop) -->
        <div class="aa-header__account-links">
          {% if user.is_authenticated %}
            <a href="{% url 'users:profile' %}">My Account</a>
            <span class="divider"></span>
            <a href="{% url 'orders:order_list' %}">Orders</a>
            <span class="divider"></span>
            <a href="{% url 'users:logout' %}">Logout</a>
          {% else %}
            <a href="{% url 'users:login' %}">Login</a>
            <span class="divider"></span>
            <a href="{% url 'users:register' %}">Register</a>
          {% endif %}
        </div>

        <!-- Wishlist -->
        <a href="{% url 'wishlist:wishlist' %}" class="aa-header__icon-btn" aria-label="Wishlist" id="aa-wishlist-icon-link">
          <i class="bi bi-heart"></i>
          <span class="aa-header__badge"
                id="aa-wishlist-count"
                data-count="{{ wishlist_count|default:0 }}"
                {% if not wishlist_count %}style="display:none"{% endif %}>
            {{ wishlist_count|default:0 }}
          </span>
        </a>

        <!-- Cart â€” goes directly to cart page -->
        <a href="{% url 'cart:cart_view' %}" class="aa-header__icon-btn" aria-label="Shopping Cart" id="aa-cart-icon-link">
          <i class="bi bi-bag"></i>
          <span class="aa-header__badge"
                id="aa-cart-count"
                data-count="{{ cart_count|default:0 }}"
                {% if not cart_count %}style="display:none"{% endif %}>
            {{ cart_count|default:0 }}
          </span>
        </a>

        <!-- Hamburger (mobile) -->
        <button class="aa-header__icon-btn" id="aa-menu-toggle" aria-label="Menu" style="display:none">
          <i class="bi bi-list"></i>
        </button>
      </div>

    </header>

   <!-- MOBILE SEARCH (paste as .aa-mobile-menu__search replacement) -->
<div class="aa-mobile-search-wrap" id="aa-mobile-search-wrap">
  <form class="aa-mobile-search-form" method="get" action="{% url 'search:search' %}" id="aa-mobile-search-form" autocomplete="off">
    <input
      type="text"
      name="q"
      class="aa-mobile-search-input"
      id="aa-mobile-search-input"
      placeholder="Search products, brandsâ€¦"
      value="{{ request.GET.q }}"
      autocomplete="off"
    >
    <button type="submit" class="aa-mobile-search-btn" aria-label="Search">
      <i class="bi bi-search"></i>
    </button>
  </form>
  <div class="aa-mobile-dd" id="aa-mobile-dd" role="listbox">
    <!-- Populated by JS -->
  </div>
</div>

    <!-- NAVIGATION -->
    <nav class="aa-nav-wrap" aria-label="Main navigation">
      <div class="aa-nav">

        <div class="aa-search-wrap" id="aa-search-wrap-desktop">
  <form class="aa-search-form" method="get" action="{% url 'search:search' %}" id="aa-search-form-desktop" autocomplete="off" role="search">
    <i class="bi bi-search" style="color:#9ab;font-size:1.4rem;padding-left:14px;flex-shrink:0;"></i>
    <input
      type="text"
      name="q"
      class="aa-search-input"
      id="aa-search-input-desktop"
      placeholder="Search glasses, brands, lensesâ€¦"
      value="{{ request.GET.q }}"
      autocomplete="off"
      aria-label="Search products"
      aria-autocomplete="list"
      aria-controls="aa-search-dropdown-desktop"
    >
    <button type="button" class="aa-search-clear" id="aa-search-clear-desktop" aria-label="Clear search">Ã—</button>
    <button type="submit" class="aa-search-submit" aria-label="Submit search">
      <i class="bi bi-search"></i>
    </button>
  </form>
  <div class="aa-search-dropdown" id="aa-search-dropdown-desktop" role="listbox">
    <!-- Populated by JS -->
  </div>
</div>

        <ul class="aa-nav__list" role="list">

          <li class="aa-nav__item">
            <a href="{% url 'catalog:sunglasses_list' %}?sort=-created_at" class="aa-nav__link">New Arrivals</a>
          </li>

          <li class="aa-nav__item">
            <a href="{% url 'catalog:product_list' 'accessories' %}" class="aa-nav__link">Gift Shop</a>
          </li>

          <li class="aa-nav__item">
            <a href="{% url 'catalog:sunglasses_list' %}" class="aa-nav__link">
              Sunglasses <i class="bi bi-chevron-down"></i>
            </a>
            <div class="aa-nav__dropdown aa-nav__mega">
              <div class="aa-mega__col">
                <h4>By Gender</h4>
                <a href="{% url 'catalog:sunglasses_list' %}?gender=men">Men's Sunglasses</a>
                <a href="{% url 'catalog:sunglasses_list' %}?gender=women">Women's Sunglasses</a>
                <a href="{% url 'catalog:sunglasses_list' %}?gender=unisex">Unisex</a>
                <a href="{% url 'catalog:product_list' 'reading_glasses' %}">Kids</a>
              </div>
              <div class="aa-mega__col">
                <h4>By Style</h4>
                <a href="{% url 'catalog:sunglasses_list' %}">Aviator</a>
                <a href="{% url 'catalog:sunglasses_list' %}">Wayfarer</a>
                <a href="{% url 'catalog:sunglasses_list' %}">Sport</a>
                <a href="{% url 'catalog:sunglasses_list' %}">Oversized</a>
                <a href="{% url 'catalog:sunglasses_list' %}">Cat Eye</a>
              </div>
              <div class="aa-mega__col">
                <h4>Top Brands</h4>
                {% for brand in nav_brands|slice:":5" %}
                  <a href="{% url 'catalog:brand_detail' brand.slug %}">{{ brand.name }}</a>
                {% empty %}
                  <a href="{% url 'catalog:brand_list' %}">Ray-Ban</a>
                  <a href="{% url 'catalog:brand_list' %}">Oakley</a>
                  <a href="{% url 'catalog:brand_list' %}">Tom Ford</a>
                  <a href="{% url 'catalog:brand_list' %}">Prada</a>
                {% endfor %}
              </div>
              <div class="aa-mega__col">
                <h4>Quick Links</h4>
                <a href="{% url 'catalog:sunglasses_list' %}">All Sunglasses</a>
                <a href="{% url 'catalog:sunglasses_list' %}?sort=base_price">Under QAR 999</a>
                <a href="{% url 'content:eye_test_booking' %}">Book Eye Test</a>
                <a href="{% url 'content:store_locations' %}">Find a Store</a>
              </div>
            </div>
          </li>

          <li class="aa-nav__item">
            <a href="{% url 'catalog:eyeglasses_list' %}" class="aa-nav__link">
              Eyeglasses <i class="bi bi-chevron-down"></i>
            </a>
            <div class="aa-nav__dropdown">
              <a href="{% url 'catalog:eyeglasses_list' %}?gender=men">Men's Frames</a>
              <a href="{% url 'catalog:eyeglasses_list' %}?gender=women">Women's Frames</a>
              <a href="{% url 'catalog:eyeglasses_list' %}?gender=unisex">Unisex Frames</a>
              <hr>
              <a href="{% url 'catalog:eyeglasses_list' %}">Progressive Lenses</a>
              <a href="{% url 'catalog:eyeglasses_list' %}">Blue Light Glasses</a>
              <a href="{% url 'catalog:eyeglasses_list' %}">Reading Glasses</a>
              <hr>
              <a href="{% url 'content:eye_test_booking' %}">ðŸ“… Book Free Eye Test</a>
            </div>
          </li>

          <li class="aa-nav__item">
            <a href="{% url 'catalog:contact_lenses_list' %}" class="aa-nav__link">
              Contact Lenses <i class="bi bi-chevron-down"></i>
            </a>
            <div class="aa-nav__dropdown">
              <a href="{% url 'catalog:contact_lenses_list' %}?lens_type=clear">Clear Lenses</a>
              <a href="{% url 'catalog:contact_lenses_list' %}?lens_type=color">Coloured Lenses</a>
              <hr>
              <a href="{% url 'catalog:contact_lenses_list' %}?schedule=daily">Daily</a>
              <a href="{% url 'catalog:contact_lenses_list' %}?schedule=monthly">Monthly</a>
              <a href="{% url 'catalog:contact_lenses_list' %}?schedule=yearly">Yearly</a>
            </div>
          </li>

          <li class="aa-nav__item">
            <a href="{% url 'catalog:brand_list' %}" class="aa-nav__link">
              Brands <i class="bi bi-chevron-down"></i>
            </a>
            <div class="aa-nav__dropdown">
              {% for brand in nav_brands|slice:":8" %}
              <a href="{% url 'catalog:brand_detail' brand.slug %}">{{ brand.name }}</a>
              {% empty %}
              <a href="{% url 'catalog:brand_list' %}">All Brands</a>
              {% endfor %}
              <hr>
              <a href="{% url 'catalog:brand_list' %}"><strong>View All Brands â†’</strong></a>
            </div>
          </li>

          <li class="aa-nav__item">
            <a href="{% url 'content:eye_test_booking' %}" class="aa-nav__link">
              Eye Care <i class="bi bi-chevron-down"></i>
            </a>
            <div class="aa-nav__dropdown">
              <a href="{% url 'content:eye_test_booking' %}">Book Eye Test</a>
              <a href="{% url 'content:store_locations' %}">Find a Store</a>
              <hr>
              <a href="{% url 'catalog:brand_list' %}">Lens Cleaning Services</a>
              <a href="{% url 'catalog:brand_list' %}">Frame Adjustments</a>
              <a href="{% url 'catalog:brand_list' %}">Prescription Upload</a>
            </div>
          </li>

          <li class="aa-nav__item">
            <a href="{% url 'catalog:sunglasses_list' %}" class="aa-nav__link" style="color:var(--aa-red)">
              Sale <span class="aa-nav__sale-tag">50% OFF</span>
            </a>
          </li>

        </ul>
      </div>
    </nav>
  </div>
  <!-- END HEADER -->

  <!-- MOBILE SIDE MENU -->
  <div class="aa-mobile-menu-overlay" id="aa-mobile-overlay"></div>
  <nav class="aa-mobile-menu" id="aa-mobile-menu" aria-label="Mobile navigation">
    <div class="aa-mobile-menu__header">
      <a href="{% url 'home' %}">
        <div class="aa-logo-text" style="--aa-accent:#1a6fa8">
          <span style="font-family:var(--font-display);font-size:1.6rem;font-weight:700;color:var(--aa-accent)">Al Ameen</span>
          <span style="font-size:1.1rem;letter-spacing:.1em;color:var(--aa-mid)">OPTICS</span>
        </div>
      </a>
      <button class="aa-mobile-menu__close" id="aa-mobile-close">Ã—</button>
    </div>
    <div class="aa-mobile-menu__search">
      <form method="get" action="{% url 'catalog:search' %}">
        <input type="text" name="q" placeholder="Searchâ€¦" value="{{ request.GET.q }}">
        <button type="submit"><i class="bi bi-search"></i></button>
      </form>
    </div>
    <ul>
      <li class="aa-mobile-nav__item">
        <div class="aa-mobile-nav__link" onclick="toggleMobileSub(this)">
          <a href="{% url 'catalog:sunglasses_list' %}">Sunglasses</a>
          <i class="bi bi-chevron-down"></i>
        </div>
        <div class="aa-mobile-nav__sub">
          <a href="{% url 'catalog:sunglasses_list' %}?gender=men">Men's Sunglasses</a>
          <a href="{% url 'catalog:sunglasses_list' %}?gender=women">Women's Sunglasses</a>
          <a href="{% url 'catalog:sunglasses_list' %}">All Sunglasses</a>
        </div>
      </li>
      <li class="aa-mobile-nav__item">
        <div class="aa-mobile-nav__link" onclick="toggleMobileSub(this)">
          <a href="{% url 'catalog:eyeglasses_list' %}">Eyeglasses</a>
          <i class="bi bi-chevron-down"></i>
        </div>
        <div class="aa-mobile-nav__sub">
          <a href="{% url 'catalog:eyeglasses_list' %}?gender=men">Men's Frames</a>
          <a href="{% url 'catalog:eyeglasses_list' %}?gender=women">Women's Frames</a>
          <a href="{% url 'catalog:eyeglasses_list' %}">All Eyeglasses</a>
        </div>
      </li>
      <li class="aa-mobile-nav__item"><div class="aa-mobile-nav__link"><a href="{% url 'catalog:contact_lenses_list' %}">Contact Lenses</a></div></li>
      <li class="aa-mobile-nav__item"><div class="aa-mobile-nav__link"><a href="{% url 'catalog:brand_list' %}">Brands</a></div></li>
      <li class="aa-mobile-nav__item"><div class="aa-mobile-nav__link"><a href="{% url 'catalog:product_list' 'accessories' %}">Gift Shop</a></div></li>
      <li class="aa-mobile-nav__item"><div class="aa-mobile-nav__link"><a href="{% url 'content:eye_test_booking' %}">Book Eye Test</a></div></li>
      <li class="aa-mobile-nav__item"><div class="aa-mobile-nav__link"><a href="{% url 'catalog:sunglasses_list' %}" style="color:var(--aa-red)">Sale â€” Up to 50% Off</a></div></li>
    </ul>
    <div class="aa-mobile-menu__footer">
      {% if user.is_authenticated %}
        <a href="{% url 'users:profile' %}"><i class="bi bi-person"></i> My Account</a>
        <a href="{% url 'orders:order_list' %}"><i class="bi bi-box"></i> My Orders</a>
        <a href="{% url 'users:logout' %}"><i class="bi bi-box-arrow-right"></i> Logout</a>
      {% else %}
        <a href="{% url 'users:login' %}"><i class="bi bi-box-arrow-in-right"></i> Login</a>
        <a href="{% url 'users:register' %}"><i class="bi bi-person-plus"></i> Create Account</a>
      {% endif %}
      <a href="{% url 'content:store_locations' %}"><i class="bi bi-geo-alt"></i> Find a Store</a>
    </div>
  </nav>

  <!-- FLASH MESSAGES -->
  {% if messages %}
  <div class="aa-messages">
    {% for message in messages %}
    <div class="aa-message aa-message--{{ message.tags }}">
      {% if 'success' in message.tags %}<i class="bi bi-check-circle-fill"></i>
      {% elif 'error' in message.tags or 'danger' in message.tags %}<i class="bi bi-exclamation-circle-fill"></i>
      {% elif 'warning' in message.tags %}<i class="bi bi-exclamation-triangle-fill"></i>
      {% else %}<i class="bi bi-info-circle-fill"></i>{% endif %}
      {{ message }}
      <button class="aa-message__close" onclick="this.parentElement.remove()" aria-label="Close">Ã—</button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <main id="aa-content">
    {% block content %}{% endblock %}
  </main>

  <!-- FOOTER -->
  <footer class="aa-footer">
    <div class="aa-footer__top">
      <div class="aa-footer__top-inner">
        <div>
          <div style="font-family:var(--font-display);font-size:2.6rem;color:#fff;font-weight:500;font-style:italic;line-height:1.2;">Ù†Ø¸Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù…ÙŠÙ†</div>
          <div style="font-size:1.2rem;color:rgba(255,255,255,.55);letter-spacing:.12em;margin-top:4px;text-transform:uppercase;">Al Ameen Optics</div>
        </div>
        <div class="aa-footer__tagline">"Your Vision Matters More"</div>
        <div class="aa-footer__top-cta">
          <a href="{% url 'content:eye_test_booking' %}"><i class="bi bi-calendar-check"></i> Book Free Eye Test</a>
        </div>
      </div>
    </div>

    <div class="aa-footer__main">
      <div class="aa-footer__col">
        <h4>About Us</h4>
        <ul>
          <li><a href="{% url 'about' %}">Our Story</a></li>
          <li><a href="{% url 'about' %}">Trusted Since 1927</a></li>
          <li><a href="{% url 'content:store_locations' %}">Store Locations</a></li>
          <li><a href="{% url 'contact' %}">Careers</a></li>
          <li><a href="{% url 'contact' %}">Press & Media</a></li>
          <li><a href="{% url 'about' %}">CSR Initiatives</a></li>
        </ul>
      </div>
      <div class="aa-footer__col">
        <h4>Customer Service</h4>
        <ul>
          <li><a href="{% url 'contact' %}">Contact Us</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">FAQ</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">Shipping Policy</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">Return & Exchange</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">Warranty Policy</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">Track My Order</a></li>
        </ul>
      </div>
      <div class="aa-footer__col">
        <h4>Shop</h4>
        <ul>
          <li><a href="{% url 'catalog:sunglasses_list' %}">Sunglasses</a></li>
          <li><a href="{% url 'catalog:eyeglasses_list' %}">Eyeglasses</a></li>
          <li><a href="{% url 'catalog:contact_lenses_list' %}">Contact Lenses</a></li>
          <li><a href="{% url 'catalog:product_list' 'accessories' %}">Accessories</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">All Brands</a></li>
          <li><a href="{% url 'catalog:sunglasses_list' %}">Sale â€” 50% Off</a></li>
        </ul>
      </div>
      <div class="aa-footer__col">
        <h4>Eye Care</h4>
        <ul>
          <li><a href="{% url 'content:eye_test_booking' %}">Book Free Eye Test</a></li>
          <li><a href="{% url 'content:store_locations' %}">Find a Store</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">Frame Adjustments</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">Lens Cleaning</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">Prescription Guide</a></li>
          <li><a href="{% url 'catalog:brand_list' %}">Vision Health Blog</a></li>
        </ul>
      </div>
      <div class="aa-footer__col aa-footer__newsletter">
        <h4>Newsletter</h4>
        <p>Subscribe for exclusive deals, eye care tips and new arrivals.</p>
        <div class="aa-footer__newsletter-form">
          <input type="email" placeholder="Type your e-mailâ€¦" aria-label="Email for newsletter">
          <button type="button" aria-label="Subscribe"><i class="bi bi-arrow-right"></i></button>
        </div>
        <div class="aa-footer__social">
          <a href="https://facebook.com" target="_blank" rel="noopener" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
          <a href="https://x.com" target="_blank" rel="noopener" aria-label="X / Twitter"><i class="bi bi-twitter-x"></i></a>
          <a href="https://instagram.com" target="_blank" rel="noopener" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
          <a href="https://youtube.com" target="_blank" rel="noopener" aria-label="YouTube"><i class="bi bi-youtube"></i></a>
          <a href="https://wa.me/XXXXXXXXXX" target="_blank" rel="noopener" aria-label="WhatsApp"><i class="bi bi-whatsapp"></i></a>
        </div>
        <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap;">
          <a href="#" style="display:flex;align-items:center;gap:6px;background:var(--aa-dark);color:#fff;padding:8px 14px;border-radius:8px;font-size:1.2rem;">
            <i class="bi bi-apple" style="font-size:1.8rem;"></i>
            <div><div style="font-size:.9rem;opacity:.7">Download on</div><div style="font-weight:700;">App Store</div></div>
          </a>
          <a href="#" style="display:flex;align-items:center;gap:6px;background:var(--aa-dark);color:#fff;padding:8px 14px;border-radius:8px;font-size:1.2rem;">
            <i class="bi bi-google-play" style="font-size:1.8rem;color:#0fa958;"></i>
            <div><div style="font-size:.9rem;opacity:.7">Get it on</div><div style="font-weight:700;">Google Play</div></div>
          </a>
        </div>
      </div>
    </div>

    <div class="aa-footer__bottom">
      <div class="aa-footer__bottom-inner">
        <p>Â© {% now "Y" %} Al Ameen Optics. All rights reserved. Trusted since 1927.</p>
        <div class="aa-footer__bottom-links">
          <a href="#">Privacy Policy</a>
          <a href="#">Terms of Service</a>
          <a href="#">Cookie Policy</a>
          <a href="{% url 'catalog:brand_list' %}">Sitemap</a>
        </div>
        <div class="aa-footer__payments">
          <span style="opacity:.5;font-size:1.1rem;">We accept:</span>
          <i class="bi bi-credit-card-2-front"></i>
          <i class="bi bi-paypal"></i>
          <i class="bi bi-cash-coin"></i>
          <span style="opacity:.5;font-size:1.1rem;">+ Cash on Delivery</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- ============================================================
       SCRIPTS
       ============================================================ -->
  <script>
  (function () {
    "use strict";

    // â”€â”€ Mobile menu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    var mobileMenu    = document.getElementById('aa-mobile-menu');
    var mobileOverlay = document.getElementById('aa-mobile-overlay');
    var menuToggle    = document.getElementById('aa-menu-toggle');
    var mobileClose   = document.getElementById('aa-mobile-close');

    function openMobileMenu()  { mobileMenu.classList.add('open'); mobileOverlay.classList.add('open'); document.body.style.overflow = 'hidden'; }
    function closeMobileMenu() { mobileMenu.classList.remove('open'); mobileOverlay.classList.remove('open'); document.body.style.overflow = ''; }
    if (menuToggle)    menuToggle.addEventListener('click', openMobileMenu);
    if (mobileClose)   mobileClose.addEventListener('click', closeMobileMenu);
    if (mobileOverlay) mobileOverlay.addEventListener('click', closeMobileMenu);

    function toggleMobileSub(trigger) {
      var sub  = trigger.nextElementSibling;
      var icon = trigger.querySelector('i');
      if (!sub) return;
      sub.classList.toggle('open');
      if (icon) icon.style.transform = sub.classList.contains('open') ? 'rotate(180deg)' : '';
    }
    window.toggleMobileSub = toggleMobileSub;

    function checkMobileHeader() {
      if (window.innerWidth <= 900) { if (menuToggle) menuToggle.style.display = 'flex'; }
      else { if (menuToggle) menuToggle.style.display = 'none'; closeMobileMenu(); }
    }
    checkMobileHeader();
    window.addEventListener('resize', checkMobileHeader);

    // â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showToast(message, type) {
      type = type || 'info';
      var container = document.getElementById('aa-toast-container');
      if (!container) return;
      var icons = { success: 'bi-check-circle-fill', error: 'bi-x-circle-fill', warning: 'bi-exclamation-triangle-fill', info: 'bi-info-circle-fill' };
      var toast = document.createElement('div');
      toast.className = 'aa-toast ' + type;
      toast.innerHTML = '<i class="bi ' + (icons[type] || icons.info) + '"></i><span>' + message + '</span>';
      container.appendChild(toast);
      setTimeout(function () { toast.classList.add('show'); }, 10);
      setTimeout(function () { toast.classList.remove('show'); setTimeout(function () { toast.remove(); }, 350); }, 4000);
    }
    window.showToast = showToast;

    // â”€â”€ CSRF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getCookie(name) {
      var val = null;
      if (document.cookie) {
        document.cookie.split(';').forEach(function (c) {
          c = c.trim();
          if (c.startsWith(name + '=')) val = decodeURIComponent(c.slice(name.length + 1));
        });
      }
      return val;
    }
    window.csrftoken = getCookie('csrftoken');

    // â”€â”€ Cart badge update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // This is the ONE authoritative function for updating the nav badge.
    // Product pages call window.updateCartBadge(count) after AJAX add-to-cart.
    function updateCartBadge(count) {
      var n     = parseInt(count) || 0;
      var badge = document.getElementById('aa-cart-count');
      if (!badge) return;
      badge.textContent   = n;
      badge.dataset.count = n;
      // Show or hide badge based on count
      badge.style.display = n > 0 ? 'flex' : 'none';
      // Pop animation
      badge.style.transform = 'scale(1.5)';
      setTimeout(function () { badge.style.transform = 'scale(1)'; }, 350);
    }
    window.updateCartBadge = updateCartBadge;

    // â”€â”€ Wishlist badge update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateWishlistCount(count) {
      var n     = parseInt(count) || 0;
      var badge = document.getElementById('aa-wishlist-count');
      if (!badge) return;
      badge.textContent   = n;
      badge.dataset.count = n;
      badge.style.display = n > 0 ? 'flex' : 'none';
      var link = document.getElementById('aa-wishlist-icon-link');
      if (link) { link.classList.add('aa-wishlist-pulse'); setTimeout(function() { link.classList.remove('aa-wishlist-pulse'); }, 500); }
    }
    window.updateWishlistCount = updateWishlistCount;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  AJAX ADD TO CART â€” SINGLE, DEDUPLICATED HANDLER
    //
    //  HOW IT WORKS:
    //  â€¢ We only listen on 'submit' (capturing phase).
    //  â€¢ The click listener is REMOVED â€” it was causing every
    //    button click to also trigger the submit, resulting in
    //    TWO fetch calls (double-add bug).
    //  â€¢ Product pages that need custom cart logic (sunglasses,
    //    eyeglasses with prescriptions) should call
    //    window.ajaxAddToCart(url, formData, btn) directly
    //    from their own submit handler after e.preventDefault().
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function ajaxAddToCart(url, formData, btn) {
      // Guard: prevent double-fire if already in flight
      if (btn && btn.dataset.inFlight === '1') return;
      if (btn) { btn.dataset.inFlight = '1'; btn.disabled = true; btn.style.opacity = '.6'; }

      fetch(url, {
        method: 'POST',
        headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRFToken': window.csrftoken },
        body: formData
      })
      .then(function (r) { return r.json(); })
      .then(function (data) {
        if (data.success || data.cart_count !== undefined) {
          // Always update badge with the count the server returns
          updateCartBadge(data.cart_count || 0);
          showToast(data.message || 'Added to cart!', 'success');
        } else if (data.limit || data.limit_reached) {
          showToast(data.message || 'Stock limit reached.', 'warning');
        } else {
          showToast(data.message || 'Could not add to cart.', 'error');
        }
      })
      .catch(function () { showToast('Something went wrong!', 'error'); })
      .finally(function () {
        if (btn) { delete btn.dataset.inFlight; btn.disabled = false; btn.style.opacity = '1'; }
      });
    }
    window.ajaxAddToCart = ajaxAddToCart;

    // â”€â”€ SINGLE submit listener (no duplicate click listener) â”€â”€â”€â”€â”€â”€
    //
    // Intercepts any form with class 'add-to-cart-form'.
    // Does NOT intercept forms inside #cart-rows (cart page qty forms).
    // Uses capturing (true) so it fires before the form's own onsubmit.
    document.addEventListener('submit', function (e) {
      var form = e.target;
      if (!form.classList.contains('add-to-cart-form')) return;
      // Don't intercept cart-page internal forms
      if (form.closest('#cart-rows')) return;
      e.preventDefault();
      e.stopPropagation();  // stop any other submit listeners
      var btn = form.querySelector('[type="submit"]');
      ajaxAddToCart(form.action, new FormData(form), btn);
    }, true);

    // â”€â”€ Wishlist toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.addEventListener('click', function (e) {
      var wBtn = e.target.closest('.wishlist-btn');
      if (!wBtn) return;
      e.preventDefault();
      var pid = wBtn.dataset.productId;
      fetch('/wishlist/toggle/' + pid + '/', {
        method: 'POST',
        headers: { 'X-CSRFToken': window.csrftoken }
      })
      .then(function (r) { return r.json(); })
      .then(function (data) {
        updateWishlistCount(data.wishlist_count);
        showToast(data.added ? 'Added to wishlist!' : 'Removed from wishlist.', data.added ? 'success' : 'info');
        var svg = wBtn.querySelector('svg');
        if (svg) { svg.setAttribute('fill', data.added ? 'red' : 'none'); svg.setAttribute('stroke', data.added ? 'red' : 'black'); }
      });
    });

    // â”€â”€ Auto-dismiss flash messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.querySelectorAll('.aa-message').forEach(function (msg) {
      setTimeout(function () {
        msg.style.opacity = '0';
        msg.style.transition = 'opacity .3s, transform .3s';
        msg.style.transform = 'translateY(-8px)';
        setTimeout(function () { msg.remove(); }, 300);
      }, 5000);
    });

    // â”€â”€ Show Django messages as toasts (on page load) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {% if messages %}
    document.addEventListener('DOMContentLoaded', function () {
      {% for message in messages %}
      setTimeout(function () {
        showToast("{{ message|escapejs }}", "{{ message.tags }}");
      }, {{ forloop.counter0 }} * 200);
      {% endfor %}
    });
    {% endif %}

  }());
  </script>

  {% block extra_scripts %}{% endblock %}

</div><!-- #xo-root -->

 
<script>
  window.URLS = {
    wishlistToggle: "{% url 'wishlist:toggle' 0 %}".replace('/0/', '/'),
    addToCart:      "{% url 'cart:add_to_cart' %}",
    checkout:       "{% url 'orders:checkout' %}"
  };
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  'use strict';

  /* â”€â”€ CSRF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function getCsrf() {
    var m = document.cookie.match(/(?:^|;\s*)csrftoken=([^;]+)/);
    if (m) return decodeURIComponent(m[1]);
    var meta = document.querySelector('meta[name="csrf-token"]');
    return meta ? meta.getAttribute('content') : '';
  }

  /* â”€â”€ Build wishlist URL with correct i18n prefix â”€â”€â”€ */
  function wishlistUrl(pid) {
    return window.URLS.wishlistToggle + pid + '/';
  }

  /* â”€â”€ Safe JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function safeJson(r) {
    var ct = r.headers.get('content-type') || '';
    if (!ct.includes('application/json')) {
      return Promise.resolve({ __httpStatus: r.status, __notJson: true });
    }
    return r.json().then(function (d) { d.__httpStatus = r.status; return d; });
  }

  /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  /* Use base.html's showToast â€” it's already on window */
  function toast(msg, type) {
    if (typeof window.showToast === 'function') {
      var mapped = (type === 'ok' || type === 'wish') ? 'success'
                 : type === 'err'  ? 'error'
                 : type === 'info' ? 'info' : 'info';
      window.showToast(msg, mapped);
    }
  }

  /* â”€â”€ Heart burst â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function triggerHeartBurst(btn) {
    btn.classList.add('burst');
    setTimeout(function () { btn.classList.remove('burst'); }, 450);
  }

  /* â”€â”€ Ripple â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function addRipple(btn, e) {
    if (!e || !e.clientX) return;
    var r = document.createElement('span'); r.className = 'ripple';
    var rect = btn.getBoundingClientRect();
    r.style.left = (e.clientX - rect.left - 10) + 'px';
    r.style.top  = (e.clientY - rect.top  - 10) + 'px';
    btn.appendChild(r);
    setTimeout(function () { r.remove(); }, 600);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     WISHLIST TOGGLE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  document.addEventListener('click', function (e) {
    var heartBtn = e.target.closest('.aa-pcard__heart');
    if (!heartBtn) return;
    e.preventDefault(); e.stopPropagation();

    var pid = heartBtn.dataset.productId;
    if (!pid || pid === 'undefined' || pid === '') {
      heartBtn.classList.toggle('wishlisted');
      triggerHeartBurst(heartBtn);
      toast('â¤ï¸ Saved!', 'wish');
      return;
    }

    var wasWishlisted = heartBtn.classList.contains('wishlisted');
    heartBtn.classList.toggle('wishlisted');
    triggerHeartBurst(heartBtn);
    heartBtn.style.pointerEvents = 'none';

    var csrf = getCsrf();
    fetch(wishlistUrl(pid), {
      method: 'POST', credentials: 'same-origin',
      headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRFToken': csrf, 'Content-Type': 'application/x-www-form-urlencoded' },
      body: 'csrfmiddlewaretoken=' + encodeURIComponent(csrf)
    })
    .then(function (r) {
      if (r.status === 401) {
        wasWishlisted ? heartBtn.classList.add('wishlisted') : heartBtn.classList.remove('wishlisted');
        toast('ðŸ’› Please log in to save items to your wishlist.', 'info');
        heartBtn.style.pointerEvents = ''; return null;
      }
      return safeJson(r);
    })
    .then(function (data) {
      if (!data) return;
      if (data.__notJson || data.error) {
        wasWishlisted ? heartBtn.classList.add('wishlisted') : heartBtn.classList.remove('wishlisted');
        toast(data.message || 'Something went wrong.', 'err');
        heartBtn.style.pointerEvents = ''; return;
      }
      /* âœ… Use base.html's updateWishlistCount */
      if (typeof window.updateWishlistCount === 'function') {
        window.updateWishlistCount(data.wishlist_count);
      }
      toast(data.added ? 'â¤ï¸ Added to wishlist!' : 'ðŸ’” Removed from wishlist.', data.added ? 'wish' : 'info');
      document.querySelectorAll('.aa-pcard__heart[data-product-id="' + pid + '"]').forEach(function (b) {
        data.added ? b.classList.add('wishlisted') : b.classList.remove('wishlisted');
        b.style.pointerEvents = '';
      });
    })
    .catch(function () {
      wasWishlisted ? heartBtn.classList.add('wishlisted') : heartBtn.classList.remove('wishlisted');
      toast('Network error. Please try again.', 'err');
      heartBtn.style.pointerEvents = '';
    });
  });

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADD TO CART
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     âš ï¸  NO submit listener here.
     base.html already has ONE submit listener for
     .add-to-cart-form (capturing phase). Adding another
     here caused EVERY cart add to fire TWICE (double-add
     bug seen on home page). base.html's handler calls
     window.ajaxAddToCart() which calls
     window.updateCartBadge() automatically.

     We only need to handle BUY NOW (click, not submit).
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  /* â”€â”€ BUY NOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  document.addEventListener('click', function (e) {
    var buyBtn = e.target.closest('.aa-pcard__buy-btn[data-product-id]');
    if (!buyBtn) return;
    e.preventDefault();
    var pid = buyBtn.dataset.productId;
    var orig = buyBtn.innerHTML;
    buyBtn.innerHTML = 'â³ Please waitâ€¦';
    buyBtn.style.pointerEvents = 'none';

    fetch(window.URLS.addToCart, {
      method: 'POST', credentials: 'same-origin',
      headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRFToken': getCsrf(), 'Content-Type': 'application/x-www-form-urlencoded' },
      body: 'product_id=' + encodeURIComponent(pid) + '&quantity=1'
    })
    .then(function (r) { return safeJson(r); })
    .then(function (data) {
      if (data.success) {
        /* âœ… Update nav badge before redirecting */
        if (typeof window.updateCartBadge === 'function') {
          window.updateCartBadge(data.cart_count || 0);
        }
        window.location.href = window.URLS.checkout;
      } else {
        toast(data.message || 'Could not process.', 'err');
        buyBtn.innerHTML = orig; buyBtn.style.pointerEvents = '';
      }
    })
    .catch(function () {
      toast('Network error.', 'err');
      buyBtn.innerHTML = orig; buyBtn.style.pointerEvents = '';
    });
  });

  /* â”€â”€ Color swatches â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  document.addEventListener('click', function (e) {
    var dot = e.target.closest('.aa-pcard__color-dot');
    if (!dot) return;
    e.preventDefault(); e.stopPropagation();
    var p = dot.closest('.aa-pcard__colors');
    if (p) p.querySelectorAll('.aa-pcard__color-dot').forEach(function (d) { d.classList.remove('active'); });
    dot.classList.add('active');
  });

  /* â”€â”€ Brands Carousel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  var track = document.querySelector('.our-brands-carousel-track');
  var prevBtn = document.querySelector('.brands-carousel-prev');
  var nextBtn = document.querySelector('.brands-carousel-next');
  if (track && prevBtn && nextBtn) {
    var items = track.querySelectorAll('.brand-carousel-item');
    var gap = 60, currentPos = 0, autoTimer;
    function getStep() { return (items[0] ? items[0].offsetWidth : 180) + gap; }
    function getMax() { return -(getStep() * Math.max(0, items.length - 4)); }
    function slide() { track.style.transform = 'translateX(' + currentPos + 'px)'; }
    function scrollNext() { currentPos = currentPos > getMax() ? currentPos - getStep() : 0; slide(); }
    function scrollPrev() { currentPos = currentPos < 0 ? currentPos + getStep() : getMax(); slide(); }
    nextBtn.addEventListener('click', function () { scrollNext(); resetAuto(); });
    prevBtn.addEventListener('click', function () { scrollPrev(); resetAuto(); });
    function startAuto() { autoTimer = setInterval(scrollNext, 3000); }
    function stopAuto() { clearInterval(autoTimer); }
    function resetAuto() { stopAuto(); startAuto(); }
    startAuto();
    track.addEventListener('mouseenter', stopAuto);
    track.addEventListener('mouseleave', startAuto);
    window.addEventListener('resize', function () { currentPos = 0; slide(); });
  }

  /* â”€â”€ Scroll reveal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  if ('IntersectionObserver' in window) {
    var cards = document.querySelectorAll('.aa-pcard');
    cards.forEach(function (c) {
      c.style.opacity = '0'; c.style.transform = 'translateY(24px)';
      c.style.transition = 'opacity .5s ease,transform .5s ease';
    });
    var io = new IntersectionObserver(function (entries) {
      entries.forEach(function (entry) {
        if (entry.isIntersecting) {
          setTimeout(function () { entry.target.style.opacity = '1'; entry.target.style.transform = 'translateY(0)'; }, 60);
          io.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });
    cards.forEach(function (c) { io.observe(c); });
  }

});
</script>
<script id="aa-search-js">
(function () {
  'use strict';

  /* â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  var AUTOCOMPLETE_URL = '/search/autocomplete/';  // adjust if needed
  /* Try to get from Django URL tag via a hidden element */
  try {
    var _u = document.getElementById('aa-autocomplete-url');
    if (_u) AUTOCOMPLETE_URL = _u.dataset.url;
  } catch(e) {}

  var DEBOUNCE_MS = 250;
  var MIN_CHARS   = 2;

  /* Type icons map */
  var TYPE_ICONS = {
    product:  'ðŸ‘“',
    brand:    'ðŸ·ï¸',
    category: 'ðŸ“‚',
    popular:  'ðŸ”¥',
    recent:   'ðŸ•'
  };

  /* â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function debounce(fn, ms) {
    var t;
    return function() {
      var args = arguments, ctx = this;
      clearTimeout(t);
      t = setTimeout(function() { fn.apply(ctx, args); }, ms);
    };
  }

  function escHtml(s) {
    return String(s)
      .replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  function highlightQuery(text, query) {
    if (!query) return escHtml(text);
    var esc = query.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    return escHtml(text).replace(
      new RegExp('(' + esc + ')', 'gi'),
      '<mark>$1</mark>'
    );
  }

  /* â”€â”€ Recent searches (localStorage) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  var RECENT_KEY = 'aa_recent_searches';
  function getRecent() {
    try { return JSON.parse(localStorage.getItem(RECENT_KEY) || '[]'); }
    catch(e) { return []; }
  }
  function addRecent(q) {
    if (!q || q.length < 2) return;
    var list = getRecent().filter(function(x) { return x.toLowerCase() !== q.toLowerCase(); });
    list.unshift(q);
    list = list.slice(0, 5);
    try { localStorage.setItem(RECENT_KEY, JSON.stringify(list)); } catch(e) {}
  }
  function removeRecent(q) {
    var list = getRecent().filter(function(x) { return x !== q; });
    try { localStorage.setItem(RECENT_KEY, JSON.stringify(list)); } catch(e) {}
  }

  /* â”€â”€ Render helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function renderLoading() {
    return '<div class="aa-dd-loading"><div class="aa-dd-spinner"></div>Searchingâ€¦</div>';
  }

  function renderEmpty(q) {
    return '<div class="aa-dd-empty"><span>ðŸ”</span>No results for "<strong>' + escHtml(q) + '</strong>"</div>';
  }

  function renderProductItem(s, q) {
    return '<a class="aa-dd-item" href="' + escHtml(s.url) + '" role="option">' +
      (s.image
        ? '<img class="aa-dd-thumb" src="' + escHtml(s.image) + '" alt="" loading="lazy">'
        : '<div class="aa-dd-icon">' + (TYPE_ICONS.product) + '</div>') +
      '<div class="aa-dd-text">' +
        '<div class="aa-dd-name">' + highlightQuery(s.name, q) + '</div>' +
        (s.brand ? '<div class="aa-dd-sub">' + escHtml(s.brand) + '</div>' : '') +
      '</div>' +
      (s.price ? '<span class="aa-dd-price">' + escHtml(s.price) + ' QAR</span>' : '') +
    '</a>';
  }

  function renderBrandItem(s, q) {
    return '<a class="aa-dd-item" href="' + escHtml(s.url) + '" role="option">' +
      '<div class="aa-dd-icon">ðŸ·ï¸</div>' +
      '<div class="aa-dd-text"><div class="aa-dd-name">' + highlightQuery(s.name, q) + '</div></div>' +
      '<span class="aa-dd-badge aa-dd-badge--brand">Brand</span>' +
    '</a>';
  }

  function renderCategoryItem(s, q) {
    return '<a class="aa-dd-item" href="' + escHtml(s.url) + '" role="option">' +
      '<div class="aa-dd-icon">ðŸ“‚</div>' +
      '<div class="aa-dd-text"><div class="aa-dd-name">' + highlightQuery(s.name, q) + '</div></div>' +
      '<span class="aa-dd-badge aa-dd-badge--category">Category</span>' +
    '</a>';
  }

  function renderPopularItem(s, q) {
    return '<a class="aa-dd-item" href="' + escHtml(s.url) + '" role="option">' +
      '<div class="aa-dd-icon">ðŸ”¥</div>' +
      '<div class="aa-dd-text"><div class="aa-dd-name">' + highlightQuery(s.name, q) + '</div></div>' +
      '<span class="aa-dd-badge aa-dd-badge--popular">Popular</span>' +
    '</a>';
  }

  function renderItem(s, q) {
    switch (s.type) {
      case 'product':  return renderProductItem(s, q);
      case 'brand':    return renderBrandItem(s, q);
      case 'category': return renderCategoryItem(s, q);
      case 'popular':  return renderPopularItem(s, q);
      default:         return renderPopularItem(s, q);
    }
  }

  function renderPopularState() {
    var recent = getRecent();
    var html = '';

    if (recent.length) {
      html += '<div class="aa-dd-section-label">Recent</div>';
      recent.forEach(function(r) {
        html += '<div class="aa-dd-item" data-recent="' + escHtml(r) + '" role="option" tabindex="0" style="cursor:pointer">' +
          '<div class="aa-dd-icon">ðŸ•</div>' +
          '<div class="aa-dd-text"><div class="aa-dd-name">' + escHtml(r) + '</div></div>' +
          '<button class="aa-dd-recent-remove" data-remove="' + escHtml(r) + '" title="Remove" aria-label="Remove">Ã—</button>' +
        '</div>';
      });
    }

    html += '<div class="aa-dd-section-label">Popular</div>';
    var popularTerms = ['Ray-Ban', 'Oakley', 'Contact Lenses', 'Progressive Lenses', 'Kids Glasses', 'Sunglasses', 'Reading Glasses'];
    html += '<div class="aa-dd-pills">';
    popularTerms.forEach(function(t) {
      html += '<a class="aa-dd-pill" href="/search/?q=' + encodeURIComponent(t) + '">ðŸ”¥ ' + escHtml(t) + '</a>';
    });
    html += '</div>';
    return html;
  }

  function renderResults(suggestions, q) {
    if (!suggestions || !suggestions.length) return renderEmpty(q);

    var products   = suggestions.filter(function(s) { return s.type === 'product'; });
    var brands     = suggestions.filter(function(s) { return s.type === 'brand'; });
    var categories = suggestions.filter(function(s) { return s.type === 'category'; });
    var popular    = suggestions.filter(function(s) { return s.type === 'popular'; });
    var html = '';

    if (products.length) {
      html += '<div class="aa-dd-section-label">Products</div>';
      products.forEach(function(s) { html += renderItem(s, q); });
    }
    if (brands.length) {
      html += '<div class="aa-dd-section-label">Brands</div>';
      brands.forEach(function(s) { html += renderItem(s, q); });
    }
    if (categories.length) {
      html += '<div class="aa-dd-section-label">Categories</div>';
      categories.forEach(function(s) { html += renderItem(s, q); });
    }
    if (popular.length) {
      html += '<div class="aa-dd-section-label">Suggestions</div>';
      popular.forEach(function(s) { html += renderItem(s, q); });
    }

    html += '<a class="aa-dd-viewall" href="/search/?q=' + encodeURIComponent(q) + '">' +
      '<i class="bi bi-search"></i> See all results for "' + escHtml(q) + '"' +
    '</a>';
    return html;
  }

  /* â”€â”€ Core search controller â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function SearchController(inputEl, dropdownEl, wrapEl) {
    var self        = this;
    self.input      = inputEl;
    self.dropdown   = dropdownEl;
    self.wrap       = wrapEl;
    self.lastQ      = '';
    self.abortCtrl  = null;
    self.highlighted = -1;
    self._items     = [];

    /* â”€â”€ Open/close â”€â”€ */
    self.open = function(html, classes) {
      self.dropdown.innerHTML = html || '';
      self.dropdown.className = 'aa-search-dropdown ' + (classes || '');
      // Bind events to new items
      self._items = self.dropdown.querySelectorAll('.aa-dd-item');
      self.highlighted = -1;

      // Recent remove buttons
      self.dropdown.querySelectorAll('.aa-dd-recent-remove').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
          e.preventDefault(); e.stopPropagation();
          var q = btn.dataset.remove;
          removeRecent(q);
          // re-render popular state
          self.open(renderPopularState(), 'show-popular');
        });
      });

      // Recent item click
      self.dropdown.querySelectorAll('[data-recent]').forEach(function(item) {
        item.addEventListener('click', function() {
          self.input.value = item.dataset.recent;
          self.input.form && self.input.form.submit();
        });
        item.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') { self.input.value = item.dataset.recent; self.input.form && self.input.form.submit(); }
        });
      });
    };

    self.close = function() {
      self.dropdown.className = 'aa-search-dropdown';
      self.dropdown.innerHTML = '';
      self.highlighted = -1;
      self._items = [];
    };

    /* â”€â”€ Highlight arrows â”€â”€ */
    self.moveHighlight = function(dir) {
      self._items = self.dropdown.querySelectorAll('.aa-dd-item');
      var max = self._items.length;
      if (!max) return;
      if (self.highlighted >= 0) self._items[self.highlighted].classList.remove('highlighted');
      self.highlighted = (self.highlighted + dir + max) % max;
      var el = self._items[self.highlighted];
      el.classList.add('highlighted');
      el.scrollIntoView({ block: 'nearest' });
      // Fill input with name if navigating
      var name = el.querySelector('.aa-dd-name');
      if (name) self.input.value = name.textContent.trim();
    };

    /* â”€â”€ Fetch â”€â”€ */
    self.fetch = function(q) {
      if (self.abortCtrl) { try { self.abortCtrl.abort(); } catch(e) {} }
      if (typeof AbortController !== 'undefined') self.abortCtrl = new AbortController();

      var url = AUTOCOMPLETE_URL + '?q=' + encodeURIComponent(q);
      var opts = self.abortCtrl ? { signal: self.abortCtrl.signal } : {};

      fetch(url, opts)
        .then(function(r) { return r.json(); })
        .then(function(data) {
          var html = renderResults(data.suggestions, q);
          self.open(html, 'has-results');
        })
        .catch(function(e) {
          if (e && e.name === 'AbortError') return;
          self.open(renderEmpty(q), 'has-results');
        });
    };

    /* â”€â”€ Input handler â”€â”€ */
    self.onInput = debounce(function() {
      var q = self.input.value.trim();
      self.updateWrapState();
      if (q === self.lastQ) return;
      self.lastQ = q;

      if (q.length < MIN_CHARS) {
        if (q.length === 0) {
          self.open(renderPopularState(), 'show-popular');
        } else {
          self.close();
        }
        return;
      }
      self.open(renderLoading(), 'has-results');
      self.fetch(q);
    }, DEBOUNCE_MS);

    self.updateWrapState = function() {
      var q = self.input.value.trim();
      self.wrap.classList.toggle('has-value', q.length > 0);
      self.wrap.classList.toggle('empty', q.length === 0);
    };

    /* â”€â”€ Bind events â”€â”€ */
    self.input.addEventListener('input', self.onInput);

    self.input.addEventListener('focus', function() {
      self.wrap.classList.add('focused');
      self.updateWrapState();
      var q = self.input.value.trim();
      if (q.length === 0) {
        self.open(renderPopularState(), 'show-popular');
      } else if (q.length >= MIN_CHARS) {
        self.open(renderLoading(), 'has-results');
        self.fetch(q);
      }
    });

    self.input.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowDown')  { e.preventDefault(); self.moveHighlight(1); }
      if (e.key === 'ArrowUp')    { e.preventDefault(); self.moveHighlight(-1); }
      if (e.key === 'Escape')     { self.close(); self.wrap.classList.remove('focused'); self.input.blur(); }
      if (e.key === 'Enter')      { addRecent(self.input.value.trim()); }
    });

    self.input.form && self.input.form.addEventListener('submit', function() {
      addRecent(self.input.value.trim());
    });

    /* Clear button */
    var clearBtn = self.wrap.querySelector('.aa-search-clear');
    if (clearBtn) {
      clearBtn.addEventListener('click', function() {
        self.input.value = '';
        self.lastQ = '';
        self.updateWrapState();
        self.input.focus();
        self.open(renderPopularState(), 'show-popular');
      });
    }

    /* Close on outside click */
    document.addEventListener('click', function(e) {
      if (!self.wrap.contains(e.target)) {
        self.close();
        self.wrap.classList.remove('focused');
      }
    });
  }

  /* â”€â”€ Mobile simplified controller â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function MobileSearchController(inputEl, dropdownEl, wrapEl) {
    var self = this;
    self.input    = inputEl;
    self.dropdown = dropdownEl;
    self.wrap     = wrapEl;

    var fetchDebounced = debounce(function(q) {
      if (q.length < MIN_CHARS) { self.dropdown.classList.remove('open'); return; }
      self.dropdown.innerHTML = renderLoading();
      self.dropdown.classList.add('open');
      fetch(AUTOCOMPLETE_URL + '?q=' + encodeURIComponent(q))
        .then(function(r) { return r.json(); })
        .then(function(data) {
          self.dropdown.innerHTML = renderResults(data.suggestions, q);
          self.dropdown.classList.add('open');
          // bind submit on anchor clicks to track recent
          self.dropdown.querySelectorAll('.aa-dd-item[href]').forEach(function(a) {
            a.addEventListener('click', function() { addRecent(q); });
          });
        })
        .catch(function() { self.dropdown.classList.remove('open'); });
    }, DEBOUNCE_MS);

    self.input.addEventListener('input', function() {
      fetchDebounced(self.input.value.trim());
    });

    self.input.form && self.input.form.addEventListener('submit', function() {
      addRecent(self.input.value.trim());
    });

    document.addEventListener('click', function(e) {
      if (!self.wrap.contains(e.target)) self.dropdown.classList.remove('open');
    });
  }

  /* â”€â”€ Init on DOMContentLoaded â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  document.addEventListener('DOMContentLoaded', function() {
    /* Desktop */
    var di = document.getElementById('aa-search-input-desktop');
    var dd = document.getElementById('aa-search-dropdown-desktop');
    var dw = document.getElementById('aa-search-wrap-desktop');
    if (di && dd && dw) {
      new SearchController(di, dd, dw);
    }

    /* Mobile */
    var mi = document.getElementById('aa-mobile-search-input');
    var md = document.getElementById('aa-mobile-dd');
    var mw = document.getElementById('aa-mobile-search-wrap');
    if (mi && md && mw) {
      new MobileSearchController(mi, md, mw);
    }
  });

}());
</script>

<style>@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}</style>
 
</body>
</html>