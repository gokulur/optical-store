 

<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AL AMEEN ‚Äî PRODUCT REVIEWS SECTION
   Self-contained. Drop into any detail page.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap');

.prv-section {
  --ink: #0d0d0d;
  --ink-soft: #4a4a4a;
  --muted: #888;
  --sand: #f7f3ed;
  --gold: #b8976a;
  --gold-lt: rgba(184,151,106,.12);
  --green: #1a7a4a;
  --green-bg: #ebf7f1;
  --border: #e8e2d8;
  --radius: 14px;
  --shadow-sm: 0 2px 12px rgba(0,0,0,.06);
  --shadow-md: 0 8px 32px rgba(0,0,0,.1);
  font-family: 'DM Sans', sans-serif;
  margin: 0;
  padding: 64px 0 0;
  border-top: 1px solid var(--border);
}

/* Section Header */
.prv-header {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 20px;
  margin-bottom: 40px;
  flex-wrap: wrap;
}
.prv-header-left h2 {
  font-family: 'Syne', sans-serif;
  font-size: clamp(26px, 3vw, 38px);
  font-weight: 800;
  color: var(--ink);
  letter-spacing: -.04em;
  margin: 0 0 6px;
  line-height: 1;
}
.prv-header-subtitle {
  font-size: 13px;
  color: var(--muted);
  font-weight: 400;
}
.prv-write-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--ink);
  color: #fff;
  text-decoration: none;
  padding: 13px 24px;
  border-radius: 50px;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: .03em;
  transition: all .25s;
  border: 2px solid var(--ink);
  white-space: nowrap;
  font-family: 'DM Sans', sans-serif;
  cursor: pointer;
}
.prv-write-btn:hover {
  background: transparent;
  color: var(--ink);
}
.prv-write-btn svg { flex-shrink: 0; }

/* ‚îÄ‚îÄ SUMMARY STRIP ‚îÄ‚îÄ */
.prv-summary {
  display: grid;
  grid-template-columns: 200px 1fr;
  gap: 32px;
  background: var(--sand);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 28px 32px;
  margin-bottom: 32px;
  align-items: center;
}
@media (max-width: 640px) {
  .prv-summary { grid-template-columns: 1fr; padding: 20px; gap: 20px; }
}

.prv-avg-block {
  text-align: center;
  padding-right: 32px;
  border-right: 1px solid var(--border);
}
@media (max-width: 640px) {
  .prv-avg-block { padding-right: 0; border-right: none; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
}
.prv-avg-num {
  font-family: 'Syne', sans-serif;
  font-size: 72px;
  font-weight: 800;
  color: var(--ink);
  line-height: 1;
  letter-spacing: -.06em;
}
.prv-avg-stars {
  display: flex;
  justify-content: center;
  gap: 3px;
  margin: 8px 0 6px;
}
.prv-avg-stars .star { font-size: 18px; }
.prv-avg-stars .star.on { color: #f59e0b; }
.prv-avg-stars .star.off { color: #e0dbd2; }
.prv-avg-label { font-size: 12px; color: var(--muted); font-weight: 500; }

/* Bars */
.prv-bars { display: flex; flex-direction: column; gap: 8px; }
.prv-bar-row {
  display: grid;
  grid-template-columns: 52px 1fr 28px;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  padding: 3px 6px;
  border-radius: 8px;
  transition: background .18s;
}
.prv-bar-row:hover { background: rgba(255,255,255,.7); }
.prv-bar-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--ink-soft);
  display: flex;
  align-items: center;
  gap: 4px;
}
.prv-bar-label .s { color: #f59e0b; font-size: 13px; }
.prv-bar-track {
  height: 7px;
  background: rgba(0,0,0,.07);
  border-radius: 99px;
  overflow: hidden;
}
.prv-bar-fill {
  height: 100%;
  border-radius: 99px;
  background: linear-gradient(90deg, #f59e0b, #f97316);
  width: 0%;
  transition: width 1.1s cubic-bezier(.34,1.2,.64,1);
}
.prv-bar-count { font-size: 11px; color: var(--muted); text-align: right; font-weight: 500; }

/* ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ */
.prv-filter-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
  margin-bottom: 20px;
  flex-wrap: wrap;
  padding: 14px 18px;
  background: #fff;
  border-radius: 10px;
  border: 1px solid var(--border);
}
.prv-filter-left { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.prv-filter-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 14px;
  border-radius: 50px;
  font-size: 12px;
  font-weight: 600;
  border: 1.5px solid var(--border);
  background: #fff;
  color: var(--ink-soft);
  cursor: pointer;
  transition: all .2s;
  font-family: 'DM Sans', sans-serif;
}
.prv-filter-chip:hover, .prv-filter-chip.active {
  border-color: var(--ink);
  background: var(--ink);
  color: #fff;
}
.prv-filter-chip .chip-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: #f59e0b;
  display: none;
}
.prv-filter-chip.active .chip-dot { display: block; background: #fff; }

.prv-sort-wrap { display: flex; align-items: center; gap: 8px; }
.prv-sort-label { font-size: 12px; color: var(--muted); white-space: nowrap; }
.prv-sort-select {
  border: 1.5px solid var(--border);
  border-radius: 8px;
  padding: 7px 28px 7px 11px;
  font-size: 12px;
  font-weight: 600;
  color: var(--ink);
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E") no-repeat right 8px center #fff;
  appearance: none;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  outline: none;
}
.prv-sort-select:focus { border-color: var(--ink); }

/* ‚îÄ‚îÄ REVIEW CARDS ‚îÄ‚îÄ */
.prv-list { display: flex; flex-direction: column; gap: 16px; }

.prv-card {
  background: #fff;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 24px;
  transition: box-shadow .25s, transform .25s;
  position: relative;
  overflow: hidden;
}
.prv-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}
.prv-card--featured {
  border-color: var(--gold);
  background: linear-gradient(135deg, #fffcf7 0%, #fff 100%);
}
.prv-card--featured::before {
  content: '‚ú¶ Featured';
  position: absolute;
  top: 0; right: 0;
  background: var(--gold);
  color: #fff;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: .1em;
  padding: 4px 12px;
  border-radius: 0 var(--radius) 0 8px;
}

/* Card Top */
.prv-card-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 14px;
  margin-bottom: 14px;
}
.prv-card-left { display: flex; align-items: center; gap: 12px; }

.prv-avatar {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--ink) 0%, #3a3a4a 100%);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Syne', sans-serif;
  font-size: 15px;
  font-weight: 700;
  flex-shrink: 0;
  text-transform: uppercase;
  letter-spacing: .05em;
}
/* Color variants for avatars */
.prv-avatar[data-color="1"] { background: linear-gradient(135deg, #1a4a7a, #2d6ca8); }
.prv-avatar[data-color="2"] { background: linear-gradient(135deg, #4a1a2a, #8a3050); }
.prv-avatar[data-color="3"] { background: linear-gradient(135deg, #1a4a2a, #2a7a4a); }
.prv-avatar[data-color="4"] { background: linear-gradient(135deg, #4a3a1a, #8a6a30); }
.prv-avatar[data-color="5"] { background: linear-gradient(135deg, #2a1a4a, #5a3a8a); }

.prv-reviewer-name {
  font-family: 'Syne', sans-serif;
  font-size: 14px;
  font-weight: 700;
  color: var(--ink);
  margin-bottom: 4px;
}
.prv-badges { display: flex; gap: 5px; flex-wrap: wrap; }
.prv-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: .06em;
  text-transform: uppercase;
  padding: 3px 9px;
  border-radius: 99px;
}
.prv-badge--verified { background: var(--green-bg); color: var(--green); }
.prv-badge--pending { background: #fff7ed; color: #b45309; }

.prv-card-right { text-align: right; flex-shrink: 0; }
.prv-stars { display: flex; gap: 2px; justify-content: flex-end; margin-bottom: 5px; }
.prv-stars .star { font-size: 16px; }
.prv-stars .star.on { color: #f59e0b; }
.prv-stars .star.off { color: #e0dbd2; }
.prv-date { font-size: 11px; color: var(--muted); }

/* Card Body */
.prv-card-title {
  font-family: 'Syne', sans-serif;
  font-size: 16px;
  font-weight: 700;
  color: var(--ink);
  margin: 0 0 8px;
  letter-spacing: -.02em;
}
.prv-card-comment {
  font-size: 14px;
  line-height: 1.75;
  color: var(--ink-soft);
}
.prv-read-more {
  display: inline-block;
  margin-top: 6px;
  color: var(--gold);
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  border: none;
  background: none;
  padding: 0;
  font-family: 'DM Sans', sans-serif;
  text-decoration: underline;
  text-underline-offset: 2px;
}

/* Review Images */
.prv-card-images {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 14px;
}
.prv-img-thumb {
  width: 72px;
  height: 72px;
  border-radius: 8px;
  overflow: hidden;
  border: 1.5px solid var(--border);
  cursor: pointer;
  transition: all .2s;
  flex-shrink: 0;
}
.prv-img-thumb:hover { border-color: var(--gold); transform: scale(1.05); }
.prv-img-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }

/* Card Footer */
.prv-card-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-top: 14px;
  margin-top: 16px;
  border-top: 1px solid #f0ede8;
  flex-wrap: wrap;
  gap: 10px;
}
.prv-helpful-label { font-size: 12px; color: var(--muted); }
.prv-helpful-btns { display: flex; gap: 8px; align-items: center; }
.prv-helpful-btn {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 6px 13px;
  border-radius: 50px;
  border: 1.5px solid var(--border);
  background: #fff;
  font-size: 12px;
  font-weight: 600;
  color: var(--ink-soft);
  cursor: pointer;
  transition: all .2s;
  font-family: 'DM Sans', sans-serif;
}
.prv-helpful-btn:hover { border-color: var(--ink); color: var(--ink); }
.prv-helpful-btn.yes:hover { border-color: var(--green); color: var(--green); background: var(--green-bg); }
.prv-helpful-btn.no:hover { border-color: #dc2626; color: #dc2626; background: #fef2f2; }
.prv-helpful-btn.voted-yes { background: var(--green-bg); border-color: var(--green); color: var(--green); }
.prv-helpful-btn.voted-no { background: #fef2f2; border-color: #dc2626; color: #dc2626; }

.prv-owner-btns { display: flex; gap: 7px; }
.prv-btn-edit {
  font-size: 12px;
  font-weight: 700;
  color: #6366f1;
  text-decoration: none;
  padding: 6px 13px;
  border: 1.5px solid #6366f1;
  border-radius: 50px;
  transition: all .2s;
}
.prv-btn-edit:hover { background: #6366f1; color: #fff; }
.prv-btn-del {
  font-size: 12px;
  font-weight: 700;
  color: #dc2626;
  border: 1.5px solid #dc2626;
  border-radius: 50px;
  padding: 6px 13px;
  background: #fff;
  cursor: pointer;
  transition: all .2s;
  font-family: 'DM Sans', sans-serif;
}
.prv-btn-del:hover { background: #dc2626; color: #fff; }

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.prv-empty {
  text-align: center;
  padding: 64px 30px;
  background: var(--sand);
  border-radius: var(--radius);
  border: 1px dashed var(--border);
}
.prv-empty-icon {
  width: 72px; height: 72px;
  margin: 0 auto 18px;
  background: #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow-sm);
}
.prv-empty h3 {
  font-family: 'Syne', sans-serif;
  font-size: 22px;
  font-weight: 700;
  color: var(--ink);
  margin: 0 0 8px;
}
.prv-empty p { font-size: 14px; color: var(--muted); margin: 0 0 24px; }
.prv-empty-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--ink);
  color: #fff;
  text-decoration: none;
  padding: 13px 28px;
  border-radius: 50px;
  font-size: 13px;
  font-weight: 600;
  transition: all .25s;
  font-family: 'DM Sans', sans-serif;
}
.prv-empty-btn:hover { background: #2a2a2a; transform: translateY(-2px); }

/* ‚îÄ‚îÄ LOGIN NUDGE ‚îÄ‚îÄ */
.prv-login-nudge {
  display: flex;
  align-items: center;
  gap: 16px;
  background: linear-gradient(135deg, #f7f3ed, #fff);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px 22px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}
.prv-login-nudge-text { flex: 1; min-width: 160px; }
.prv-login-nudge-text strong { display: block; font-size: 14px; font-weight: 700; color: var(--ink); margin-bottom: 2px; }
.prv-login-nudge-text span { font-size: 12px; color: var(--muted); }
.prv-login-link {
  display: inline-flex;
  align-items: center;
  gap: 7px;
  background: var(--ink);
  color: #fff;
  text-decoration: none;
  padding: 10px 20px;
  border-radius: 50px;
  font-size: 12px;
  font-weight: 700;
  white-space: nowrap;
  transition: background .2s;
}
.prv-login-link:hover { background: #2a2a2a; color: #fff; }

/* ‚îÄ‚îÄ WRITE REVIEW INLINE FORM ‚îÄ‚îÄ */
.prv-write-section {
  background: linear-gradient(135deg, #0d0d0d 0%, #1a1a2e 100%);
  border-radius: var(--radius);
  padding: 32px;
  margin-bottom: 28px;
  color: #fff;
  position: relative;
  overflow: hidden;
}
.prv-write-section::before {
  content: '';
  position: absolute;
  top: -40px; right: -40px;
  width: 180px; height: 180px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(184,151,106,.2) 0%, transparent 70%);
  pointer-events: none;
}
.prv-write-section h3 {
  font-family: 'Syne', sans-serif;
  font-size: 20px;
  font-weight: 700;
  margin: 0 0 5px;
}
.prv-write-section p { font-size: 13px; color: rgba(255,255,255,.5); margin: 0 0 24px; }

/* Star Rating Picker */
.prv-star-picker {
  display: flex;
  gap: 6px;
  margin-bottom: 20px;
}
.prv-star-pick {
  font-size: 30px;
  cursor: pointer;
  color: rgba(255,255,255,.2);
  transition: all .15s;
  line-height: 1;
  user-select: none;
}
.prv-star-pick:hover, .prv-star-pick.active { color: #f59e0b; transform: scale(1.15); }

.prv-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
@media (max-width: 560px) { .prv-form-grid { grid-template-columns: 1fr; } }
.prv-form-grid.full { grid-column: 1 / -1; }

.prv-input, .prv-textarea {
  width: 100%;
  padding: 12px 16px;
  border-radius: 10px;
  border: 1.5px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.07);
  color: #fff;
  font-size: 14px;
  font-family: 'DM Sans', sans-serif;
  outline: none;
  transition: border-color .2s;
  box-sizing: border-box;
}
.prv-input::placeholder, .prv-textarea::placeholder { color: rgba(255,255,255,.3); }
.prv-input:focus, .prv-textarea:focus { border-color: var(--gold); background: rgba(255,255,255,.1); }
.prv-textarea { resize: vertical; min-height: 90px; }

.prv-form-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 16px; }
.prv-submit-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--gold);
  color: #fff;
  border: none;
  padding: 13px 28px;
  border-radius: 50px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  transition: all .25s;
  letter-spacing: .02em;
}
.prv-submit-btn:hover { background: #a07050; transform: translateY(-1px); }

/* ‚îÄ‚îÄ PAGINATION ‚îÄ‚îÄ */
.prv-pagination {
  display: flex;
  justify-content: center;
  gap: 7px;
  margin-top: 28px;
  flex-wrap: wrap;
}
.prv-pg-btn {
  width: 38px; height: 38px;
  border-radius: 8px;
  border: 1.5px solid var(--border);
  background: #fff;
  color: var(--ink-soft);
  font-size: 13px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  transition: all .2s;
  font-family: 'DM Sans', sans-serif;
  cursor: pointer;
}
.prv-pg-btn:hover, .prv-pg-btn.current {
  background: var(--ink); border-color: var(--ink); color: #fff;
}
.prv-pg-btn.disabled { opacity: .3; pointer-events: none; }

/* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
.prv-lb {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 99999;
  background: rgba(5,5,10,.95);
  backdrop-filter: blur(16px);
  align-items: center;
  justify-content: center;
  flex-direction: column;
}
.prv-lb.open { display: flex; }
.prv-lb-img { max-width: 90vw; max-height: 82vh; object-fit: contain; border-radius: 12px; }
.prv-lb-close {
  position: fixed; top: 20px; right: 24px;
  width: 44px; height: 44px;
  border-radius: 50%;
  background: rgba(255,255,255,.1);
  border: 1px solid rgba(255,255,255,.15);
  color: #fff;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 22px; line-height: 1;
}

/* ‚îÄ‚îÄ DELETE MODAL ‚îÄ‚îÄ */
.prv-del-modal {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 99998;
  background: rgba(0,0,0,.5);
  backdrop-filter: blur(3px);
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.prv-del-modal.open { display: flex; }
.prv-del-box {
  background: #fff;
  border-radius: 18px;
  padding: 36px 32px;
  max-width: 360px;
  width: 100%;
  text-align: center;
  box-shadow: 0 24px 80px rgba(0,0,0,.2);
}
.prv-del-box-icon {
  width: 60px; height: 60px;
  background: #fef2f2;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 16px;
  font-size: 26px;
}
.prv-del-box h3 { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; margin: 0 0 8px; }
.prv-del-box p { font-size: 13px; color: var(--muted); margin: 0 0 24px; }
.prv-del-box-btns { display: flex; gap: 10px; }
.prv-del-cancel, .prv-del-confirm {
  flex: 1; padding: 12px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  transition: all .2s;
}
.prv-del-cancel { border: 1.5px solid var(--border); background: #fff; color: var(--ink-soft); }
.prv-del-cancel:hover { border-color: var(--ink); color: var(--ink); }
.prv-del-confirm { border: none; background: #dc2626; color: #fff; }
.prv-del-confirm:hover { background: #b91c1c; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.prv-toast {
  position: fixed;
  bottom: 28px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--ink);
  color: #fff;
  padding: 12px 24px;
  border-radius: 50px;
  font-size: 13px;
  font-weight: 600;
  z-index: 99999;
  display: flex;
  align-items: center;
  gap: 9px;
  box-shadow: 0 8px 32px rgba(0,0,0,.25);
  transition: transform .4s cubic-bezier(.34,1.56,.64,1);
  pointer-events: none;
  font-family: 'DM Sans', sans-serif;
  white-space: nowrap;
}
.prv-toast.show { transform: translateX(-50%) translateY(0); }
.prv-toast-icon { font-size: 15px; }

/* Responsive */
@media (max-width: 680px) {
  .prv-write-section { padding: 22px; }
  .prv-card { padding: 18px; }
  .prv-filter-bar { flex-direction: column; align-items: flex-start; }
  .prv-card-top { flex-direction: column; gap: 10px; }
  .prv-card-right { text-align: left; }
  .prv-stars { justify-content: flex-start; }
}
</style>

<section class="prv-section" id="productReviews">

  <!-- Section Header -->
  <div class="prv-header">
    <div class="prv-header-left">
      <h2>Customer Reviews</h2>
      <p class="prv-header-subtitle">Honest experiences from real buyers</p>
    </div>
    {% if request.user.is_authenticated %}
      {% with user_existing_review=product.reviews.all %}
        {% if can_review %}
        <a href="{% url 'reviews:write_review' product.slug %}" class="prv-write-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4z"/></svg>
          Write a Review
        </a>
        {% endif %}
      {% endwith %}
    {% endif %}
  </div>

  <!-- Rating Summary -->
  {% if rating_stats and rating_stats.total_reviews %}
  <div class="prv-summary">
    <div class="prv-avg-block">
      <div class="prv-avg-num">{{ rating_stats.average_rating|floatformat:1 }}</div>
      <div class="prv-avg-stars">
        {% for i in "12345" %}
          {% if forloop.counter <= rating_stats.average_rating|floatformat:0|add:"0" %}
            <span class="star on">‚òÖ</span>
          {% else %}
            <span class="star off">‚òÖ</span>
          {% endif %}
        {% endfor %}
      </div>
      <div class="prv-avg-label">{{ rating_stats.total_reviews }} review{{ rating_stats.total_reviews|pluralize }}</div>
    </div>

    <div class="prv-bars">
      <div class="prv-bar-row" onclick="prvSetRating(5)">
        <span class="prv-bar-label">5 <span class="s">‚òÖ</span></span>
        <div class="prv-bar-track"><div class="prv-bar-fill" data-pct="{{ rating_percentages.5|floatformat:0 }}"></div></div>
        <span class="prv-bar-count">{{ rating_stats.five_star }}</span>
      </div>
      <div class="prv-bar-row" onclick="prvSetRating(4)">
        <span class="prv-bar-label">4 <span class="s">‚òÖ</span></span>
        <div class="prv-bar-track"><div class="prv-bar-fill" data-pct="{{ rating_percentages.4|floatformat:0 }}"></div></div>
        <span class="prv-bar-count">{{ rating_stats.four_star }}</span>
      </div>
      <div class="prv-bar-row" onclick="prvSetRating(3)">
        <span class="prv-bar-label">3 <span class="s">‚òÖ</span></span>
        <div class="prv-bar-track"><div class="prv-bar-fill" data-pct="{{ rating_percentages.3|floatformat:0 }}"></div></div>
        <span class="prv-bar-count">{{ rating_stats.three_star }}</span>
      </div>
      <div class="prv-bar-row" onclick="prvSetRating(2)">
        <span class="prv-bar-label">2 <span class="s">‚òÖ</span></span>
        <div class="prv-bar-track"><div class="prv-bar-fill" data-pct="{{ rating_percentages.2|floatformat:0 }}"></div></div>
        <span class="prv-bar-count">{{ rating_stats.two_star }}</span>
      </div>
      <div class="prv-bar-row" onclick="prvSetRating(1)">
        <span class="prv-bar-label">1 <span class="s">‚òÖ</span></span>
        <div class="prv-bar-track"><div class="prv-bar-fill" data-pct="{{ rating_percentages.1|floatformat:0 }}"></div></div>
        <span class="prv-bar-count">{{ rating_stats.one_star }}</span>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Login Nudge (if not logged in) -->
  {% if not request.user.is_authenticated %}
  <div class="prv-login-nudge">
    <div class="prv-login-nudge-text">
      <strong>Share your experience</strong>
      <span>Log in to write a review for this product</span>
    </div>
    <a href="{% url 'users:login' %}?next={{ request.path }}" class="prv-login-link">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
      Login to Review
    </a>
  </div>
  {% endif %}

  <!-- Review List -->
  {% with approved_reviews=product.reviews.all %}
  {% if approved_reviews %}

  <!-- Filter Bar -->
  <div class="prv-filter-bar">
    <div class="prv-filter-left">
      <span style="font-size:12px;font-weight:600;color:#888;margin-right:4px;">Filter:</span>
      <button class="prv-filter-chip active" data-filter="all" onclick="prvFilter('all',this)">
        <span class="chip-dot"></span> All
      </button>
      <button class="prv-filter-chip" data-filter="5" onclick="prvFilter('5',this)">‚òÖ 5 Star</button>
      <button class="prv-filter-chip" data-filter="4" onclick="prvFilter('4',this)">‚òÖ 4 Star</button>
      <button class="prv-filter-chip" data-filter="verified" onclick="prvFilter('verified',this)">‚úì Verified</button>
      <button class="prv-filter-chip" data-filter="images" onclick="prvFilter('images',this)">üì∑ With Photos</button>
    </div>
    <div class="prv-sort-wrap">
      <span class="prv-sort-label">Sort:</span>
      <select class="prv-sort-select" onchange="prvSort(this.value)">
        <option value="newest">Most Recent</option>
        <option value="helpful">Most Helpful</option>
        <option value="highest">Highest Rating</option>
        <option value="lowest">Lowest Rating</option>
      </select>
    </div>
  </div>

  <!-- Cards -->
  <div class="prv-list" id="prvList">
    {% for review in approved_reviews %}
    {% if review.is_approved %}
    <div class="prv-card {% if review.is_featured %}prv-card--featured{% endif %}"
         data-rating="{{ review.rating }}"
         data-verified="{{ review.is_verified_purchase|yesno:'true,false' }}"
         data-has-images="{{ review.images.all|length|yesno:'true,false' }}"
         data-helpful="{{ review.helpful_count }}"
         data-date="{{ review.created_at|date:'U' }}">

      <div class="prv-card-top">
        <div class="prv-card-left">
          <div class="prv-avatar" data-color="{{ forloop.counter|divisibleby:5|yesno:'5,' }}{{ forloop.counter|divisibleby:4|yesno:'4,' }}{{ forloop.counter|divisibleby:3|yesno:'3,' }}{{ forloop.counter|divisibleby:2|yesno:'2,1' }}">
            {{ review.customer.first_name|first|upper|default:review.customer.username|first|upper }}
          </div>
          <div>
            <div class="prv-reviewer-name">{{ review.customer.get_full_name|default:review.customer.username }}</div>
            <div class="prv-badges">
              {% if review.is_verified_purchase %}
              <span class="prv-badge prv-badge--verified">
                <svg width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                Verified Purchase
              </span>
              {% endif %}
              {% if not review.is_approved %}
              <span class="prv-badge prv-badge--pending">Pending Review</span>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="prv-card-right">
          <div class="prv-stars">
            {% for i in "12345" %}
              {% if forloop.counter <= review.rating %}<span class="star on">‚òÖ</span>{% else %}<span class="star off">‚òÖ</span>{% endif %}
            {% endfor %}
          </div>
          <div class="prv-date">{{ review.created_at|date:"d M Y" }}</div>
        </div>
      </div>

      {% if review.title %}
      <div class="prv-card-title">{{ review.title }}</div>
      {% endif %}

      <div class="prv-card-comment" id="prv-cmt-{{ review.id }}">
        {% if review.comment|length > 280 %}
          <span class="cmt-short">{{ review.comment|truncatechars:280 }}</span>
          <span class="cmt-full" style="display:none;">{{ review.comment }}</span>
          <button class="prv-read-more" onclick="prvToggleCmt({{ review.id }}, this)">Read more ‚Üì</button>
        {% else %}
          {{ review.comment }}
        {% endif %}
      </div>

      {% if review.images.all %}
      <div class="prv-card-images">
        {% for img in review.images.all %}
        <div class="prv-img-thumb" onclick="prvOpenLb('{{ img.image.url }}')">
          <img src="{{ img.image.url }}" alt="Review photo" loading="lazy">
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <div class="prv-card-footer">
        <span class="prv-helpful-label">Was this helpful?</span>
        <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
          {% if request.user.is_authenticated %}
          <div class="prv-helpful-btns">
            <form method="post" action="{% url 'reviews:mark_helpful' review.id %}" style="display:inline;">
              {% csrf_token %}<input type="hidden" name="is_helpful" value="true">
              <button type="submit" class="prv-helpful-btn yes">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3H14z"/><path d="M7 22H4a2 2 0 01-2-2v-7a2 2 0 012-2h3"/></svg>
                Yes ({{ review.helpful_count }})
              </button>
            </form>
            <form method="post" action="{% url 'reviews:mark_helpful' review.id %}" style="display:inline;">
              {% csrf_token %}<input type="hidden" name="is_helpful" value="false">
              <button type="submit" class="prv-helpful-btn no">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 003 3l4-9V2H5.72a2 2 0 00-2 1.7l-1.38 9a2 2 0 002 2.3H10z"/><path d="M17 2h2.67A2.31 2.31 0 0122 4v7a2.31 2.31 0 01-2.33 2H17"/></svg>
                No ({{ review.not_helpful_count }})
              </button>
            </form>
          </div>
          {% else %}
          <a href="{% url 'users:login' %}?next={{ request.path }}" style="font-size:12px;color:var(--gold);text-decoration:underline;text-underline-offset:2px;">Login to vote</a>
          {% endif %}

          {% if request.user == review.customer %}
          <div class="prv-owner-btns">
            <a href="{% url 'reviews:edit_review' review.id %}" class="prv-btn-edit">Edit</a>
            <button class="prv-btn-del" onclick="prvShowDel({{ review.id }})">Delete</button>
            <form id="prv-delf-{{ review.id }}" method="post" action="{% url 'reviews:delete_review' review.id %}" style="display:none;">{% csrf_token %}</form>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}
    {% endfor %}
  </div>

  <!-- No results after filter -->
  <div id="prvNoResults" style="display:none;text-align:center;padding:40px;color:#888;font-size:14px;">
    No reviews match this filter. <button onclick="prvFilter('all', document.querySelector('[data-filter=all]'))" style="color:var(--gold);background:none;border:none;cursor:pointer;font-weight:700;text-decoration:underline;">Show all</button>
  </div>

  {% else %}
  <!-- Empty State -->
  <div class="prv-empty">
    <div class="prv-empty-icon">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#b8976a" stroke-width="1.5">
        <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
        <path d="M8 10h8M8 14h5" stroke-linecap="round"/>
      </svg>
    </div>
    <h3>No Reviews Yet</h3>
    <p>Be the first to share your experience with this product</p>
    {% if request.user.is_authenticated and can_review %}
    <a href="{% url 'reviews:write_review' product.slug %}" class="prv-empty-btn">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4z"/></svg>
      Write the First Review
    </a>
    {% elif not request.user.is_authenticated %}
    <a href="{% url 'users:login' %}?next={{ request.path }}" class="prv-empty-btn">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
      Login to Review
    </a>
    {% endif %}
  </div>
  {% endif %}
  {% endwith %}

</section>

<!-- Image Lightbox -->
<div class="prv-lb" id="prvLb" onclick="prvCloseLb()">
  <div class="prv-lb-close" onclick="prvCloseLb()">√ó</div>
  <img class="prv-lb-img" id="prvLbImg" src="" alt="">
</div>

<!-- Delete Modal -->
<div class="prv-del-modal" id="prvDelModal" onclick="if(event.target===this)prvHideDel()">
  <div class="prv-del-box">
    <div class="prv-del-box-icon">üóëÔ∏è</div>
    <h3>Delete Review?</h3>
    <p>This action is permanent and cannot be undone. Your review will be removed.</p>
    <div class="prv-del-box-btns">
      <button class="prv-del-cancel" onclick="prvHideDel()">Cancel</button>
      <button class="prv-del-confirm" onclick="prvDoDelete()">Yes, Delete</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="prv-toast" id="prvToast">
  <span class="prv-toast-icon"></span>
  <span id="prvToastMsg"></span>
</div>

<script>
(function() {
  // ‚îÄ‚îÄ Bar animation on scroll ‚îÄ‚îÄ
  var bars = document.querySelectorAll('.prv-bar-fill[data-pct]');
  if (bars.length && 'IntersectionObserver' in window) {
    var obs = new IntersectionObserver(function(entries) {
      entries.forEach(function(e) {
        if (e.isIntersecting) {
          bars.forEach(function(b) { b.style.width = b.dataset.pct + '%'; });
          obs.disconnect();
        }
      });
    }, { threshold: 0.2 });
    var summary = document.querySelector('.prv-summary');
    if (summary) obs.observe(summary);
  } else {
    bars.forEach(function(b) { setTimeout(function() { b.style.width = b.dataset.pct + '%'; }, 300); });
  }

  // ‚îÄ‚îÄ Filter + Sort ‚îÄ‚îÄ
  window.prvFilter = function(type, btn) {
    document.querySelectorAll('.prv-filter-chip').forEach(function(c) { c.classList.remove('active'); });
    btn.classList.add('active');

    var cards = document.querySelectorAll('#prvList .prv-card');
    var shown = 0;
    cards.forEach(function(card) {
      var show = true;
      if (type === '5') show = card.dataset.rating === '5';
      else if (type === '4') show = card.dataset.rating === '4';
      else if (type === 'verified') show = card.dataset.verified === 'true';
      else if (type === 'images') show = card.dataset.hasImages === 'true';
      card.style.display = show ? '' : 'none';
      if (show) shown++;
    });
    document.getElementById('prvNoResults').style.display = shown === 0 ? 'block' : 'none';
  };

  window.prvSetRating = function(r) {
    var chip = document.querySelector('[data-filter="' + r + '"]');
    if (chip) prvFilter(String(r), chip);
    document.getElementById('productReviews').scrollIntoView({ behavior: 'smooth', block: 'start' });
  };

  window.prvSort = function(val) {
    var list = document.getElementById('prvList');
    if (!list) return;
    var cards = Array.from(list.querySelectorAll('.prv-card'));
    cards.sort(function(a, b) {
      if (val === 'highest') return parseInt(b.dataset.rating) - parseInt(a.dataset.rating);
      if (val === 'lowest') return parseInt(a.dataset.rating) - parseInt(b.dataset.rating);
      if (val === 'helpful') return parseInt(b.dataset.helpful) - parseInt(a.dataset.helpful);
      return parseInt(b.dataset.date) - parseInt(a.dataset.date); // newest
    });
    cards.forEach(function(c) { list.appendChild(c); });
  };

  // ‚îÄ‚îÄ Read more toggle ‚îÄ‚îÄ
  window.prvToggleCmt = function(id, btn) {
    var wrap = document.getElementById('prv-cmt-' + id);
    var short = wrap.querySelector('.cmt-short');
    var full = wrap.querySelector('.cmt-full');
    if (full.style.display === 'none') {
      short.style.display = 'none';
      full.style.display = '';
      btn.textContent = 'Show less ‚Üë';
    } else {
      short.style.display = '';
      full.style.display = 'none';
      btn.textContent = 'Read more ‚Üì';
    }
  };

  // ‚îÄ‚îÄ Lightbox ‚îÄ‚îÄ
  window.prvOpenLb = function(url) {
    document.getElementById('prvLbImg').src = url;
    document.getElementById('prvLb').classList.add('open');
    document.body.style.overflow = 'hidden';
  };
  window.prvCloseLb = function() {
    document.getElementById('prvLb').classList.remove('open');
    document.body.style.overflow = '';
  };

  // ‚îÄ‚îÄ Delete modal ‚îÄ‚îÄ
  var _prvDelId = null;
  window.prvShowDel = function(id) {
    _prvDelId = id;
    document.getElementById('prvDelModal').classList.add('open');
  };
  window.prvHideDel = function() {
    document.getElementById('prvDelModal').classList.remove('open');
  };
  window.prvDoDelete = function() {
    if (_prvDelId) {
      document.getElementById('prv-delf-' + _prvDelId).submit();
    }
  };

  // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
  var _prvTT;
  window.prvToast = function(msg, icon) {
    var t = document.getElementById('prvToast');
    document.getElementById('prvToastMsg').textContent = msg;
    t.querySelector('.prv-toast-icon').textContent = icon || '‚úì';
    t.classList.add('show');
    clearTimeout(_prvTT);
    _prvTT = setTimeout(function() { t.classList.remove('show'); }, 3200);
  };

  // ‚îÄ‚îÄ Keyboard close ‚îÄ‚îÄ
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') { prvCloseLb(); prvHideDel(); }
  });

  // ‚îÄ‚îÄ Show toast from Django messages ‚îÄ‚îÄ
  {% if messages %}
    {% for m in messages %}
    setTimeout(function() { prvToast('{{ m|escapejs }}', '‚úì'); }, 100);
    {% endfor %}
  {% endif %}
})();
</script>
 