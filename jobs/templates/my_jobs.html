{% extends 'base.html' %}
{% load static %}

{% block title %}My Job Orders — Al Ameen Optics{% endblock %}

{% block extra_styles %}
<style>
:root {
  --aa-gold: #c8a96e;
  --aa-dark: #1a2a3a;
  --aa-sand: #f5f0eb;
  --aa-border: #e0e8ef;
  --aa-mid:   #6b7c8d;
  --aa-radius: 12px;
}

.myjobs-hero {
  background: linear-gradient(135deg, var(--aa-dark) 0%, #2c3e50 100%);
  padding: 60px 20px 40px;
  text-align: center;
  color: #fff;
}
.myjobs-hero h1 { font-size: clamp(1.8rem, 4vw, 3rem); font-weight: 300; letter-spacing: .05em; }

.myjobs-wrap { max-width: 900px; margin: 40px auto 80px; padding: 0 20px; }

.job-card {
  background: #fff;
  border-radius: var(--aa-radius);
  box-shadow: 0 2px 16px rgba(0,0,0,.07);
  margin-bottom: 20px;
  overflow: hidden;
  transition: transform .3s, box-shadow .3s;
  text-decoration: none;
  display: block;
  color: inherit;
}
.job-card:hover { transform: translateY(-4px); box-shadow: 0 8px 32px rgba(0,0,0,.12); color: inherit; }

.job-card-header { padding: 18px 24px; background: var(--aa-sand); border-bottom: 1px solid var(--aa-border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; }
.job-card-body { padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }

.job-num { font-size: 1.1rem; font-weight: 700; color: var(--aa-dark); }
.job-date { font-size: .82rem; color: var(--aa-mid); }

.status-pill { display: inline-block; padding: 4px 14px; border-radius: 50px; font-size: .8rem; font-weight: 700; text-transform: uppercase; letter-spacing: .05em; }
.status-received   { background: #fff3cd; color: #856404; }
.status-processing { background: #cff4fc; color: #055160; }
.status-lens_order { background: #cfe2ff; color: #084298; }
.status-fitting    { background: #cff4fc; color: #055160; }
.status-qa         { background: #cfe2ff; color: #084298; }
.status-ready      { background: #d1e7dd; color: #0a3622; }
.status-dispatched { background: #d1e7dd; color: #0a3622; }
.status-delivered  { background: #d1e7dd; color: #0a3622; }
.status-on_hold    { background: #e2e3e5; color: #41464b; }
.status-cancelled  { background: #f8d7da; color: #842029; }

.mini-progress { height: 6px; background: var(--aa-border); border-radius: 10px; overflow: hidden; margin-top: 8px; min-width: 120px; }
.mini-progress-fill { height: 100%; background: var(--aa-gold); border-radius: 10px; transition: width .5s; }

.info-chip { font-size: .82rem; color: var(--aa-mid); }
.info-chip strong { color: var(--aa-dark); }

.btn-view { display: inline-flex; align-items: center; gap: 6px; padding: 8px 20px; border-radius: 50px; background: var(--aa-dark); color: #fff; font-size: .85rem; font-weight: 600; text-decoration: none; transition: background .2s; }
.btn-view:hover { background: var(--aa-gold); color: #fff; }

.empty-state { text-align: center; padding: 80px 20px; }
.empty-state svg { opacity: .25; }

.quick-track-box { background: var(--aa-sand); border-radius: var(--aa-radius); padding: 24px; text-align: center; margin-bottom: 32px; border: 1px dashed var(--aa-border); }
</style>
{% endblock %}

{% block content %}

<div class="myjobs-hero">
  <h1>My Job Orders</h1>
  <p style="color:rgba(255,255,255,.7);margin-top:8px;">Track all your optical jobs at Al Ameen Optics</p>
</div>

<div class="myjobs-wrap">

  {% if messages %}
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }} alert-dismissible fade show">{{ message }}<button class="close" data-dismiss="alert"><span>&times;</span></button></div>
  {% endfor %}
  {% endif %}

  <div class="quick-track-box">
    <p class="mb-2 font-weight-600" style="color:var(--aa-dark)">Have a job number from a receipt?</p>
    <a href="{% url 'jobs:track' %}" class="btn-view"><i class="mdi mdi-magnify"></i> Track by Job Number</a>
  </div>

  {% if jobs %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0" style="color:var(--aa-dark);">{{ jobs|length }} Job{% if jobs|length != 1 %}s{% endif %}</h5>
  </div>

  {% for job in jobs %}
  <a href="{% url 'jobs:detail' job.job_number %}" class="job-card">
    <div class="job-card-header">
      <div>
        <div class="job-num">{{ job.job_number }}</div>
        <div class="job-date">Created {{ job.created_at|date:"d M Y" }}</div>
      </div>
      <span class="status-pill status-{{ job.status }}">{{ job.get_status_display }}</span>
    </div>
    <div class="job-card-body">
      <div>
        <div class="info-chip mb-1">
          <strong>{{ job.get_job_type_display }}</strong>
          {% if job.frame_description %} · {{ job.frame_description|truncatewords:5 }}{% endif %}
        </div>
        {% if job.lens_brand or job.lens_type %}
        <div class="info-chip">Lens: <strong>{{ job.lens_brand }} {{ job.lens_type }}</strong></div>
        {% endif %}
        {% if job.promised_date %}
        <div class="info-chip mt-1">Ready by: <strong>{{ job.promised_date|date:"d M Y" }}</strong></div>
        {% endif %}
      </div>
      <div class="text-right">
        <div class="info-chip mb-1">
          {% if job.balance_due > 0 %}
          Balance: <strong style="color:#dc3545;">QAR {{ job.balance_due }}</strong>
          {% else %}
          <strong style="color:#198754;">✓ Paid</strong>
          {% endif %}
        </div>
        <div class="mini-progress" style="width:120px;">
          <div class="mini-progress-fill" style="width:{{ job.progress_percent }}%;"></div>
        </div>
        <div class="info-chip" style="font-size:.75rem;margin-top:4px;">{{ job.progress_percent }}% complete</div>
        <div class="btn-view mt-2"><i class="mdi mdi-eye-outline"></i> View Details</div>
      </div>
    </div>
  </a>
  {% endfor %}

  {% else %}
  <div class="empty-state">
    <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#1a2a3a" stroke-width="1"><path d="M20 7H4a2 2 0 00-2 2v6a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z"/><path d="M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"/></svg>
    <h4 class="mt-4" style="color:var(--aa-dark)">No Job Orders Yet</h4>
    <p style="color:var(--aa-mid)">Visit one of our stores to place an order, or track a job with your receipt number.</p>
    <a href="{% url 'jobs:track' %}" class="btn-view mt-3"><i class="mdi mdi-magnify"></i> Track a Job</a>
  </div>
  {% endif %}

</div>
{% endblock %}