{% extends 'base.html' %}
{% load static %}
{% block title %}Contact Lenses - Eyewear Store{% endblock %}

{% block content %}
<main class="content-for-layout focus-none" id="xo-main-content" role="main" tabindex="-1">
    <!-- Collection Banner -->
    <div class="shopify-section" id="shopify-section-collection-title">
        <section class="xo-section color-inverse" style="--bg-color: #f3f3f3;--margin: 0;--pt: 110;--pb: 110;--pt-mobile:50px; --pb-mobile:50px;">
            <xo-animate class="xo-section-bg" style="--img-desktop: url({% static 'cdn/shop/files/contact-lenses-banner.jpg' %});--img-mobile: url({% static 'cdn/shop/files/contact-lenses-banner.jpg' %});" xo-disabled="" xo-duration="1000">
                <xo-parallax class="xo-section-bg-image__item" xo-lerp-ease="0.4">
                    <xo-parallax-scroll class="xo-section-bg-image__url xo-background-lazyload" xo-keyframes="{'0%': { backgroundPositionY: '200px' },'100%': { backgroundPositionY: '-200px' }}"></xo-parallax-scroll>
                </xo-parallax>
            </xo-animate>
            <div class="collection-title">
                <xo-animate xo-cascade="">
                    <h2 class="collection-title__title">Contact Lenses</h2>
                </xo-animate>
                <xo-animate xo-cascade="">
                    <nav aria-label="breadcrumb" class="breadcrumb" role="navigation" style="--display-mobile:block">
                        <ol class="breadcrumb__list" style="--justify:center">
                            <li class="breadcrumb__item">
                                <a class="breadcrumb__link" href="{% url 'home' %}">Home</a>
                                <span class="breadcrumb__separator"><svg height="8" viewBox="0 0 320 512"><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5 12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z" fill="currentColor"></path></svg></span>
                            </li>
                            <li class="breadcrumb__item breadcrumb__item--current" style="--display:block">
                                <a aria-current="page" class="breadcrumb__link breadcrumb--current" href="#">Contact Lenses</a>
                            </li>
                        </ol>
                    </nav>
                </xo-animate>
            </div>
        </section>
    </div>

    <!-- Lens Type Filter Tabs -->
    <section class="shopify-section section">
        <div class="xo-section color-background-1" style="--pt: 30; --pb: 0;">
            <xo-container class="xo-container--box">
                <div class="gender-filter" style="display: flex; justify-content: center; gap: 15px; padding: 20px 0; border-bottom: 1px solid #e0e0e0;">
                    <a href="?" class="{% if not selected_lens_type %}active{% endif %}" style="padding: 12px 30px; text-decoration: none; color: {% if not selected_lens_type %}#fff; background: #000{% else %}#666{% endif %}; font-weight: 500; border-radius: 5px; transition: all 0.3s;">All</a>
                    <a href="?lens_type=clear" class="{% if selected_lens_type == 'clear' %}active{% endif %}" style="padding: 12px 30px; text-decoration: none; color: {% if selected_lens_type == 'clear' %}#fff; background: #000{% else %}#666{% endif %}; font-weight: 500; border-radius: 5px; transition: all 0.3s;">Clear Lenses</a>
                    <a href="?lens_type=color" class="{% if selected_lens_type == 'color' %}active{% endif %}" style="padding: 12px 30px; text-decoration: none; color: {% if selected_lens_type == 'color' %}#fff; background: #000{% else %}#666{% endif %}; font-weight: 500; border-radius: 5px; transition: all 0.3s;">Color Lenses</a>
                </div>
            </xo-container>
        </div>
    </section>

    <!-- Products Section with Filters -->
    <section class="shopify-section section-collection-products">
        <div class="xo-section color-background-1" style="--margin: 0;--pt: 50;--pb: 50;">
            <xo-filters>
                <xo-container class="xo-container--box">
                    <xo-grid>
                        <!-- Sidebar Filters -->
                        <div class="main-collection-style1__sidebar" style="--xs: 12; --sm: 12; --md: 4; --lg: 3;">
                            <div class="collection-sidebar__header">
                                <h2 class="collection-sidebar__title">FILTERS</h2>
                            </div>
                            
                            <!-- Brand Filter -->
                            <div class="fieldset-block__header"><h2 class="fieldset-block__title">BRAND</h2></div>
                            <div class="fieldset-block__content fieldset-block__content--column">
                                {% for brand in brands %}
                                <xo-filters-field>
                                    <label class="field-checkbox-text">
                                        <input class="field-checkbox-text__input" name="brand" type="checkbox" value="{{ brand.slug }}" />
                                        <div class="field-checkbox-text__item">
                                            <span class="field-checkbox-text__icon"><svg height="12" viewBox="0 0 320 512"><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5 12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z" fill="rgba(var(--color-foreground))"></path></svg></span>
                                            <span class="field-checkbox-text__content">{{ brand.name }}</span>
                                        </div>
                                    </label>
                                </xo-filters-field>
                                {% endfor %}
                            </div>

                            <!-- Replacement Schedule -->
                            <div class="fieldset-block__header"><h2 class="fieldset-block__title">REPLACEMENT</h2></div>
                            <div class="fieldset-block__content">
                                <xo-filters-field>
                                    <label class="field-checkbox-block">
                                        <input class="field-checkbox-block__input" name="schedule" type="checkbox" value="daily" />
                                        <div class="field-checkbox-block__item field-checkbox-block__item--tag">
                                            <span class="field-checkbox-block__content">Daily</span>
                                        </div>
                                    </label>
                                </xo-filters-field>
                                <xo-filters-field>
                                    <label class="field-checkbox-block">
                                        <input class="field-checkbox-block__input" name="schedule" type="checkbox" value="monthly" />
                                        <div class="field-checkbox-block__item field-checkbox-block__item--tag">
                                            <span class="field-checkbox-block__content">Monthly</span>
                                        </div>
                                    </label>
                                </xo-filters-field>
                                <xo-filters-field>
                                    <label class="field-checkbox-block">
                                        <input class="field-checkbox-block__input" name="schedule" type="checkbox" value="3_months" />
                                        <div class="field-checkbox-block__item field-checkbox-block__item--tag">
                                            <span class="field-checkbox-block__content">Up to 3 Months</span>
                                        </div>
                                    </label>
                                </xo-filters-field>
                            </div>

                            <!-- Price Range -->
                            <div class="fieldset-block__header"><h2 class="fieldset-block__title">PRICE</h2></div>
                            <div class="fieldset-block__content">
                                <xo-filters-field style="width:100%; padding: 0 0.1rem">
                                    <div class="xo-field-price">
                                        <xo-range class="xo-field-price__range" xo-max="500.00" xo-min="0" xo-name="['filter.v.price.gte', 'filter.v.price.lte']" xo-step="0.1" xo-value="[0, 500.00]"></xo-range>
                                        <div class="xo-field-price__input-group">
                                            <div class="xo-field-price__label">Price:</div>
                                            <xo-range-price class="xo-field-price__text" xo-money-format="${ money }" xo-type="min"></xo-range-price>
                                            <span>-</span>
                                            <xo-range-price class="xo-field-price__text" xo-money-format="${ money }" xo-type="max"></xo-range-price>
                                        </div>
                                    </div>
                                </xo-filters-field>
                            </div>
                        </div>

                        <!-- Products Grid -->
                        <div style="--xs: 12; --sm: 12; --md: 8; --lg: 9;">
                            <div class="main-collection-style1__header">
                                <!-- Mobile Filter Button -->
                                <xo-modal-trigger class="main-collection-mobile__trigger" xo-name="collection-modal-mobile">
                                    <svg width="18" viewBox="0 0 320.42 225"><path d="M303.92,33H16.5C7.39,33,0,25.61,0,16.5v0C0,7.39,7.39,0,16.5,0h287.42c9.11,0,16.5,7.39,16.5,16.5v0 C320.42,25.61,313.04,33,303.92,33z" fill="currentColor"></path><path d="M256.55,129H63.87c-9.11,0-16.5-7.39-16.5-16.5v0c0-9.11,7.39-16.5,16.5-16.5h192.68c9.11,0,16.5,7.39,16.5,16.5v0 C273.05,121.61,265.66,129,256.55,129z" fill="currentColor"></path><path d="M208.05,225h-95.67c-9.11,0-16.5-7.39-16.5-16.5v0c0-9.11,7.39-16.5,16.5-16.5h95.67c9.11,0,16.5,7.39,16.5,16.5v0 C224.55,217.61,217.16,225,208.05,225z" fill="currentColor"></path></svg>
                                    <div class="main-collection-mobile__trigger-text">Filter</div>
                                </xo-modal-trigger>

                                <!-- Sort Options -->
                                <div class="xo-facets">
                                    <div class="xo-facets__item">
                                        <div class="xo-field-select-custom-filter">
                                            <xo-popover-trigger class="xo-field-select-custom-filter__trigger">
                                                <xo-filters-sort-by-selected class="xo-field-select-custom-filter__name">Featured</xo-filters-sort-by-selected>
                                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 22" width="20"><polyline points="6 9 12 15 18 9"></polyline></svg>
                                            </xo-popover-trigger>
                                            <xo-popover class="xo-field-select-custom-filter__popover" xo-placement="bottom-right">
                                                <label class="xo-field-select-custom-filter__check"><input checked class="xo-field-select-custom-filter__input" name="sort_by" type="radio" value="manual" /><span class="xo-field-select-custom-filter__label">Featured</span></label>
                                                <label class="xo-field-select-custom-filter__check"><input class="xo-field-select-custom-filter__input" name="sort_by" type="radio" value="best-selling" /><span class="xo-field-select-custom-filter__label">Best selling</span></label>
                                                <label class="xo-field-select-custom-filter__check"><input class="xo-field-select-custom-filter__input" name="sort_by" type="radio" value="price-ascending" /><span class="xo-field-select-custom-filter__label">Price, low to high</span></label>
                                                <label class="xo-field-select-custom-filter__check"><input class="xo-field-select-custom-filter__input" name="sort_by" type="radio" value="price-descending" /><span class="xo-field-select-custom-filter__label">Price, high to low</span></label>
                                            </xo-popover>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <xo-filters-content>
                                <div>
                                    <xo-grid class="filters-content__grid" style="--xs: 2; --sm: 2; --md: 2; --lg: 3">
                                        {% for product in products %}
                                        <xo-product xo-product-id="{{ product.id }}">
                                            <xo-animate class="xo-product-card xo-product-card--style9 color-background-1" xo-cascade="">
                                                <div class="xo-product-card__header xo-product-card__header--style9">
                                                    <a href="{% url 'product_detail' product.slug %}">
                                                        <xo-product-media>
                                                            <div class="xo-product-image">
                                                                <div class="xo-image" style="--xo-ratio-percent: 1/1;">
                                                                    {% if product.image %}
                                                                    <img alt="{{ product.name }}" src="{{ product.image.url }}" width="1000" height="1000" loading="lazy" />
                                                                    {% else %}
                                                                    <img alt="No Image" src="/static/img/no-image.jpg" width="1000" height="1000" loading="lazy" />
                                                                    {% endif %}
                                                                </div>
                                                            </div>
                                                        </xo-product-media>
                                                    </a>
                                                    <div class="xo-product-card__badge">
                                                        {% if product.contact_lens.lens_type == 'color' %}
                                                        <div class="xo-badge-sale">Color</div>
                                                        {% endif %}
                                                    </div>
                                                    <div class="xo-product-card__actions xo-product-card__actions--style9">
                                                        <xo-tooltip class="xo-product-card__icon" xo-title="Add to Cart">
                                                            <xo-cart-add>
                                                                <button class="xo-btn xo-btn--light xo-btn--primary xo-btn--circle xo-btn--sm circle" type="submit">
                                                                    <span class="xo-btn__content"><span class="xo-btn__icon"><svg height="20" width="20" viewBox="0 0 24 24"><path d="M12,0C9.1,0,6.7,2.4,6.7,5.3v1h10.5v-1C17.2,2.4,14.9,0,12,0z M12,1.8c1.6,0,3,1.1,3.4,2.7H8.6C9,2.9,10.4,1.8,12,1.8" fill="currentColor"></path><g><path d="M17.6,6.2c0.9,0,1.6,0.7,1.6,1.6v12.9c0,0.9-0.7,1.6-1.6,1.6H6.4c-0.9,0-1.6-0.7-1.6-1.6V7.8c0-0.9,0.7-1.6,1.6-1.6H17.6 M17.6,4.5H6.4C4.5,4.5,3,6,3,7.8v12.9C3,22.5,4.5,24,6.4,24h11.3c1.8,0,3.3-1.5,3.3-3.3V7.8C21,6,19.5,4.5,17.6,4.5L17.6,4.5z" fill="currentColor"></path></g><path d="M14.8,8.8H9.2c-0.4,0-0.7-0.3-0.7-0.7v0c0-0.4,0.3-0.7,0.7-0.7h5.7c0.4,0,0.7,0.3,0.7,0.7v0C15.5,8.5,15.2,8.8,14.8,8.8z" fill="currentColor"></path></svg></span></span>
                                                                </button>
                                                            </xo-cart-add>
                                                        </xo-tooltip>
                                                        <div>
                                                            <xo-products-fetcher-add class="xo-product-card__wishlist" xo-type="wishlist">
                                                                <xo-tooltip class="xo-product-card__icon xo-product-card__icon-wishlist" xo-title="Add to Wishlist">
                                                                    <button class="xo-btn xo-btn--light xo-btn--primary xo-btn--circle xo-btn--sm circle"><span class="xo-btn__content"><span class="xo-btn__icon">â™¡</span></span></button>
                                                                </xo-tooltip>
                                                            </xo-products-fetcher-add>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="xo-product-card__information">
                                                    <h2 class="xo-product-card__title">
                                                        <a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a>
                                                    </h2>
                                                    <p style="font-size: 12px; color: #666; margin: 5px 0;">
                                                        {{ product.brand.name }} | {{ product.contact_lens.get_lens_type_display }} | {{ product.contact_lens.get_replacement_schedule_display }}
                                                    </p>
                                                    <p style="font-size: 12px; color: #999;">Pack of {{ product.contact_lens.package_size }}</p>
                                                    <div class="xo-product-card__price">
                                                        <div class="xo-price">
                                                            <div class="xo-price__container">
                                                                <div class="xo-price__sale">
                                                                    <span class="xo-price__item xo-price__item--accent">QAR {{ product.base_price }}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </xo-animate>
                                        </xo-product>
                                        {% empty %}
                                        <p class="no-products" style="grid-column: 1/-1; text-align: center; padding: 50px; font-size: 18px; color: #666;">No contact lenses found matching your criteria.</p>
                                        {% endfor %}
                                    </xo-grid>

                                    <!-- Pagination -->
                                    {% if products.has_other_pages %}
                                    <xo-filters-paginate>
                                        <nav aria-label="Pagination" class="xo-pagination">
                                            <ul class="xo-pagination__list" role="list">
                                                {% if products.has_previous %}
                                                <li><a aria-label="Previous page" class="xo-pagination__page xo-pagination__page--prev" href="?page={{ products.previous_page_number }}"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="20"><polyline points="15 18 9 12 15 6"></polyline></svg></a></li>
                                                {% endif %}
                                                
                                                {% for num in products.paginator.page_range %}
                                                {% if products.number == num %}
                                                <li><span aria-current="page" class="xo-pagination__page xo-pagination__page--current">{{ num }}</span></li>
                                                {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                                                <li><a class="xo-pagination__page" href="?page={{ num }}">{{ num }}</a></li>
                                                {% endif %}
                                                {% endfor %}
                                                
                                                {% if products.has_next %}
                                                <li><a aria-label="Next page" class="xo-pagination__page xo-pagination__page--next" href="?page={{ products.next_page_number }}"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="20"><polyline points="9 18 15 12 9 6"></polyline></svg></a></li>
                                                {% endif %}
                                            </ul>
                                        </nav>
                                    </xo-filters-paginate>
                                    {% endif %}
                                </div>
                            </xo-filters-content>
                        </div>
                    </xo-grid>
                </xo-container>
            </xo-filters>
        </div>
    </section>
</main>
{% endblock %}