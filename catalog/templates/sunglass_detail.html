{% extends 'base.html' %}
{% load static %}
{% block title %}{{ product.name }} - Sunglasses{% endblock %}

{% block content %}

<style>
  /* â”€â”€â”€ DESIGN TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  :root {
    --black: #0a0a0a;
    --white: #fafafa;
    --gold: #b8976a;
    --gold-light: #d4b896;
    --sand: #f5f0e8;
    --muted: #888;
    --border: #e5e0d8;
    --radius: 10px;
    --shadow: 0 4px 24px rgba(0,0,0,0.08);
    --transition: all 0.28s cubic-bezier(0.4,0,0.2,1);
  }

  /* â”€â”€â”€ BREADCRUMB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-breadcrumb {
    padding: 14px 0;
    font-size: 13px;
    color: var(--muted);
    letter-spacing: 0.02em;
  }
  .sg-breadcrumb a { color: var(--muted); text-decoration: none; }
  .sg-breadcrumb a:hover { color: var(--black); }
  .sg-breadcrumb span { margin: 0 6px; }

  /* â”€â”€â”€ PRODUCT LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-product-wrap {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 48px;
    align-items: start;
    padding: 0 0 60px;
  }
  @media (max-width: 900px) {
    .sg-product-wrap { grid-template-columns: 1fr; gap: 28px; }
  }

  /* â”€â”€â”€ GALLERY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-gallery { position: sticky; top: 100px; }
  .sg-main-img {
    width: 100%;
    aspect-ratio: 1/1;
    border-radius: 16px;
    overflow: hidden;
    background: var(--sand);
    position: relative;
    margin-bottom: 14px;
    cursor: zoom-in;
  }
  .sg-main-img img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.4s ease;
    display: block;
  }
  .sg-main-img:hover img { transform: scale(1.04); }

  .sg-thumbs {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .sg-thumb {
    width: 72px;
    height: 72px;
    border-radius: 8px;
    overflow: hidden;
    background: var(--sand);
    border: 2px solid transparent;
    cursor: pointer;
    transition: var(--transition);
    flex-shrink: 0;
  }
  .sg-thumb img { width: 100%; height: 100%; object-fit: contain; display: block; }
  .sg-thumb.active, .sg-thumb:hover { border-color: var(--gold); }

  /* â”€â”€â”€ PRODUCT INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-info {}

  .sg-badges {
    display: flex;
    gap: 8px;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }
  .sg-badge {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 4px;
    background: var(--sand);
    color: var(--gold);
  }
  .sg-badge.new { background: #f0f7ee; color: #3a8a2e; }

  .sg-title-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 6px;
  }
  .sg-title {
    font-size: clamp(22px, 2.4vw, 30px);
    font-weight: 700;
    line-height: 1.2;
    color: var(--black);
    letter-spacing: -0.02em;
    margin: 0;
  }

  .sg-wishlist-btn {
    background: none;
    border: 2px solid var(--border);
    border-radius: 50%;
    width: 44px;
    height: 44px;
    flex-shrink: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
  }
  .sg-wishlist-btn:hover { border-color: #e05f5f; background: #fff0f0; }
  .sg-wishlist-btn.active { border-color: #e05f5f; background: #fff0f0; }

  .sg-brand {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .sg-brand strong { color: var(--black); }
  .sg-sku { font-size: 12px; color: #bbb; margin-bottom: 20px; }

  .sg-price-row {
    display: flex;
    align-items: baseline;
    gap: 12px;
    margin-bottom: 24px;
    padding: 16px 20px;
    background: var(--sand);
    border-radius: var(--radius);
  }
  .sg-price {
    font-size: 28px;
    font-weight: 800;
    color: var(--black);
    letter-spacing: -0.03em;
  }
  .sg-price-old {
    font-size: 16px;
    color: var(--muted);
    text-decoration: line-through;
  }
  .sg-discount-badge {
    font-size: 12px;
    font-weight: 700;
    background: #2a7a2a;
    color: #fff;
    padding: 3px 8px;
    border-radius: 4px;
  }

  /* â”€â”€â”€ SECTION LABEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-section-label {
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 10px;
  }

  /* â”€â”€â”€ COLOR VARIANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-colors {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }
  .sg-color-swatch {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    cursor: pointer;
  }
  .sg-color-dot {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 3px solid transparent;
    box-shadow: 0 0 0 1px var(--border);
    transition: var(--transition);
    position: relative;
  }
  .sg-color-swatch.active .sg-color-dot,
  .sg-color-swatch:hover .sg-color-dot {
    box-shadow: 0 0 0 2px var(--gold);
    transform: scale(1.1);
  }
  .sg-color-name { font-size: 11px; color: var(--muted); }

  /* â”€â”€â”€ SIZE SELECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-size-select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    font-size: 15px;
    background: white;
    color: var(--black);
    cursor: pointer;
    transition: var(--transition);
    margin-bottom: 24px;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23888' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
  }
  .sg-size-select:focus { border-color: var(--gold); outline: none; }

  /* â”€â”€â”€ POWER TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-power-toggle {
    display: flex;
    gap: 0;
    background: var(--sand);
    border-radius: var(--radius);
    padding: 4px;
    margin-bottom: 24px;
  }
  .sg-power-btn {
    flex: 1;
    padding: 12px;
    border: none;
    background: transparent;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    color: var(--muted);
  }
  .sg-power-btn.active {
    background: var(--black);
    color: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  }

  /* â”€â”€â”€ QUANTITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-qty-row {
    display: flex;
    align-items: center;
    gap: 0;
    width: fit-content;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    margin-bottom: 20px;
  }
  .sg-qty-btn {
    width: 44px;
    height: 44px;
    border: none;
    background: var(--sand);
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    color: var(--black);
  }
  .sg-qty-btn:hover { background: var(--border); }
  .sg-qty-input {
    width: 52px;
    height: 44px;
    border: none;
    border-left: 2px solid var(--border);
    border-right: 2px solid var(--border);
    text-align: center;
    font-size: 16px;
    font-weight: 600;
    color: var(--black);
    background: white;
  }
  .sg-qty-input:focus { outline: none; }

  /* â”€â”€â”€ ACTION BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-actions { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }

  .sg-btn-lens {
    display: none;
    padding: 14px 24px;
    background: white;
    border: 2px solid var(--gold);
    border-radius: var(--radius);
    font-size: 15px;
    font-weight: 700;
    color: var(--gold);
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: 0.02em;
    text-align: center;
  }
  .sg-btn-lens:hover { background: var(--gold); color: white; }

  .sg-btn-cart {
    padding: 16px 24px;
    background: var(--black);
    border: 2px solid var(--black);
    border-radius: var(--radius);
    font-size: 15px;
    font-weight: 700;
    color: white;
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: 0.04em;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
  }
  .sg-btn-cart:hover { background: #333; border-color: #333; }
  .sg-btn-cart.loading {
    pointer-events: none;
    opacity: 0.7;
  }

  .sg-btn-buy {
    padding: 16px 24px;
    background: var(--gold);
    border: 2px solid var(--gold);
    border-radius: var(--radius);
    font-size: 15px;
    font-weight: 700;
    color: white;
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: 0.04em;
    text-transform: uppercase;
    width: 100%;
  }
  .sg-btn-buy:hover { background: #a37d55; border-color: #a37d55; }

  /* â”€â”€â”€ SHIPPING INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-shipping {
    background: var(--sand);
    border-radius: var(--radius);
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 24px;
  }
  .sg-shipping-item {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 13px;
    color: var(--black);
  }
  .sg-shipping-icon {
    width: 32px;
    height: 32px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  /* â”€â”€â”€ SPECS TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-specs {
    margin-top: 8px;
  }
  .sg-specs-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }
  .sg-specs-table tr {
    border-bottom: 1px solid var(--border);
  }
  .sg-specs-table td {
    padding: 10px 0;
    vertical-align: top;
  }
  .sg-specs-table td:first-child {
    font-weight: 600;
    color: var(--black);
    width: 44%;
  }
  .sg-specs-table td:last-child { color: var(--muted); }

  /* â”€â”€â”€ DESCRIPTION SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-desc-section {
    padding: 40px 0;
    border-top: 1px solid var(--border);
  }
  .sg-section-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--black);
  }
  .sg-desc-body { font-size: 15px; line-height: 1.8; color: #555; }

  /* â”€â”€â”€ RELATED PRODUCTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-related-section { padding: 40px 0; border-top: 1px solid var(--border); }
  .sg-related-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-top: 24px;
  }
  @media (max-width: 900px) { .sg-related-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 500px) { .sg-related-grid { grid-template-columns: 1fr 1fr; gap: 12px; } }

  .sg-product-card {
    text-decoration: none;
    color: inherit;
    display: block;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid var(--border);
    transition: var(--transition);
    background: white;
  }
  .sg-product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow);
    border-color: var(--gold-light);
  }
  .sg-card-img {
    aspect-ratio: 1/1;
    background: var(--sand);
    overflow: hidden;
  }
  .sg-card-img img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.4s ease;
    display: block;
  }
  .sg-product-card:hover .sg-card-img img { transform: scale(1.06); }
  .sg-card-info { padding: 14px; }
  .sg-card-brand { font-size: 11px; color: var(--gold); font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; }
  .sg-card-name { font-size: 14px; font-weight: 600; margin: 4px 0; color: var(--black); }
  .sg-card-price { font-size: 15px; font-weight: 700; color: var(--black); }

  /* â”€â”€â”€ LENS MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .lens-modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    align-items: center;
    justify-content: center;
  }
  .lens-modal-overlay.open {
    display: flex;
  }
  .lens-modal-box {
    background: white;
    width: 95%;
    max-width: 720px;
    max-height: 90vh;
    border-radius: 20px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    box-shadow: 0 24px 80px rgba(0,0,0,0.2);
    animation: modalIn 0.3s ease;
  }
  @keyframes modalIn {
    from { opacity: 0; transform: translateY(24px) scale(0.97); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }
  .lens-modal-header {
    padding: 24px 28px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .lens-modal-header h2 { margin: 0; font-size: 20px; }
  .lens-modal-close {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: var(--muted);
    line-height: 1;
    padding: 0 4px;
  }
  .lens-modal-close:hover { color: var(--black); }
  .lens-modal-body {
    padding: 24px 28px;
    overflow-y: auto;
    flex: 1;
  }

  /* Modal steps */
  .lens-step-label {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 12px;
  }

  /* Lens color swatches */
  .modal-colors {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 28px;
  }
  .modal-color-chip {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    padding: 10px 14px;
    border: 2px solid var(--border);
    border-radius: 10px;
    transition: var(--transition);
    min-width: 72px;
    text-align: center;
  }
  .modal-color-chip:hover,
  .modal-color-chip.selected { border-color: var(--black); background: var(--sand); }
  .modal-color-dot {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid rgba(0,0,0,0.08);
    margin: 0 auto;
  }
  .modal-color-label { font-size: 12px; font-weight: 500; }

  /* Lens option cards */
  .lens-option-cards { margin-bottom: 24px; }
  .lens-opt-card {
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 18px 20px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }
  .lens-opt-card:hover { border-color: #aaa; }
  .lens-opt-card.selected { border-color: var(--black); background: var(--sand); }
  .lens-opt-left { display: flex; align-items: center; gap: 14px; }
  .lens-opt-radio {
    width: 20px;
    height: 20px;
    border: 2px solid var(--border);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: var(--transition);
  }
  .lens-opt-card.selected .lens-opt-radio {
    border-color: var(--black);
    background: var(--black);
  }
  .lens-opt-radio::after {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: white;
    display: none;
  }
  .lens-opt-card.selected .lens-opt-radio::after { display: block; }
  .lens-opt-name { font-size: 15px; font-weight: 700; }
  .lens-opt-desc { font-size: 13px; color: var(--muted); margin-top: 2px; }
  .lens-opt-price { font-size: 18px; font-weight: 800; white-space: nowrap; }

  /* Prescription table */
  .rx-table-wrap {
    background: var(--sand);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .rx-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }
  .rx-table th {
    background: var(--black);
    color: white;
    padding: 10px 12px;
    font-size: 13px;
    font-weight: 600;
    text-align: left;
  }
  .rx-table td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
  }
  .rx-table tr:last-child td { border-bottom: none; }
  .rx-table td:first-child { font-weight: 600; font-size: 13px; }
  .rx-input {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 14px;
    transition: var(--transition);
  }
  .rx-input:focus { border-color: var(--gold); outline: none; }

  /* Lens modal total & confirm */
  .lens-modal-footer {
    padding: 20px 28px 24px;
    border-top: 1px solid var(--border);
    background: white;
  }
  .lens-total-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }
  .lens-total-label { font-size: 15px; font-weight: 600; }
  .lens-total-price { font-size: 22px; font-weight: 800; color: var(--black); }
  .lens-confirm-btn {
    width: 100%;
    padding: 16px;
    background: var(--black);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: 0.04em;
  }
  .lens-confirm-btn:hover { background: #333; }

  /* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-toast {
    position: fixed;
    bottom: 28px;
    right: 28px;
    z-index: 99999;
    background: var(--black);
    color: white;
    padding: 14px 22px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    box-shadow: 0 8px 32px rgba(0,0,0,0.24);
    transform: translateY(60px);
    opacity: 0;
    transition: all 0.32s cubic-bezier(0.4,0,0.2,1);
    pointer-events: none;
  }
  .sg-toast.show { transform: translateY(0); opacity: 1; }
  .sg-toast.success { background: #2a7a2a; }
  .sg-toast.error { background: #b42020; }

  /* â”€â”€â”€ LENS CONFIRMED BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .lens-confirmed-badge {
    display: none;
    align-items: center;
    gap: 8px;
    background: #f0f7ee;
    border: 1px solid #3a8a2e;
    color: #2a6a20;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 14px;
  }
  .lens-confirmed-badge.show { display: flex; }

  /* â”€â”€â”€ CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sg-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 24px;
  }
</style>

<div class="sg-container">
  <!-- Breadcrumb -->
  <nav class="sg-breadcrumb" aria-label="Breadcrumb">
    <a href="{% url 'home' %}">Home</a>
    <span>/</span>
    <a href="{% url 'catalog:sunglasses_list' %}">Sunglasses</a>
    <span>/</span>
    <span style="color: var(--black);">{{ product.name }}</span>
  </nav>

  <!-- Main Product Section -->
  <div class="sg-product-wrap">

    <!-- â”€â”€ GALLERY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
 
{% include 'includes/product_gallery.html' %}
    <!-- â”€â”€ PRODUCT INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="sg-info">

      <!-- Badges -->
      <div class="sg-badges">
        {% if product.is_featured %}<span class="sg-badge">Featured</span>{% endif %}
        {% if product.compare_at_price %}<span class="sg-badge new">Sale</span>{% endif %}
        {% if product.gender != 'unisex' %}
        <span class="sg-badge" style="text-transform:capitalize;">{{ product.gender }}</span>
        {% endif %}
      </div>

      <!-- Title -->
      <div class="sg-title-row">
        <h1 class="sg-title">{{ product.name }}</h1>
        <button class="sg-wishlist-btn{% if product in request.user.wishlist.products.all %} active{% endif %}"
                id="wishlistBtn"
                data-product-id="{{ product.id }}"
                onclick="toggleWishlist(this)"
                title="Add to wishlist">
          {% if product in request.user.wishlist.products.all %}
          <svg width="18" height="18" viewBox="0 0 24 24" fill="red"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z"/></svg>
          {% else %}
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z"/></svg>
          {% endif %}
        </button>
      </div>

      <!-- Brand -->
      {% if product.brand %}
      <p class="sg-brand">Brand: <strong>{{ product.brand.name }}</strong></p>
      {% endif %}

      <!-- SKU -->
      {% if product.sku %}
      <p class="sg-sku">SKU: {{ product.sku }}</p>
      {% endif %}

      <!-- Price -->
      <div class="sg-price-row">
        <span class="sg-price" id="displayPrice">QAR {{ product.base_price }}</span>
        {% if product.compare_at_price %}
        <span class="sg-price-old">QAR {{ product.compare_at_price }}</span>
        {% with discount=product.compare_at_price|floatformat:0 %}
        <span class="sg-discount-badge">SAVE QAR {{ product.compare_at_price|floatformat:0 }}</span>
        {% endwith %}
        {% endif %}
      </div>

      <!-- Description -->
      {% if product.short_description %}
      <p style="font-size:14px;color:#555;line-height:1.7;margin-bottom:20px;">{{ product.short_description }}</p>
      {% endif %}

      <!-- Form -->
      <form id="productForm" method="POST" action="{% url 'cart:add_to_cart' %}" onsubmit="return false;">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ product.id }}">
        <input type="hidden" name="selected_variant_id" id="selectedVariantId" value="">
        <input type="hidden" name="power_type" id="powerTypeInput" value="without">
        <input type="hidden" name="selected_lens_color" id="hiddenLensColor" value="">
        <input type="hidden" name="selected_lens_option" id="hiddenLensOption" value="">
        <input type="hidden" name="total_lens_price" id="hiddenLensPrice" value="0">
        <!-- Prescription -->
        <input type="hidden" name="right_sph" id="h_rSph">
        <input type="hidden" name="right_cyl" id="h_rCyl">
        <input type="hidden" name="right_axis" id="h_rAxis">
        <input type="hidden" name="left_sph" id="h_lSph">
        <input type="hidden" name="left_cyl" id="h_lCyl">
        <input type="hidden" name="left_axis" id="h_lAxis">

        <!-- Color Variants -->
        {% if variants %}
        <div style="margin-bottom:24px;">
          <p class="sg-section-label">Frame Color</p>
          <div class="sg-colors">
            {% for variant in variants %}
            <div class="sg-color-swatch{% if forloop.first %} active{% endif %}"
                 onclick="selectVariant(this, '{{ variant.id }}', '{{ variant.color_name }}')"
                 title="{{ variant.color_name }}"
                 data-variant-id="{{ variant.id }}">
              {% if variant.color_code %}
              <div class="sg-color-dot" style="background:{{ variant.color_code }};"></div>
              {% else %}
              <div class="sg-color-dot" style="background:linear-gradient(135deg,#ccc,#aaa);"></div>
              {% endif %}
              <span class="sg-color-name">{{ variant.color_name }}</span>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Size -->
        {% with first_size=variants.0.size %}
        {% if first_size %}
        <div style="margin-bottom:4px;">
          <p class="sg-section-label">Frame Size</p>
          <select class="sg-size-select" name="selected_size" id="sizeSelect">
            <option value="">Choose Size</option>
            {% for variant in variants %}
            {% if variant.size %}
            <option value="{{ variant.size }}">{{ variant.size }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        {% endif %}
        {% endwith %}

        <!-- Power -->
        <div style="margin-bottom:8px;">
          <p class="sg-section-label">Prescription Lenses</p>
          <div class="sg-power-toggle">
            <button type="button" class="sg-power-btn active" onclick="setPower('without', this)">
              Without Power
            </button>
            <button type="button" class="sg-power-btn" onclick="setPower('with', this)">
              + Add Prescription
            </button>
          </div>
        </div>

        <!-- Lens Confirmed Badge -->
        <div class="lens-confirmed-badge" id="lensConfirmedBadge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <span id="lensConfirmedText">Lens selected</span>
          <button type="button" onclick="openLensModal()" style="margin-left:auto;background:none;border:none;color:#2a6a20;font-size:12px;cursor:pointer;font-weight:600;">Change</button>
        </div>

        <!-- Quantity -->
        <div style="margin-bottom:20px;">
          <p class="sg-section-label">Quantity</p>
          <div class="sg-qty-row">
            <button type="button" class="sg-qty-btn" onclick="changeQty(-1)">âˆ’</button>
            <input class="sg-qty-input" type="number" name="quantity" id="qtyInput" value="1" min="1" max="{{ product.stock_quantity|default:99 }}" readonly>
            <button type="button" class="sg-qty-btn" onclick="changeQty(1)">+</button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="sg-actions">
          <button type="button" class="sg-btn-lens" id="selectLensBtn" onclick="openLensModal()">
            ğŸ” Select Prescription Lenses
          </button>
          <button type="button" class="sg-btn-cart" id="addToCartBtn" onclick="addToCart()">
            Add to Cart
          </button>
          <button type="submit" class="sg-btn-buy" onclick="buyNow()">Buy it now â†’</button>
        </div>
      </form>

      <!-- Shipping Info -->
      <div class="sg-shipping">
        <div class="sg-shipping-item">
          <div class="sg-shipping-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="3" width="15" height="13" rx="1"/>
              <path d="M16 8h4l3 5v3h-7V8z"/>
              <circle cx="5.5" cy="18.5" r="2.5"/>
              <circle cx="18.5" cy="18.5" r="2.5"/>
            </svg>
          </div>
          <span>Estimated delivery: <strong>3â€“6 business days</strong> (Qatar/GCC)</span>
        </div>
        <div class="sg-shipping-item">
          <div class="sg-shipping-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
          </div>
          <span>Free returns within <strong>45 days</strong> of purchase</span>
        </div>
        <div class="sg-shipping-item">
          <div class="sg-shipping-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
          </div>
          <span>Authentic products â€” <strong>100% genuine</strong></span>
        </div>
      </div>

      <!-- Specifications -->
      {% if specifications %}
      <div class="sg-specs">
        <p class="sg-section-label">Specifications</p>
        <table class="sg-specs-table">
          {% for spec in specifications %}
          <tr>
            <td>{{ spec.spec_key }}</td>
            <td>{{ spec.spec_value }}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      {% endif %}

    </div><!-- /sg-info -->
  </div><!-- /sg-product-wrap -->

  <!-- About This Product -->
  {% if product.description %}
  <div class="sg-desc-section">
    <h2 class="sg-section-title">About This Product</h2>
    <div class="sg-desc-body">{{ product.description|linebreaksbr }}</div>
  </div>
  {% endif %}

  <!-- Related Products -->
  {% if related_products %}
  <div class="sg-related-section">
    <h2 class="sg-section-title">You May Also Like</h2>
    <div class="sg-related-grid">
      {% for related in related_products %}
      <a href="{% url 'catalog:sunglass_detail' related.slug %}" class="sg-product-card">
        <div class="sg-card-img">
          {% if related.image %}<img src="{{ related.image.url }}" alt="{{ related.name }}" loading="lazy">{% endif %}
        </div>
        <div class="sg-card-info">
          {% if related.brand %}<p class="sg-card-brand">{{ related.brand.name }}</p>{% endif %}
          <p class="sg-card-name">{{ related.name }}</p>
          <p class="sg-card-price">QAR {{ related.base_price }}</p>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}

</div><!-- /sg-container -->


<!-- â”€â”€ LENS SELECTION MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="lens-modal-overlay" id="lensModalOverlay" onclick="handleOverlayClick(event)">
  <div class="lens-modal-box" id="lensModalBox" role="dialog" aria-modal="true" aria-label="Select Prescription Lenses">

    <div class="lens-modal-header">
      <h2>Choose Your Prescription Lenses</h2>
      <button class="lens-modal-close" onclick="closeLensModal()" aria-label="Close">Ã—</button>
    </div>

    <div class="lens-modal-body">

      <!-- Step 1: Lens Color -->
      <p class="lens-step-label">Step 1 â€” Lens Tint Color</p>
      <div class="modal-colors">
        <div class="modal-color-chip" onclick="pickLensColor(this, 'grey')">
          <div class="modal-color-dot" style="background:#808080;"></div>
          <span class="modal-color-label">Grey</span>
        </div>
        <div class="modal-color-chip" onclick="pickLensColor(this, 'brown')">
          <div class="modal-color-dot" style="background:#8B4513;"></div>
          <span class="modal-color-label">Brown</span>
        </div>
        <div class="modal-color-chip" onclick="pickLensColor(this, 'green')">
          <div class="modal-color-dot" style="background:#228B22;"></div>
          <span class="modal-color-label">Green</span>
        </div>
        <div class="modal-color-chip" onclick="pickLensColor(this, 'blue')">
          <div class="modal-color-dot" style="background:#1a5fa8;"></div>
          <span class="modal-color-label">Blue</span>
        </div>
        <div class="modal-color-chip" onclick="pickLensColor(this, 'clear')">
          <div class="modal-color-dot" style="background:linear-gradient(135deg,#e8f4ff,#c5d9f0);"></div>
          <span class="modal-color-label">Clear</span>
        </div>
      </div>

      <!-- Step 2: Lens Type -->
      <p class="lens-step-label">Step 2 â€” Lens Type</p>
      <div class="lens-option-cards">

        <div class="lens-opt-card" onclick="pickLensOption(this, 'regular_156', 250)">
          <div class="lens-opt-left">
            <div class="lens-opt-radio"></div>
            <div>
              <div class="lens-opt-name">Regular 1.56</div>
              <div class="lens-opt-desc">Anti-reflection coating â€¢ Suitable for mild prescriptions</div>
            </div>
          </div>
          <div class="lens-opt-price">250 QAR</div>
        </div>

        <div class="lens-opt-card" onclick="pickLensOption(this, 'essilor_crizal', 350)">
          <div class="lens-opt-left">
            <div class="lens-opt-radio"></div>
            <div>
              <div class="lens-opt-name">Essilor Crizal Easy Pro 1.5</div>
              <div class="lens-opt-desc">Superior clarity â€¢ Scratch & dust resistant â€¢ UV protection</div>
            </div>
          </div>
          <div class="lens-opt-price">350 QAR</div>
        </div>

      </div>

      <!-- Step 3: Prescription -->
      <p class="lens-step-label">Step 3 â€” Enter Prescription (Rx)</p>
      <div class="rx-table-wrap">
        <table class="rx-table">
          <thead>
            <tr>
              <th>Eye</th>
              <th>SPH (Sphere)</th>
              <th>CYL (Cylinder)</th>
              <th>AXIS</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Right (OD)</strong></td>
              <td><input class="rx-input" type="number" step="0.25" placeholder="e.g. -1.50" id="m_rSph"></td>
              <td><input class="rx-input" type="number" step="0.25" placeholder="e.g. -0.50" id="m_rCyl"></td>
              <td><input class="rx-input" type="number" min="0" max="180" placeholder="0â€“180" id="m_rAxis"></td>
            </tr>
            <tr>
              <td><strong>Left (OS)</strong></td>
              <td><input class="rx-input" type="number" step="0.25" placeholder="e.g. -2.00" id="m_lSph"></td>
              <td><input class="rx-input" type="number" step="0.25" placeholder="e.g. -0.75" id="m_lCyl"></td>
              <td><input class="rx-input" type="number" min="0" max="180" placeholder="0â€“180" id="m_lAxis"></td>
            </tr>
          </tbody>
        </table>
      </div>

    </div><!-- /lens-modal-body -->

    <div class="lens-modal-footer">
      <div class="lens-total-row">
        <span class="lens-total-label">Lens Price:</span>
        <span class="lens-total-price" id="modalTotalDisplay">â€” QAR</span>
      </div>
      <button class="lens-confirm-btn" onclick="confirmLens()">Confirm Lens Selection â†’</button>
    </div>

  </div>
</div>

<!-- Toast -->
<div class="sg-toast" id="sgToast"></div>


<script>
// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BASE_PRICE = parseFloat("{{ product.base_price|default:0 }}");
let selectedVariantId   = '';
let powerType           = 'without';
let lensColor           = '';
let lensOption          = '';
let lensPrice           = 0;
let lensConfirmed       = false;

// â”€â”€ Gallery â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchImage(thumb, src) {
  document.querySelectorAll('.sg-thumb').forEach(t => t.classList.remove('active'));
  thumb.classList.add('active');
  const mainImg = document.getElementById('mainImg');
  if (mainImg) mainImg.src = src;
}

// â”€â”€ Variant selection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectVariant(el, id, name) {
  document.querySelectorAll('.sg-color-swatch').forEach(s => s.classList.remove('active'));
  el.classList.add('active');
  selectedVariantId = id;
  document.getElementById('selectedVariantId').value = id;
}

// â”€â”€ Power toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setPower(type, btn) {
  powerType = type;
  document.querySelectorAll('.sg-power-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('powerTypeInput').value = type;

  const lensBtn = document.getElementById('selectLensBtn');
  if (type === 'with') {
    lensBtn.style.display = 'block';
  } else {
    lensBtn.style.display = 'none';
    // Reset lens selection
    lensColor = ''; lensOption = ''; lensPrice = 0; lensConfirmed = false;
    document.getElementById('lensConfirmedBadge').classList.remove('show');
    document.getElementById('hiddenLensColor').value = '';
    document.getElementById('hiddenLensOption').value = '';
    document.getElementById('hiddenLensPrice').value = '0';
    updateDisplayPrice();
  }
}

// â”€â”€ Quantity â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function changeQty(delta) {
  const input = document.getElementById('qtyInput');
  const max = parseInt(input.max) || 99;
  const current = parseInt(input.value) || 1;
  const next = Math.min(Math.max(1, current + delta), max);
  input.value = next;
}

// â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openLensModal() {
  document.getElementById('lensModalOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeLensModal() {
  document.getElementById('lensModalOverlay').classList.remove('open');
  document.body.style.overflow = '';
}
function handleOverlayClick(e) {
  if (e.target === document.getElementById('lensModalOverlay')) closeLensModal();
}

// â”€â”€ Lens color â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pickLensColor(chip, color) {
  document.querySelectorAll('.modal-color-chip').forEach(c => c.classList.remove('selected'));
  chip.classList.add('selected');
  lensColor = color;
}

// â”€â”€ Lens option â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pickLensOption(card, value, price) {
  document.querySelectorAll('.lens-opt-card').forEach(c => c.classList.remove('selected'));
  card.classList.add('selected');
  lensOption = value;
  lensPrice = price;
  document.getElementById('modalTotalDisplay').textContent = price + ' QAR';
}

// â”€â”€ Confirm lens selection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function confirmLens() {
  if (!lensColor) { showToast('Please select a lens tint color', 'error'); return; }
  if (!lensOption) { showToast('Please select a lens type', 'error'); return; }

  // Save to hidden fields
  document.getElementById('hiddenLensColor').value = lensColor;
  document.getElementById('hiddenLensOption').value = lensOption;
  document.getElementById('hiddenLensPrice').value = lensPrice;

  // Copy prescription
  document.getElementById('h_rSph').value  = document.getElementById('m_rSph').value;
  document.getElementById('h_rCyl').value  = document.getElementById('m_rCyl').value;
  document.getElementById('h_rAxis').value = document.getElementById('m_rAxis').value;
  document.getElementById('h_lSph').value  = document.getElementById('m_lSph').value;
  document.getElementById('h_lCyl').value  = document.getElementById('m_lCyl').value;
  document.getElementById('h_lAxis').value = document.getElementById('m_lAxis').value;

  lensConfirmed = true;
  updateDisplayPrice();

  // Show badge
  const badge = document.getElementById('lensConfirmedBadge');
  badge.classList.add('show');
  const lensName = lensOption === 'essilor_crizal' ? 'Essilor Crizal Easy Pro' : 'Regular 1.56';
  document.getElementById('lensConfirmedText').textContent =
    lensName + ' Â· ' + lensColor.charAt(0).toUpperCase() + lensColor.slice(1) + ' Â· ' + lensPrice + ' QAR';

  closeLensModal();
  showToast('Lens selection confirmed! +' + lensPrice + ' QAR', 'success');
}

function updateDisplayPrice() {
  const total = BASE_PRICE + (lensConfirmed ? lensPrice : 0);
  document.getElementById('displayPrice').textContent = 'QAR ' + total.toFixed(2);
}

// â”€â”€ Add to Cart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addToCart() {
  if (powerType === 'with' && !lensConfirmed) {
    showToast('Please select your prescription lenses first', 'error');
    openLensModal();
    return;
  }

  const btn = document.getElementById('addToCartBtn');
  btn.classList.add('loading');
  btn.textContent = 'Adding...';

  const form = document.getElementById('productForm');
  const formData = new FormData(form);
  formData.set('quantity', document.getElementById('qtyInput').value);

  const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;

  fetch("{% url 'cart:add_to_cart' %}", {
    method: 'POST',
    body: formData,
    headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRFToken': csrfToken }
  })
  .then(r => r.json())
  .then(data => {
    btn.classList.remove('loading');
    btn.textContent = 'Add to Cart';
    if (data.success) {
      showToast('Added to cart!', 'success');
      // Update cart count if element exists
      const cartCount = document.getElementById('cartCount');
      if (cartCount && data.cart_count) cartCount.textContent = data.cart_count;
    } else {
      showToast(data.message || 'Error adding to cart', 'error');
    }
  })
  .catch(() => {
    btn.classList.remove('loading');
    btn.textContent = 'Add to Cart';
    showToast('Something went wrong. Please try again.', 'error');
  });
}

// â”€â”€ Buy Now â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buyNow() {
  if (powerType === 'with' && !lensConfirmed) {
    showToast('Please select your prescription lenses first', 'error');
    openLensModal();
    return;
  }
  const form = document.getElementById('productForm');
  // Change action to checkout and submit
  form.action = "{% url 'orders:checkout' %}";
  form.method = 'POST';
  form.submit();
}

// â”€â”€ Wishlist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleWishlist(btn) {
  const productId = btn.dataset.productId;
  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  fetch('/users/wishlist/toggle/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': csrfToken,
      'X-Requested-With': 'XMLHttpRequest'
    },
    body: JSON.stringify({ product_id: productId })
  })
  .then(r => r.json())
  .then(data => {
    if (data.added) {
      btn.classList.add('active');
      btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="red"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z"/></svg>';
      showToast('Added to wishlist', 'success');
    } else {
      btn.classList.remove('active');
      btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z"/></svg>';
      showToast('Removed from wishlist', '');
    }
  })
  .catch(() => showToast('Login required to use wishlist', 'error'));
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let toastTimer;
function showToast(message, type) {
  const toast = document.getElementById('sgToast');
  toast.textContent = message;
  toast.className = 'sg-toast show' + (type ? ' ' + type : '');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => { toast.classList.remove('show'); }, 3200);
}

// â”€â”€ Keyboard: close modal on Escape â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeLensModal();
});

// â”€â”€ Init: set first variant â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  const firstSwatch = document.querySelector('.sg-color-swatch');
  if (firstSwatch) {
    selectedVariantId = firstSwatch.dataset.variantId || '';
    document.getElementById('selectedVariantId').value = selectedVariantId;
  }
});
</script>

{% endblock %}