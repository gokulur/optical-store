{% extends 'base.html' %}
{% load static %}
{% block title %}{{ product.name }} - Eyeglasses{% endblock %}
{% load custom_filters %}

{% block content %}

<style>
  /* â”€â”€â”€ DESIGN TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  :root {
    --black: #0a0a0a;
    --white: #fafafa;
    --gold: #b8976a;
    --gold-light: #d4b896;
    --sand: #f5f0e8;
    --muted: #888;
    --border: #e5e0d8;
    --radius: 10px;
    --shadow: 0 4px 24px rgba(0,0,0,0.08);
    --transition: all 0.28s cubic-bezier(0.4,0,0.2,1);
  }

  /* â”€â”€â”€ BREADCRUMB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-breadcrumb {
    padding: 14px 0;
    font-size: 13px;
    color: var(--muted);
    letter-spacing: 0.02em;
  }
  .eg-breadcrumb a { color: var(--muted); text-decoration: none; }
  .eg-breadcrumb a:hover { color: var(--black); }
  .eg-breadcrumb span { margin: 0 6px; }

  /* â”€â”€â”€ PRODUCT LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-product-wrap {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 48px;
    align-items: start;
    padding: 0 0 60px;
  }
  @media (max-width: 900px) {
    .eg-product-wrap { grid-template-columns: 1fr; gap: 28px; }
  }

  /* â”€â”€â”€ GALLERY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-gallery { position: sticky; top: 100px; }
  .eg-main-img {
    width: 100%;
    aspect-ratio: 1/1;
    border-radius: 16px;
    overflow: hidden;
    background: var(--sand);
    position: relative;
    margin-bottom: 14px;
    cursor: zoom-in;
  }
  .eg-main-img img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.4s ease;
    display: block;
  }
  .eg-main-img:hover img { transform: scale(1.04); }

  .eg-thumbs {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .eg-thumb {
    width: 72px;
    height: 72px;
    border-radius: 8px;
    overflow: hidden;
    background: var(--sand);
    border: 2px solid transparent;
    cursor: pointer;
    transition: var(--transition);
    flex-shrink: 0;
  }
  .eg-thumb img { width: 100%; height: 100%; object-fit: contain; display: block; }
  .eg-thumb.active, .eg-thumb:hover { border-color: var(--gold); }

  /* â”€â”€â”€ PRODUCT INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-badges {
    display: flex;
    gap: 8px;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }
  .eg-badge {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 4px;
    background: var(--sand);
    color: var(--gold);
  }

  .eg-title-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 6px;
  }
  .eg-title {
    font-size: clamp(22px, 2.4vw, 30px);
    font-weight: 700;
    line-height: 1.2;
    color: var(--black);
    letter-spacing: -0.02em;
    margin: 0;
  }

  .eg-wishlist-btn {
    background: none;
    border: 2px solid var(--border);
    border-radius: 50%;
    width: 44px;
    height: 44px;
    flex-shrink: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
  }
  .eg-wishlist-btn:hover { border-color: #e05f5f; background: #fff0f0; }
  .eg-wishlist-btn.active { border-color: #e05f5f; background: #fff0f0; }

  .eg-brand { font-size: 13px; color: var(--muted); margin-bottom: 4px; }
  .eg-brand strong { color: var(--black); }
  .eg-sku { font-size: 12px; color: #bbb; margin-bottom: 20px; }

  .eg-price-row {
    display: flex;
    align-items: baseline;
    gap: 12px;
    margin-bottom: 24px;
    padding: 16px 20px;
    background: var(--sand);
    border-radius: var(--radius);
  }
  .eg-price {
    font-size: 28px;
    font-weight: 800;
    color: var(--black);
    letter-spacing: -0.03em;
  }
  .eg-price-old {
    font-size: 16px;
    color: var(--muted);
    text-decoration: line-through;
  }

  .eg-section-label {
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 10px;
  }

  /* â”€â”€â”€ COLOR VARIANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-colors {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }
  .eg-color-swatch {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    cursor: pointer;
  }
  .eg-color-dot {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 3px solid transparent;
    box-shadow: 0 0 0 1px var(--border);
    transition: var(--transition);
  }
  .eg-color-swatch.active .eg-color-dot,
  .eg-color-swatch:hover .eg-color-dot {
    box-shadow: 0 0 0 2px var(--gold);
    transform: scale(1.1);
  }
  .eg-color-name { font-size: 11px; color: var(--muted); }

  /* â”€â”€â”€ SIZE SELECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-size-select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    font-size: 15px;
    background: white;
    color: var(--black);
    cursor: pointer;
    transition: var(--transition);
    margin-bottom: 24px;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23888' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
  }
  .eg-size-select:focus { border-color: var(--gold); outline: none; }

  /* â”€â”€â”€ QUANTITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-qty-row {
    display: flex;
    align-items: center;
    width: fit-content;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    margin-bottom: 20px;
  }
  .eg-qty-btn {
    width: 44px;
    height: 44px;
    border: none;
    background: var(--sand);
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    color: var(--black);
  }
  .eg-qty-btn:hover { background: var(--border); }
  .eg-qty-input {
    width: 52px;
    height: 44px;
    border: none;
    border-left: 2px solid var(--border);
    border-right: 2px solid var(--border);
    text-align: center;
    font-size: 16px;
    font-weight: 600;
    color: var(--black);
    background: white;
  }
  .eg-qty-input:focus { outline: none; }

  /* â”€â”€â”€ LENS CONFIRMED BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .lens-confirmed-badge {
    display: none;
    align-items: center;
    gap: 8px;
    background: #f0f7ee;
    border: 1px solid #3a8a2e;
    color: #2a6a20;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 14px;
  }
  .lens-confirmed-badge.show { display: flex; }

  /* â”€â”€â”€ ACTION BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-actions { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }

  .eg-btn-lens {
    padding: 14px 24px;
    background: white;
    border: 2px solid var(--gold);
    border-radius: var(--radius);
    font-size: 15px;
    font-weight: 700;
    color: var(--gold);
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: 0.02em;
    text-align: center;
  }
  .eg-btn-lens:hover { background: var(--gold); color: white; }

  .eg-btn-cart {
    padding: 16px 24px;
    background: var(--black);
    border: 2px solid var(--black);
    border-radius: var(--radius);
    font-size: 15px;
    font-weight: 700;
    color: white;
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  .eg-btn-cart:hover { background: #333; border-color: #333; }
  .eg-btn-cart.loading { pointer-events: none; opacity: 0.7; }

  .eg-btn-buy {
    padding: 16px 24px;
    background: var(--gold);
    border: 2px solid var(--gold);
    border-radius: var(--radius);
    font-size: 15px;
    font-weight: 700;
    color: white;
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: 0.04em;
    text-transform: uppercase;
    width: 100%;
  }
  .eg-btn-buy:hover { background: #a37d55; border-color: #a37d55; }

  /* â”€â”€â”€ SHIPPING INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-shipping {
    background: var(--sand);
    border-radius: var(--radius);
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 24px;
  }
  .eg-shipping-item {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 13px;
    color: var(--black);
  }
  .eg-shipping-icon {
    width: 32px;
    height: 32px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  /* â”€â”€â”€ SPECS TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-specs-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }
  .eg-specs-table tr { border-bottom: 1px solid var(--border); }
  .eg-specs-table td { padding: 10px 0; vertical-align: top; }
  .eg-specs-table td:first-child { font-weight: 600; color: var(--black); width: 44%; }
  .eg-specs-table td:last-child { color: var(--muted); }

  /* â”€â”€â”€ DESCRIPTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-desc-section { padding: 40px 0; border-top: 1px solid var(--border); }
  .eg-section-title { font-size: 20px; font-weight: 700; margin-bottom: 16px; color: var(--black); }
  .eg-desc-body { font-size: 15px; line-height: 1.8; color: #555; }

  /* â”€â”€â”€ RELATED PRODUCTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-related-section { padding: 40px 0; border-top: 1px solid var(--border); }
  .eg-related-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-top: 24px;
  }
  @media (max-width: 900px) { .eg-related-grid { grid-template-columns: repeat(2, 1fr); } }

  .eg-product-card {
    text-decoration: none;
    color: inherit;
    display: block;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid var(--border);
    transition: var(--transition);
    background: white;
  }
  .eg-product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow);
    border-color: var(--gold-light);
  }
  .eg-card-img { aspect-ratio: 1/1; background: var(--sand); overflow: hidden; }
  .eg-card-img img {
    width: 100%; height: 100%; object-fit: contain;
    transition: transform 0.4s ease; display: block;
  }
  .eg-product-card:hover .eg-card-img img { transform: scale(1.06); }
  .eg-card-info { padding: 14px; }
  .eg-card-brand { font-size: 11px; color: var(--gold); font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; }
  .eg-card-name { font-size: 14px; font-weight: 600; margin: 4px 0; color: var(--black); }
  .eg-card-price { font-size: 15px; font-weight: 700; color: var(--black); }

  /* â”€â”€â”€ CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 24px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LENS MODAL â€” full Lenskart-style tabs
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .lens-modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    align-items: flex-start;
    justify-content: center;
    padding: 24px 16px;
    overflow-y: auto;
  }
  .lens-modal-overlay.open { display: flex; }

  .lens-modal-box {
    background: white;
    width: 100%;
    max-width: 900px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 24px 80px rgba(0,0,0,0.2);
    animation: modalIn 0.3s ease;
    margin: auto;
  }
  @keyframes modalIn {
    from { opacity: 0; transform: translateY(24px) scale(0.97); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .lens-modal-header {
    padding: 22px 28px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .lens-modal-header h2 { margin: 0; font-size: 20px; font-weight: 700; }
  .lens-modal-close {
    background: none; border: none; font-size: 28px;
    cursor: pointer; color: var(--muted); line-height: 1; padding: 0 4px;
  }
  .lens-modal-close:hover { color: var(--black); }

  /* â”€â”€ Tabs â”€â”€ */
  .lens-tabs {
    display: flex;
    gap: 0;
    border-bottom: 2px solid var(--border);
    overflow-x: auto;
    padding: 0 28px;
    margin-top: 18px;
    scrollbar-width: none;
  }
  .lens-tabs::-webkit-scrollbar { display: none; }
  .lens-tab-btn {
    padding: 12px 20px;
    border: none;
    background: transparent;
    font-size: 14px;
    font-weight: 600;
    color: var(--muted);
    cursor: pointer;
    white-space: nowrap;
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: var(--transition);
    letter-spacing: 0.01em;
  }
  .lens-tab-btn:hover { color: var(--black); }
  .lens-tab-btn.active { color: var(--black); border-bottom-color: var(--black); }

  /* â”€â”€ Tab panels â”€â”€ */
  .lens-panel { display: none; padding: 24px 28px 0; }
  .lens-panel.active { display: block; }
  .lens-panel-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--black);
    margin-bottom: 16px;
  }

  /* â”€â”€ Lens option cards â”€â”€ */
  .lens-opt-card {
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 18px 20px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: var(--transition);
  }
  .lens-opt-card:hover { border-color: #aaa; box-shadow: 0 2px 10px rgba(0,0,0,0.07); }
  .lens-opt-card.selected { border-color: var(--black); background: var(--sand); }

  .lens-opt-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 6px;
  }
  .lens-opt-left { display: flex; align-items: center; gap: 12px; }
  .lens-opt-radio {
    width: 20px; height: 20px;
    border: 2px solid var(--border);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; transition: var(--transition);
  }
  .lens-opt-card.selected .lens-opt-radio { border-color: var(--black); background: var(--black); }
  .lens-opt-radio::after {
    content: ''; width: 8px; height: 8px;
    border-radius: 50%; background: white; display: none;
  }
  .lens-opt-card.selected .lens-opt-radio::after { display: block; }

  .lens-opt-name { font-size: 15px; font-weight: 700; }
  .lens-opt-index { font-size: 12px; color: var(--muted); margin-top: 1px; }
  .lens-opt-price { font-size: 18px; font-weight: 800; white-space: nowrap; flex-shrink: 0; }

  .lens-opt-features {
    list-style: none;
    padding: 0;
    margin: 8px 0 0 32px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }
  .lens-opt-features li {
    font-size: 12px;
    background: white;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 3px 8px;
    color: #444;
  }
  .lens-opt-card.selected .lens-opt-features li { background: white; }

  /* â”€â”€ Add-on section inside card â”€â”€ */
  .lens-addons {
    margin: 14px 0 0 32px;
    padding-top: 14px;
    border-top: 1px solid var(--border);
    display: none;
  }
  .lens-opt-card.selected .lens-addons { display: block; }
  .lens-addon-label {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    transition: var(--transition);
    margin-bottom: 4px;
  }
  .lens-addon-label:hover { background: #f0f0f0; }
  .lens-addon-label input[type="radio"] { accent-color: var(--black); }
  .lens-addon-name { flex: 1; font-weight: 500; }
  .lens-addon-price { color: var(--gold); font-weight: 700; font-size: 12px; }
  .lens-addon-label.addon-selected { background: #fff8f0; }

  /* â”€â”€ Reading power grid â”€â”€ */
  .reading-power-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
    margin-bottom: 20px;
  }
  .power-chip {
    padding: 12px 8px;
    border: 2px solid var(--border);
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    color: var(--black);
    transition: var(--transition);
    background: white;
  }
  .power-chip:hover { border-color: var(--gold); }
  .power-chip.selected { border-color: var(--black); background: var(--black); color: white; }

  /* â”€â”€ Prescription table â”€â”€ */
  .rx-section {
    background: var(--sand);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
  }
  .rx-section-label {
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 14px;
  }
  .rx-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }
  .rx-table th {
    background: var(--black);
    color: white;
    padding: 10px 12px;
    font-size: 13px;
    font-weight: 600;
    text-align: left;
  }
  .rx-table td { padding: 10px 12px; border-bottom: 1px solid var(--border); }
  .rx-table tr:last-child td { border-bottom: none; }
  .rx-table td:first-child { font-weight: 600; font-size: 13px; white-space: nowrap; }
  .rx-input {
    width: 100%;
    padding: 7px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 14px;
    transition: var(--transition);
    min-width: 70px;
  }
  .rx-input:focus { border-color: var(--gold); outline: none; }
  @media (max-width: 600px) { .rx-section { overflow-x: auto; } }

  /* â”€â”€ Modal footer â”€â”€ */
  .lens-modal-footer {
    padding: 20px 28px 26px;
    border-top: 1px solid var(--border);
    background: white;
    position: sticky;
    bottom: 0;
  }
  .lens-total-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }
  .lens-total-label { font-size: 15px; font-weight: 600; }
  .lens-total-price { font-size: 24px; font-weight: 800; color: var(--black); }
  .lens-confirm-btn {
    width: 100%;
    padding: 16px;
    background: var(--black);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    letter-spacing: 0.04em;
  }
  .lens-confirm-btn:hover { background: #333; }

  /* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .eg-toast {
    position: fixed;
    bottom: 28px;
    right: 28px;
    z-index: 99999;
    background: var(--black);
    color: white;
    padding: 14px 22px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    box-shadow: 0 8px 32px rgba(0,0,0,0.24);
    transform: translateY(60px);
    opacity: 0;
    transition: all 0.32s cubic-bezier(0.4,0,0.2,1);
    pointer-events: none;
    max-width: 320px;
  }
  .eg-toast.show { transform: translateY(0); opacity: 1; }
  .eg-toast.success { background: #2a7a2a; }
  .eg-toast.error { background: #b42020; }
</style>

<div class="eg-container">

  <!-- Breadcrumb -->
  <nav class="eg-breadcrumb" aria-label="Breadcrumb">
    <a href="{% url 'home' %}">Home</a>
    <span>/</span>
    <a href="{% url 'catalog:eyeglasses_list' %}">Eyeglasses</a>
    <span>/</span>
    <span style="color: var(--black);">{{ product.name }}</span>
  </nav>

  <!-- Main Product Section -->
  <div class="eg-product-wrap">

    <!-- â”€â”€ GALLERY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="eg-gallery">
      <div class="eg-main-img">
        {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}" id="mainImg" />
        {% endif %}
      </div>
      <div class="eg-thumbs" id="thumbStrip">
        {% if product.image %}
        <div class="eg-thumb active" onclick="switchImage(this, '{{ product.image.url }}')">
          <img src="{{ product.image.url }}" alt="{{ product.name }}" />
        </div>
        {% endif %}
        {% for image in product.images.all %}
        <div class="eg-thumb" onclick="switchImage(this, '{{ image.image.url }}')">
          <img src="{{ image.image.url }}" alt="{{ product.name }}" />
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- â”€â”€ PRODUCT INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="eg-info">

      <!-- Badges -->
      <div class="eg-badges">
        {% if product.is_featured %}<span class="eg-badge">Featured</span>{% endif %}
        {% if product.compare_at_price %}<span class="eg-badge" style="background:#f0f7ee;color:#3a8a2e;">Sale</span>{% endif %}
        {% if product.gender != 'unisex' %}<span class="eg-badge" style="text-transform:capitalize;">{{ product.gender }}</span>{% endif %}
      </div>

      <!-- Title -->
      <div class="eg-title-row">
        <h1 class="eg-title">{{ product.name }}</h1>
        <button class="eg-wishlist-btn{% if product in request.user.wishlist.products.all %} active{% endif %}"
                id="wishlistBtn"
                data-product-id="{{ product.id }}"
                onclick="toggleWishlist(this)"
                title="Add to wishlist">
          {% if product in request.user.wishlist.products.all %}
          <svg width="18" height="18" viewBox="0 0 24 24" fill="red"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z"/></svg>
          {% else %}
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z"/></svg>
          {% endif %}
        </button>
      </div>

      {% if product.brand %}
      <p class="eg-brand">Brand: <strong>{{ product.brand.name }}</strong></p>
      {% endif %}
      {% if product.sku %}
      <p class="eg-sku">SKU: {{ product.sku }}</p>
      {% endif %}

      <!-- Price -->
      <div class="eg-price-row">
        <span class="eg-price" id="displayPrice">QAR {{ product.base_price }}</span>
        {% if product.compare_at_price %}
        <span class="eg-price-old">QAR {{ product.compare_at_price }}</span>
        {% endif %}
      </div>

      <!-- Short Description -->
      {% if product.short_description %}
      <p style="font-size:14px;color:#555;line-height:1.7;margin-bottom:20px;">{{ product.short_description }}</p>
      {% endif %}

      <!-- Form -->
      <form id="productForm" method="POST" action="{% url 'cart:add_eyeglass_to_cart' %}" onsubmit="return false;">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ product.id }}">
        <input type="hidden" name="selected_variant_id" id="selectedVariantId" value="">
        <input type="hidden" name="selected_lens_option" id="hiddenLensOption" value="">
        <input type="hidden" name="lens_addon" id="hiddenLensAddon" value="">
        <input type="hidden" name="total_lens_price" id="hiddenLensPrice" value="0">
        <input type="hidden" name="lens_category" id="hiddenLensCategory" value="">
        <!-- Prescription -->
        <input type="hidden" name="right_sph"  id="h_rSph">
        <input type="hidden" name="right_cyl"  id="h_rCyl">
        <input type="hidden" name="right_axis" id="h_rAxis">
        <input type="hidden" name="right_add"  id="h_rAdd">
        <input type="hidden" name="left_sph"   id="h_lSph">
        <input type="hidden" name="left_cyl"   id="h_lCyl">
        <input type="hidden" name="left_axis"  id="h_lAxis">
        <input type="hidden" name="left_add"   id="h_lAdd">

        <!-- Color Variants -->
        {% if variants %}
        <div style="margin-bottom:24px;">
          <p class="eg-section-label">Frame Color</p>
          <div class="eg-colors">
            {% for variant in variants %}
            <div class="eg-color-swatch{% if forloop.first %} active{% endif %}"
                 onclick="selectVariant(this, '{{ variant.id }}')"
                 data-variant-id="{{ variant.id }}"
                 title="{{ variant.color_name }}">
              {% if variant.color_code %}
              <div class="eg-color-dot" style="background:{{ variant.color_code }};"></div>
              {% else %}
              <div class="eg-color-dot" style="background:linear-gradient(135deg,#ccc,#aaa);"></div>
              {% endif %}
              <span class="eg-color-name">{{ variant.color_name }}</span>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Size -->
        {% with first_size=variants.0.size %}
        {% if first_size %}
        <div style="margin-bottom:4px;">
          <p class="eg-section-label">Frame Size</p>
          <select class="eg-size-select" name="selected_size">
            <option value="">Choose Size</option>
            {% for variant in variants %}
            {% if variant.size %}
            <option value="{{ variant.size }}">{{ variant.size }}</option>
            {% endif %}
            {% endfor %}
          </select>
        </div>
        {% endif %}
        {% endwith %}

        <!-- Quantity -->
        <div style="margin-bottom:20px;">
          <p class="eg-section-label">Quantity</p>
          <div class="eg-qty-row">
            <button type="button" class="eg-qty-btn" onclick="changeQty(-1)">âˆ’</button>
            <input class="eg-qty-input" type="number" name="quantity" id="qtyInput" value="1" min="1" max="{{ product.stock_quantity|default:99 }}" readonly>
            <button type="button" class="eg-qty-btn" onclick="changeQty(1)">+</button>
          </div>
        </div>

        <!-- Lens Confirmed Badge -->
        <div class="lens-confirmed-badge" id="lensConfirmedBadge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <span id="lensConfirmedText">Lens selected</span>
          <button type="button" onclick="openLensModal()" style="margin-left:auto;background:none;border:none;color:#2a6a20;font-size:12px;cursor:pointer;font-weight:600;">Change</button>
        </div>

        <!-- Actions -->
        <div class="eg-actions">
          <button type="button" class="eg-btn-lens" onclick="openLensModal()">
            ğŸ” Select Lenses (Required)
          </button>
          <button type="button" class="eg-btn-cart" id="addToCartBtn" onclick="addToCart()">
            Add to Cart
          </button>
          <button type="button" class="eg-btn-buy" onclick="buyNow()">Buy it now â†’</button>
        </div>
      </form>

      <!-- Shipping -->
      <div class="eg-shipping">
        <div class="eg-shipping-item">
          <div class="eg-shipping-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="3" width="15" height="13" rx="1"/>
              <path d="M16 8h4l3 5v3h-7V8z"/>
              <circle cx="5.5" cy="18.5" r="2.5"/>
              <circle cx="18.5" cy="18.5" r="2.5"/>
            </svg>
          </div>
          <span>Estimated delivery: <strong>3â€“6 business days</strong> (Qatar/GCC)</span>
        </div>
        <div class="eg-shipping-item">
          <div class="eg-shipping-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
          </div>
          <span>Free returns within <strong>45 days</strong> of purchase</span>
        </div>
        <div class="eg-shipping-item">
          <div class="eg-shipping-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
          </div>
          <span>Authentic products â€” <strong>100% genuine</strong></span>
        </div>
      </div>

      <!-- Specifications -->
      {% if specifications %}
      <div style="margin-top:8px;">
        <p class="eg-section-label">Specifications</p>
        <table class="eg-specs-table">
          {% for spec in specifications %}
          <tr>
            <td>{{ spec.spec_key }}</td>
            <td>{{ spec.spec_value }}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      {% endif %}

    </div><!-- /eg-info -->
  </div><!-- /eg-product-wrap -->

  <!-- About This Product -->
  {% if product.description %}
  <div class="eg-desc-section">
    <h2 class="eg-section-title">About This Product</h2>
    <div class="eg-desc-body">{{ product.description|linebreaksbr }}</div>
  </div>
  {% endif %}

  <!-- Related Products -->
  {% if related_products %}
  <div class="eg-related-section">
    <h2 class="eg-section-title">You May Also Like</h2>
    <div class="eg-related-grid">
      {% for related in related_products %}
      <a href="{% url 'catalog:eyeglass_detail' related.slug %}" class="eg-product-card">
        <div class="eg-card-img">
          {% if related.image %}<img src="{{ related.image.url }}" alt="{{ related.name }}" loading="lazy">{% endif %}
        </div>
        <div class="eg-card-info">
          {% if related.brand %}<p class="eg-card-brand">{{ related.brand.name }}</p>{% endif %}
          <p class="eg-card-name">{{ related.name }}</p>
          <p class="eg-card-price">QAR {{ related.base_price }}</p>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}

</div><!-- /eg-container -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LENS SELECTION MODAL â€” Lenskart-style tabbed UI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="lens-modal-overlay" id="lensModalOverlay" onclick="handleOverlayClick(event)">
  <div class="lens-modal-box" role="dialog" aria-modal="true" aria-label="Select Lenses">

    <div class="lens-modal-header">
      <h2>Select Your Lenses</h2>
      <button class="lens-modal-close" onclick="closeLensModal()" aria-label="Close">Ã—</button>
    </div>

    <!-- Tabs -->
    <div class="lens-tabs" id="lensTabs">
      <button class="lens-tab-btn active" onclick="showPanel('panel-sv', this)">Single Vision</button>
      <button class="lens-tab-btn" onclick="showPanel('panel-prog', this)">Progressive & Bifocal</button>
      <button class="lens-tab-btn" onclick="showPanel('panel-reading', this)">Reading Glasses</button>
      <button class="lens-tab-btn" onclick="showPanel('panel-nopow', this)">Without Prescription</button>
    </div>

    <!-- â”€â”€ Panel: Single Vision â”€â”€ -->
    <div id="panel-sv" class="lens-panel active">
      <p class="lens-panel-title">Single-Vision Lenses</p>

      <div class="lens-opt-card" onclick="selectCard(this,'regular_basic',150,'sv')">
        <div class="lens-opt-top">
          <div class="lens-opt-left">
            <div class="lens-opt-radio"></div>
            <div>
              <div class="lens-opt-name">Regular Lens (Basic)</div>
              <div class="lens-opt-index">Index 1.56</div>
            </div>
          </div>
          <div class="lens-opt-price">150 QAR</div>
        </div>
        <ul class="lens-opt-features">
          <li>Anti-reflection coating</li>
          <li>Power up to Â±4.00 (CYL Â±2.00)</li>
        </ul>
        <div class="lens-addons">
          <div class="lens-addon-label" onclick="pickAddon(event,this,0)">
            <input type="radio" name="addon_regular_basic" value="none" checked> <span class="lens-addon-name">Regular</span><span class="lens-addon-price">Included</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,100)">
            <input type="radio" name="addon_regular_basic" value="blue_uv"> <span class="lens-addon-name">Blue UV Protection</span><span class="lens-addon-price">+100 QAR</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,100)">
            <input type="radio" name="addon_regular_basic" value="photochromic"> <span class="lens-addon-name">Photochromic</span><span class="lens-addon-price">+100 QAR</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,100)">
            <input type="radio" name="addon_regular_basic" value="tinted"> <span class="lens-addon-name">Tinted</span><span class="lens-addon-price">+100 QAR</span>
          </div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'essilor_easy_pro',270,'sv')">
        <div class="lens-opt-top">
          <div class="lens-opt-left">
            <div class="lens-opt-radio"></div>
            <div>
              <div class="lens-opt-name">Essilor Crizal Easy Pro</div>
              <div class="lens-opt-index">Index 1.56</div>
            </div>
          </div>
          <div class="lens-opt-price">270 QAR</div>
        </div>
        <ul class="lens-opt-features">
          <li>Anti-reflection & UV</li><li>Easy cleaning</li><li>Power up to Â±3.00 (CYL Â±2.00)</li>
        </ul>
        <div class="lens-addons">
          <div class="lens-addon-label" onclick="pickAddon(event,this,0)">
            <input type="radio" name="addon_essilor_easy" value="none" checked> <span class="lens-addon-name">Regular</span><span class="lens-addon-price">Included</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,60)">
            <input type="radio" name="addon_essilor_easy" value="blue_prem"> <span class="lens-addon-name">Premium Blue Filtration</span><span class="lens-addon-price">+60 QAR</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,90)">
            <input type="radio" name="addon_essilor_easy" value="transition"> <span class="lens-addon-name">Transition Classic</span><span class="lens-addon-price">+90 QAR</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,60)">
            <input type="radio" name="addon_essilor_easy" value="tinted"> <span class="lens-addon-name">Tinted</span><span class="lens-addon-price">+60 QAR</span>
          </div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'essilor_sapphire',525,'sv')">
        <div class="lens-opt-top">
          <div class="lens-opt-left">
            <div class="lens-opt-radio"></div>
            <div>
              <div class="lens-opt-name">Essilor Crizal Sapphire</div>
              <div class="lens-opt-index">Index 1.56</div>
            </div>
          </div>
          <div class="lens-opt-price">525 QAR</div>
        </div>
        <ul class="lens-opt-features">
          <li>High transparency</li><li>Anti-reflection & UV</li><li>Durable resistance</li><li>Power up to Â±3.00</li>
        </ul>
        <div class="lens-addons">
          <div class="lens-addon-label" onclick="pickAddon(event,this,0)">
            <input type="radio" name="addon_sapphire" value="none" checked> <span class="lens-addon-name">Regular</span><span class="lens-addon-price">Included</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,200)">
            <input type="radio" name="addon_sapphire" value="blue_prem"> <span class="lens-addon-name">Premium Blue Filtration</span><span class="lens-addon-price">+200 QAR</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,850)">
            <input type="radio" name="addon_sapphire" value="transition_gens"> <span class="lens-addon-name">Transition Gen-S</span><span class="lens-addon-price">+850 QAR</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,350)">
            <input type="radio" name="addon_sapphire" value="tinted"> <span class="lens-addon-name">Tinted</span><span class="lens-addon-price">+350 QAR</span>
          </div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'essilor_prevencia',500,'sv')">
        <div class="lens-opt-top">
          <div class="lens-opt-left">
            <div class="lens-opt-radio"></div>
            <div>
              <div class="lens-opt-name">Essilor Crizal Prevencia (Computer Use)</div>
              <div class="lens-opt-index">Index 1.50</div>
            </div>
          </div>
          <div class="lens-opt-price">500 QAR</div>
        </div>
        <ul class="lens-opt-features">
          <li>Blue-violet light filtering</li><li>Anti-reflection</li><li>High clarity & durability</li>
        </ul>
        <div class="lens-addons">
          <div class="lens-addon-label" onclick="pickAddon(event,this,0)">
            <input type="radio" name="addon_prevencia" value="none" checked> <span class="lens-addon-name">Regular</span><span class="lens-addon-price">Included</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,700)">
            <input type="radio" name="addon_prevencia" value="transition_gens"> <span class="lens-addon-name">Transition Gen-S</span><span class="lens-addon-price">+700 QAR</span>
          </div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,220)">
            <input type="radio" name="addon_prevencia" value="tinted"> <span class="lens-addon-name">Tinted</span><span class="lens-addon-price">+220 QAR</span>
          </div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'essilor_thin167',650,'sv')">
        <div class="lens-opt-top">
          <div class="lens-opt-left">
            <div class="lens-opt-radio"></div>
            <div>
              <div class="lens-opt-name">Essilor Super Thin Crizal Rock Premium</div>
              <div class="lens-opt-index">Index 1.67</div>
            </div>
          </div>
          <div class="lens-opt-price">650 QAR</div>
        </div>
        <ul class="lens-opt-features">
          <li>Super thin design</li><li>Anti-reflection & UV</li><li>Power up to Â±7.00 (CYL Â±2.00)</li>
        </ul>
      </div>

      <!-- Prescription inside this panel -->
     
      <div class="rx-section" style="margin-bottom:20px;">
        <p class="rx-section-label">Enter Prescription (Optional)</p>
        <div style="overflow-x:auto;">
          <table class="rx-table">
            <thead>
              <tr><th>Eye</th><th>SPH</th><th>CYL</th><th>AXIS</th><th>ADD</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Right (OD)</strong></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="-1.50" id="m_rSph"></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="-0.50" id="m_rCyl"></td>
                <td><input class="rx-input" type="number" min="0" max="180" placeholder="0â€“180" id="m_rAxis"></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="+1.00" id="m_rAdd"></td>
              </tr>
              <tr>
                <td><strong>Left (OS)</strong></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="-2.00" id="m_lSph"></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="-0.75" id="m_lCyl"></td>
                <td><input class="rx-input" type="number" min="0" max="180" placeholder="0â€“180" id="m_lAxis"></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="+1.00" id="m_lAdd"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Panel: Progressive & Bifocal â”€â”€ -->
    <div id="panel-prog" class="lens-panel">
      <p class="lens-panel-title">Progressive & Bifocal Lenses</p>

      <div class="lens-opt-card" onclick="selectCard(this,'regular_progressive',250,'prog')">
        <div class="lens-opt-top">
          <div class="lens-opt-left"><div class="lens-opt-radio"></div>
            <div><div class="lens-opt-name">Regular Progressive</div><div class="lens-opt-index">Index 1.56</div></div>
          </div>
          <div class="lens-opt-price">250 QAR</div>
        </div>
        <ul class="lens-opt-features"><li>Near, intermediate & far vision</li><li>Anti-reflection</li><li>Power up to Â±6.00 (CYL Â±4.00)</li></ul>
        <div class="lens-addons">
          <div class="lens-addon-label" onclick="pickAddon(event,this,0)"><input type="radio" name="addon_reg_prog" value="none" checked><span class="lens-addon-name">Regular</span><span class="lens-addon-price">Included</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,100)"><input type="radio" name="addon_reg_prog" value="blue_uv"><span class="lens-addon-name">Blue UV Protection</span><span class="lens-addon-price">+100 QAR</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,150)"><input type="radio" name="addon_reg_prog" value="photochromic"><span class="lens-addon-name">Photochromic</span><span class="lens-addon-price">+150 QAR</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,250)"><input type="radio" name="addon_reg_prog" value="unbreakable"><span class="lens-addon-name">1.59 Index Unbreakable</span><span class="lens-addon-price">+250 QAR</span></div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'essilor_espace',600,'prog')">
        <div class="lens-opt-top">
          <div class="lens-opt-left"><div class="lens-opt-radio"></div>
            <div><div class="lens-opt-name">Essilor Espace 1.56 Crizal Easy Pro</div><div class="lens-opt-index">Index 1.56</div></div>
          </div>
          <div class="lens-opt-price">600 QAR</div>
        </div>
        <ul class="lens-opt-features"><li>Wide vision area</li><li>Enhanced comfort</li></ul>
        <div class="lens-addons">
          <div class="lens-addon-label" onclick="pickAddon(event,this,0)"><input type="radio" name="addon_espace" value="none" checked><span class="lens-addon-name">Regular</span><span class="lens-addon-price">Included</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,400)"><input type="radio" name="addon_espace" value="blue_160"><span class="lens-addon-name">Blue UV + 1.60 Index</span><span class="lens-addon-price">+400 QAR</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,630)"><input type="radio" name="addon_espace" value="transition_gens"><span class="lens-addon-name">Transition Gen-S</span><span class="lens-addon-price">+630 QAR</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,350)"><input type="radio" name="addon_espace" value="unbreakable"><span class="lens-addon-name">1.59 Unbreakable</span><span class="lens-addon-price">+350 QAR</span></div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'essilor_liberty',900,'prog')">
        <div class="lens-opt-top">
          <div class="lens-opt-left"><div class="lens-opt-radio"></div>
            <div><div class="lens-opt-name">Essilor Liberty 3.0 Crizal Easy Pro</div><div class="lens-opt-index">Index 1.56</div></div>
          </div>
          <div class="lens-opt-price">900 QAR</div>
        </div>
        <ul class="lens-opt-features"><li>Larger field of vision</li><li>Sharp focus</li><li>Power up to Â±7.00 (CYL Â±4.00)</li></ul>
        <div class="lens-addons">
          <div class="lens-addon-label" onclick="pickAddon(event,this,0)"><input type="radio" name="addon_liberty" value="none" checked><span class="lens-addon-name">Regular</span><span class="lens-addon-price">Included</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,220)"><input type="radio" name="addon_liberty" value="blue_uv"><span class="lens-addon-name">Blue UV Protection</span><span class="lens-addon-price">+220 QAR</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,650)"><input type="radio" name="addon_liberty" value="transition_gens"><span class="lens-addon-name">Transition Gen-S</span><span class="lens-addon-price">+650 QAR</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,400)"><input type="radio" name="addon_liberty" value="unbreakable"><span class="lens-addon-name">1.59 Unbreakable</span><span class="lens-addon-price">+400 QAR</span></div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'bifocal_ft28',450,'prog')">
        <div class="lens-opt-top">
          <div class="lens-opt-left"><div class="lens-opt-radio"></div>
            <div><div class="lens-opt-name">Essilor FT28 / Kryptok Bifocal Crizal Easy Pro</div><div class="lens-opt-index">Index 1.50</div></div>
          </div>
          <div class="lens-opt-price">450 QAR</div>
        </div>
        <ul class="lens-opt-features"><li>Clear near-far separation</li><li>Anti-reflection</li><li>Easy adaptation</li></ul>
        <div class="lens-addons">
          <div class="lens-addon-label" onclick="pickAddon(event,this,0)"><input type="radio" name="addon_bifocal" value="none" checked><span class="lens-addon-name">Regular</span><span class="lens-addon-price">Included</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,250)"><input type="radio" name="addon_bifocal" value="blue_uv"><span class="lens-addon-name">Blue UV Protection</span><span class="lens-addon-price">+250 QAR</span></div>
          <div class="lens-addon-label" onclick="pickAddon(event,this,600)"><input type="radio" name="addon_bifocal" value="transition_gen8"><span class="lens-addon-name">Transition Gen-8</span><span class="lens-addon-price">+600 QAR</span></div>
        </div>
      </div>

      <div class="rx-section" style="margin-bottom:20px;">
        <p class="rx-section-label">Enter Prescription (Optional)</p>
        <div style="overflow-x:auto;">
          <table class="rx-table">
            <thead><tr><th>Eye</th><th>SPH</th><th>CYL</th><th>AXIS</th><th>ADD</th></tr></thead>
            <tbody>
              <tr>
                <td><strong>Right (OD)</strong></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="-1.50" id="p_rSph"></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="-0.50" id="p_rCyl"></td>
                <td><input class="rx-input" type="number" min="0" max="180" placeholder="0â€“180" id="p_rAxis"></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="+1.00" id="p_rAdd"></td>
              </tr>
              <tr>
                <td><strong>Left (OS)</strong></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="-2.00" id="p_lSph"></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="-0.75" id="p_lCyl"></td>
                <td><input class="rx-input" type="number" min="0" max="180" placeholder="0â€“180" id="p_lAxis"></td>
                <td><input class="rx-input" type="number" step="0.25" placeholder="+1.00" id="p_lAdd"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Panel: Reading Glasses â”€â”€ -->
    <div id="panel-reading" class="lens-panel">
      <p class="lens-panel-title">Reading Glasses â€” Select Power</p>
      <div class="reading-power-grid" id="readingGrid">
        {% for power in "+0.75 +1.00 +1.25 +1.50 +1.75 +2.00 +2.25 +2.50 +2.75 +3.00"|split:" " %}
        <div class="power-chip" onclick="pickReadingPower(this, '{{ power }}')">{{ power }}</div>
        {% empty %}
        <!-- fallback if split filter not available -->
        {% for power_val in ""|default:"" %}{% endfor %}
        <div class="power-chip" onclick="pickReadingPower(this,'+0.75')">+0.75</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+1.00')">+1.00</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+1.25')">+1.25</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+1.50')">+1.50</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+1.75')">+1.75</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+2.00')">+2.00</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+2.25')">+2.25</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+2.50')">+2.50</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+2.75')">+2.75</div>
        <div class="power-chip" onclick="pickReadingPower(this,'+3.00')">+3.00</div>
        {% endfor %}
      </div>
      <p style="font-size:13px;color:var(--muted);margin-top:8px;margin-bottom:20px;">All reading powers: <strong>150 QAR</strong></p>
    </div>

    <!-- â”€â”€ Panel: Without Prescription â”€â”€ -->
    <div id="panel-nopow" class="lens-panel">
      <p class="lens-panel-title">Without Prescription Lenses</p>

      <div class="lens-opt-card" onclick="selectCard(this,'clear_lens',100,'nopow')">
        <div class="lens-opt-top">
          <div class="lens-opt-left"><div class="lens-opt-radio"></div>
            <div><div class="lens-opt-name">Clear Lens</div><div class="lens-opt-index">Basic lens without power</div></div>
          </div>
          <div class="lens-opt-price">100 QAR</div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'zero_blue',250,'nopow')">
        <div class="lens-opt-top">
          <div class="lens-opt-left"><div class="lens-opt-radio"></div>
            <div><div class="lens-opt-name">Zero Power Blue</div><div class="lens-opt-index">Blue light protection for screens</div></div>
          </div>
          <div class="lens-opt-price">250 QAR</div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'crizal_premium_np',470,'nopow')">
        <div class="lens-opt-top">
          <div class="lens-opt-left"><div class="lens-opt-radio"></div>
            <div><div class="lens-opt-name">Essilor Crizal Premium</div><div class="lens-opt-index">Advanced blue-light filtration with Prevencia</div></div>
          </div>
          <div class="lens-opt-price">470 QAR</div>
        </div>
      </div>

      <div class="lens-opt-card" onclick="selectCard(this,'tinted_np',250,'nopow')">
        <div class="lens-opt-top">
          <div class="lens-opt-left"><div class="lens-opt-radio"></div>
            <div><div class="lens-opt-name">Tinted Lens</div><div class="lens-opt-index">Adds permanent color tint</div></div>
          </div>
          <div class="lens-opt-price">250 QAR</div>
        </div>
      </div>
    </div>

    <!-- Sticky footer -->
    <div class="lens-modal-footer">
      <div class="lens-total-row">
        <span class="lens-total-label">Total Lens Price:</span>
        <span class="lens-total-price" id="modalTotalDisplay">â€” QAR</span>
      </div>
      <button class="lens-confirm-btn" onclick="confirmLens()">Confirm Lens Selection â†’</button>
    </div>

  </div><!-- /lens-modal-box -->
</div><!-- /lens-modal-overlay -->

<!-- Toast -->
<div class="eg-toast" id="egToast"></div>


<script>
// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BASE_PRICE   = parseFloat("{{ product.base_price|default:0 }}");
let activePanelId  = 'panel-sv';
let lensOption     = '';      // e.g. 'essilor_easy_pro'
let lensAddon      = '';      // e.g. 'blue_prem'
let lensCategory   = 'sv';
let lensBasePrice  = 0;
let addonPrice     = 0;
let lensConfirmed  = false;
let readingPower   = '';

// â”€â”€ Gallery â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchImage(thumb, src) {
  document.querySelectorAll('.eg-thumb').forEach(t => t.classList.remove('active'));
  thumb.classList.add('active');
  const img = document.getElementById('mainImg');
  if (img) img.src = src;
}

// â”€â”€ Variant â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectVariant(el, id) {
  document.querySelectorAll('.eg-color-swatch').forEach(s => s.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('selectedVariantId').value = id;
}

// â”€â”€ Quantity â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function changeQty(delta) {
  const input = document.getElementById('qtyInput');
  const max = parseInt(input.max) || 99;
  input.value = Math.min(Math.max(1, parseInt(input.value) + delta), max);
}

// â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openLensModal() {
  document.getElementById('lensModalOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeLensModal() {
  document.getElementById('lensModalOverlay').classList.remove('open');
  document.body.style.overflow = '';
}
function handleOverlayClick(e) {
  if (e.target === document.getElementById('lensModalOverlay')) closeLensModal();
}

// â”€â”€ Tab panel switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPanel(panelId, btn) {
  document.querySelectorAll('.lens-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.lens-tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(panelId).classList.add('active');
  btn.classList.add('active');
  activePanelId = panelId;
  // Reset selection when switching tabs
  resetLensState();
}

function resetLensState() {
  lensOption = ''; lensAddon = ''; lensBasePrice = 0; addonPrice = 0; readingPower = '';
  document.querySelectorAll('.lens-opt-card').forEach(c => c.classList.remove('selected'));
  document.querySelectorAll('.power-chip').forEach(c => c.classList.remove('selected'));
  updateModalTotal();
}

// â”€â”€ Card selection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectCard(card, value, price, category) {
  // Deselect all cards in the currently active panel
  const panel = card.closest('.lens-panel');
  panel.querySelectorAll('.lens-opt-card').forEach(c => c.classList.remove('selected'));
  card.classList.add('selected');

  lensOption    = value;
  lensBasePrice = price;
  lensCategory  = category;
  addonPrice    = 0;
  readingPower  = '';

  // Reset addon radios inside this card to first option
  const firstAddon = card.querySelector('.lens-addon-label');
  if (firstAddon) {
    const radio = firstAddon.querySelector('input[type="radio"]');
    if (radio) { radio.checked = true; }
    document.querySelectorAll('.lens-addon-label').forEach(l => l.classList.remove('addon-selected'));
    firstAddon.classList.add('addon-selected');
  }

  updateModalTotal();
}

// â”€â”€ Add-on selection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pickAddon(event, label, price) {
  event.stopPropagation(); // don't re-trigger card click
  const radio = label.querySelector('input[type="radio"]');
  if (radio) radio.checked = true;

  // Clear siblings
  const card = label.closest('.lens-opt-card');
  card.querySelectorAll('.lens-addon-label').forEach(l => l.classList.remove('addon-selected'));
  label.classList.add('addon-selected');

  addonPrice = price;
  lensAddon  = radio ? radio.value : '';
  updateModalTotal();
}

// â”€â”€ Reading power â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pickReadingPower(chip, power) {
  document.querySelectorAll('.power-chip').forEach(c => c.classList.remove('selected'));
  chip.classList.add('selected');
  readingPower  = power;
  lensOption    = 'reading_' + power.replace('+','plus').replace('.','_');
  lensBasePrice = 150;
  lensCategory  = 'reading';
  addonPrice    = 0;
  updateModalTotal();
}

// â”€â”€ Total display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateModalTotal() {
  const total = lensBasePrice + addonPrice;
  document.getElementById('modalTotalDisplay').textContent =
    lensOption ? total + ' QAR' : 'â€” QAR';
}

// â”€â”€ Confirm lens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function confirmLens() {
  if (!lensOption) {
    showToast('Please select a lens option', 'error');
    return;
  }

  const total = lensBasePrice + addonPrice;

  // Populate hidden fields
  document.getElementById('hiddenLensOption').value   = lensOption;
  document.getElementById('hiddenLensAddon').value    = lensAddon;
  document.getElementById('hiddenLensPrice').value    = total;
  document.getElementById('hiddenLensCategory').value = lensCategory;

  // Copy prescription from active panel
  const isSV   = activePanelId === 'panel-sv';
  const isProg = activePanelId === 'panel-prog';

  if (isSV || isProg) {
    const pre = isSV ? 'm_' : 'p_';
    document.getElementById('h_rSph').value  = document.getElementById(pre + 'rSph').value  || '';
    document.getElementById('h_rCyl').value  = document.getElementById(pre + 'rCyl').value  || '';
    document.getElementById('h_rAxis').value = document.getElementById(pre + 'rAxis').value || '';
    document.getElementById('h_rAdd').value  = document.getElementById(pre + 'rAdd').value  || '';
    document.getElementById('h_lSph').value  = document.getElementById(pre + 'lSph').value  || '';
    document.getElementById('h_lCyl').value  = document.getElementById(pre + 'lCyl').value  || '';
    document.getElementById('h_lAxis').value = document.getElementById(pre + 'lAxis').value || '';
    document.getElementById('h_lAdd').value  = document.getElementById(pre + 'lAdd').value  || '';
  }

  lensConfirmed = true;
  updateDisplayPrice(total);

  // Show confirmed badge
  const badge = document.getElementById('lensConfirmedBadge');
  badge.classList.add('show');
  const panelLabels = {
    'panel-sv': 'Single Vision',
    'panel-prog': 'Progressive',
    'panel-reading': 'Reading',
    'panel-nopow': 'No Prescription'
  };
  document.getElementById('lensConfirmedText').textContent =
    (panelLabels[activePanelId] || '') + ' Â· ' + lensOption.replace(/_/g,' ') + ' Â· ' + total + ' QAR';

  closeLensModal();
  showToast('Lens confirmed! +' + total + ' QAR added', 'success');
}

function updateDisplayPrice(lensTotal) {
  const t = BASE_PRICE + (lensTotal || 0);
  document.getElementById('displayPrice').textContent = 'QAR ' + t.toFixed(2);
}

// â”€â”€ Add to Cart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addToCart() {
  if (!lensConfirmed) {
    showToast('Please select your lenses first', 'error');
    openLensModal();
    return;
  }

  const btn = document.getElementById('addToCartBtn');
  btn.classList.add('loading');
  btn.textContent = 'Adding...';

  const form = document.getElementById('productForm');
  const formData = new FormData(form);
  formData.set('quantity', document.getElementById('qtyInput').value);
  const csrf = form.querySelector('[name=csrfmiddlewaretoken]').value;

  fetch("{% url 'cart:add_eyeglass_to_cart' %}", {
    method: 'POST',
    body: formData,
    headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRFToken': csrf }
  })
  .then(r => r.json())
  .then(data => {
    btn.classList.remove('loading');
    btn.textContent = 'Add to Cart';
    if (data.success) {
      showToast('Added to cart!', 'success');
      const cc = document.getElementById('cartCount');
      if (cc && data.cart_count) cc.textContent = data.cart_count;
    } else {
      showToast(data.message || 'Error adding to cart', 'error');
    }
  })
  .catch(() => {
    btn.classList.remove('loading');
    btn.textContent = 'Add to Cart';
    showToast('Something went wrong. Please try again.', 'error');
  });
}

// â”€â”€ Buy Now â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buyNow() {
  if (!lensConfirmed) {
    showToast('Please select your lenses first', 'error');
    openLensModal();
    return;
  }
  const form = document.getElementById('productForm');
  form.action = "{% url 'orders:checkout' %}";
  form.method = 'POST';
  form.submit();
}

// â”€â”€ Wishlist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleWishlist(btn) {
  const csrf = document.querySelector('[name=csrfmiddlewaretoken]').value;
  fetch('/users/wishlist/toggle/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrf, 'X-Requested-With': 'XMLHttpRequest' },
    body: JSON.stringify({ product_id: btn.dataset.productId })
  })
  .then(r => r.json())
  .then(data => {
    if (data.added) {
      btn.classList.add('active');
      btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="red"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z"/></svg>';
      showToast('Added to wishlist', 'success');
    } else {
      btn.classList.remove('active');
      btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z"/></svg>';
      showToast('Removed from wishlist', '');
    }
  })
  .catch(() => showToast('Login required to use wishlist', 'error'));
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let toastTimer;
function showToast(msg, type) {
  const t = document.getElementById('egToast');
  t.textContent = msg;
  t.className = 'eg-toast show' + (type ? ' ' + type : '');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3400);
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  // Fix reading power grid if Django split filter not available
  const grid = document.getElementById('readingGrid');
  if (grid && grid.querySelectorAll('.power-chip').length === 0) {
    const powers = ['+0.75','+1.00','+1.25','+1.50','+1.75','+2.00','+2.25','+2.50','+2.75','+3.00'];
    powers.forEach(p => {
      const chip = document.createElement('div');
      chip.className = 'power-chip';
      chip.textContent = p;
      chip.onclick = () => pickReadingPower(chip, p);
      grid.appendChild(chip);
    });
  }

  // First variant
  const first = document.querySelector('.eg-color-swatch');
  if (first) {
    document.getElementById('selectedVariantId').value = first.dataset.variantId || '';
  }
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeLensModal();
});
</script>

{% endblock %}