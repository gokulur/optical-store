{% extends 'base.html' %}
{% block content %}
<title>{% block title %}{{ product.name }} | {{ product.brand.name }}{% endblock %}</title>
{% load static %}

<style>
    /* CUSTOM STYLES FOR OPTICAL E-COMMERCE */
    .brand-name {
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 1px;
        color: #666;
        margin-bottom: 5px;
        display: block;
    }
    
    /* Variant/Color Swatches */
    .variant-swatch-container {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .variant-swatch {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 1px solid #ddd;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    .variant-swatch.active {
        border: 2px solid #000;
        transform: scale(1.1);
    }
    .variant-swatch img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Contact Lens Power Grid */
    .lens-power-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
    }
    .power-select label {
        display: block;
        font-size: 0.8rem;
        margin-bottom: 5px;
        font-weight: 600;
    }
    .power-select select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    /* Dual Button Layout (Magrabi/Eyewa Style) */
    .action-buttons-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 20px;
    }
    .btn-outline {
        background: transparent;
        border: 1px solid currentColor;
        color: var(--color-foreground);
    }
</style>

<main class="content-for-layout focus-none" id="xo-main-content" role="main" tabindex="-1">
    
    <section class="shopify-section section" id="shopify-section-template--breadcrumb">
        <div class="xo-section xo-section--breadcrumb color-background-1" style="--margin: 0;--pt: 15;--pb: 15;">
            <xo-animate class="xo-section-bg" xo-disabled="" xo-duration="1000">
                <xo-parallax class="xo-section-bg-image__item" xo-lerp-ease="0.4">
                    <xo-parallax-scroll class="xo-section-bg-image__url xo-background-lazyload"></xo-parallax-scroll>
                </xo-parallax>
            </xo-animate>
            <xo-animate xo-strength="5" xo-type="fade-down">
                <xo-container class="xo-container--box">
                    <nav aria-label="breadcrumb" class="breadcrumb" role="navigation">
                        <ol class="breadcrumb__list">
                            <li class="breadcrumb__item"><a class="breadcrumb__link" href="/">Home</a></li>
                            {% if product.category %}
                            <li class="breadcrumb__item">
                                <span class="breadcrumb__separator">/</span>
                                <a class="breadcrumb__link" href="{{ product.category.get_absolute_url }}">{{ product.category.name }}</a>
                            </li>
                            {% endif %}
                            <li class="breadcrumb__item breadcrumb__item--current">
                                <span class="breadcrumb__separator">/</span>
                                <span class="breadcrumb__link" aria-current="page">{{ product.name }}</span>
                            </li>
                        </ol>
                    </nav>
                </xo-container>
            </xo-animate>
        </div>
    </section>

    <section class="shopify-section section" id="shopify-section-main-product">
        <div class="xo-section xo-section--main-product color-background-1" style="z-index:99; position: relative">
            <xo-product xo-product-id="{{ product.id }}" xo-section-id="template--main-product">
                <xo-container class="xo-container--box">
                    <xo-grid>
                        <xo-animate style="--xs: 12; --md: 7" xo-cascade="">
                            <div class="xo-product-info-media-style3" style="position: sticky;">
                                <xo-gallery aria-label="Gallery Viewer" xo-portal-class="main-product__portal" xo-sync="false">
                                    <xo-carousel xo-name="product-information-desktop">
                                        <div class="xo-product-info-media-style3__top">
                                            <xo-carousel-inner>
                                                <xo-carousel-list aria-label="Slider" role="list">
                                                    {% for image in images %}
                                                    <xo-carousel-slide aria-label="{{ forloop.counter }} of {{ images.count }}" class="xo-product-info-media-style3__slide">
                                                        <xo-image-zoom xo-use-wheel="false" xo-zoom="3" xo-zoom-src="{{ image.image.url }}">
                                                            <xo-gallery-item xo-src="{{ image.image.url }}">
                                                                <div class="xo-product-info-media-style3__image">
                                                                    <div class="xo-media" style="--media-aspect-ratio: 1/1">
                                                                        <img src="{{ image.image.url }}" alt="{{ product.name }}" width="1000" loading="lazy">
                                                                    </div>
                                                                </div>
                                                            </xo-gallery-item>
                                                        </xo-image-zoom>
                                                    </xo-carousel-slide>
                                                    {% endfor %}
                                                </xo-carousel-list>
                                            </xo-carousel-inner>
                                            <xo-carousel-prev class="xo-product-info-media-style3__arrow xo-product-info-media-style3__arrow--left"><button><svg height="12" viewBox="0 0 320 512"><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" fill="currentColor"></path></svg></button></xo-carousel-prev>
                                            <xo-carousel-next class="xo-product-info-media-style3__arrow xo-product-info-media-style3__arrow--right"><button><svg height="12" viewBox="0 0 320 512"><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z" fill="currentColor"></path></svg></button></xo-carousel-next>
                                        </div>
                                        </xo-carousel>
                                </xo-gallery>
                            </div>
                        </xo-animate>

                        <xo-animate class="main-product__right" style="--xs: 12; --md: 5" xo-cascade="">
                            <div class="xo-product-info-content" style="position: sticky; top: 9.3rem">
                                <xo-collapse-provider>
                                    
                                    <xo-animate style="padding-bottom:5px" xo-cascade="">
                                        <span class="brand-name">{{ product.brand.name }}</span>
                                    </xo-animate>

                                    <xo-animate style="padding-top:0px; padding-bottom:0px" xo-cascade="">
                                        <div class="xo-product-info-content__header">
                                            <h1 class="xo-product-info-content__title" style="--fz:2.4rem">
                                                {{ product.name }}
                                            </h1>
                                            <div>
                                                <button class="wishlist-btn circle-btn" data-product-id="{{ product.id }}">
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><path d="M12 21s-6.7-4.4-10-9c-3.3-4.6.2-11 6-9 2 .6 4 2.4 4 2.4s2-1.8 4-2.4c5.8-2 9.3 4.4 6 9-3.3 4.6-10 9-10 9z" /></svg>
                                                </button>
                                            </div>
                                        </div>
                                    </xo-animate>

                                    <xo-animate style="padding-top:0px; padding-bottom:20px" xo-cascade="">
                                        <div class="xo-price xo-price--larger">
                                            <div class="xo-price__container">
                                                <div class="xo-price__sale">
                                                    <span class="xo-price__item xo-price__item--accent">QAR {{ product.price }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </xo-animate>

                                    <xo-animate style="padding-top:0px; padding-bottom:20px" xo-cascade="">
                                        <p class="xo-product-info-content__description">
                                            {{ product.description|truncatewords:20 }}
                                        </p>
                                    </xo-animate>

                                    <form method="POST" id="product_form_id_{{ product.id }}" action=" ">
                                        {% csrf_token %}
                                        <input type="hidden" name="product_id" value="{{ product.id }}">

                                        {% if product.product_type == 'contact_lenses' and colors %}
                                        <xo-animate style="padding-bottom: 20px;">
                                            <label style="font-weight:bold; margin-bottom:10px; display:block;">Select Color:</label>
                                            <div class="variant-swatch-container">
                                                {% for color in colors %}
                                                    <a href="{{ color.get_absolute_url }}" class="variant-swatch {% if color == product %}active{% endif %}" title="{{ color.color_name }}">
                                                        <img src="{{ color.image.url }}" alt="{{ color.color_name }}">
                                                    </a>
                                                {% endfor %}
                                            </div>
                                        </xo-animate>

                                        <xo-animate style="padding-bottom: 20px;">
                                            <div class="lens-power-grid">
                                                <div class="power-select">
                                                    <label>Right Eye (OD)</label>
                                                    <select name="power_od" required>
                                                        <option value="0.00">Plano (0.00)</option>
                                                        <option value="-0.50">-0.50</option>
                                                        <option value="-1.00">-1.00</option>
                                                        </select>
                                                </div>
                                                <div class="power-select">
                                                    <label>Left Eye (OS)</label>
                                                    <select name="power_os" required>
                                                        <option value="0.00">Plano (0.00)</option>
                                                        <option value="-0.50">-0.50</option>
                                                        <option value="-1.00">-1.00</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </xo-animate>
                                        {% endif %}

                                        <xo-animate style="padding-bottom: 20px;">
                                            <xo-cart-quantity class="xo-quantity-style2" style="--width: 13.5rem; --height: 5rem">
                                                <xo-cart-quantity-minus class="xo-quantity-style2__button">
                                                    <svg viewBox="0 0 10 2" width="12"><path d="M.5 1C.5.7.7.5 1 .5h8a.5.5 0 110 1H1A.5.5 0 01.5 1z" fill="currentColor"></path></svg>
                                                </xo-cart-quantity-minus>
                                                <input class="xo-quantity-style2__number xo-quantity-style2__number--half" type="number" name="quantity" value="1" min="1" max="{{ product.stock }}">
                                                <xo-cart-quantity-plus class="xo-quantity-style2__button">
                                                    <svg viewBox="0 0 10 10" width="12"><path d="M1 4.51a.5.5 0 000 1h3.5l.01 3.5a.5.5 0 001-.01V5.5l3.5-.01a.5.5 0 00-.01-1H5.5L5.49.99a.5.5 0 00-1 .01v3.5l-3.5.01H1z" fill="currentColor"></path></svg>
                                                </xo-cart-quantity-plus>
                                            </xo-cart-quantity>
                                        </xo-animate>

                                        <xo-animate style="padding-bottom:30px" xo-cascade="">
                                            
                                            {% if product.product_type == 'eyeglasses' %}
                                                <button type="submit" formaction=" " class="xo-btn xo-btn--light xo-btn--primary xo-btn--block">
                                                    <span class="xo-btn__content"><span class="xo-btn__text">Select Lenses</span></span>
                                                </button>

                                            {% elif product.product_type == 'sunglasses' %}
                                                <div class="action-buttons-grid">
                                                    <button type="button" class="xo-btn xo-btn--light xo-btn--block add-to-cart-btn btn-outline" data-url=" ">
                                                        <span class="xo-btn__content"><span class="xo-btn__text">Frame Only</span></span>
                                                    </button>
                                                    
                                                    <button type="submit" formaction=" " class="xo-btn xo-btn--light xo-btn--primary xo-btn--block">
                                                        <span class="xo-btn__content"><span class="xo-btn__text">Buy with Power</span></span>
                                                    </button>
                                                </div>

                                            {% else %}
                                                <button type="button" class="xo-btn xo-btn--light xo-btn--primary xo-btn--slide-up xo-btn--block add-to-cart-btn" data-url=" ">
                                                    <span class="xo-btn__content"><span class="xo-btn__text">Add to Cart</span></span>
                                                </button>
                                            {% endif %}

                                        </xo-animate>

                                    </form>
                                    <xo-animate style="padding-top:0px; padding-bottom:30px" xo-cascade="">
                                        <div class="shipping">
                                            <div class="shipping_item">
                                                <p>Estimate delivery times: <strong>3-6 days</strong> Qatar.</p>
                                            </div>
                                        </div>
                                    </xo-animate>

                                </xo-collapse-provider>
                            </div>
                        </xo-animate>
                    </xo-grid>
                </xo-container>
            </xo-product>
        </div>
    </section>

    <section class="shopify-section section">
        <xo-container class="xo-container--box">
             <div class="product-description-style4" style="padding: 20px 0;">
                 <h3>Description</h3>
                 {{ product.description|linebreaks }}
                 
                 {% if specifications %}
                 <h3 style="margin-top:20px;">Specifications</h3>
                 <table style="width:100%; border-collapse: collapse;">
                     {% for spec in specifications %}
                     <tr style="border-bottom: 1px solid #eee;">
                         <td style="padding: 10px; font-weight:bold;">{{ spec.name }}</td>
                         <td style="padding: 10px;">{{ spec.value }}</td>
                     </tr>
                     {% endfor %}
                 </table>
                 {% endif %}
             </div>
        </xo-container>
    </section>

</main>
{% endblock %}