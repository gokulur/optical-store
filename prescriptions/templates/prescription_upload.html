<!-- prescription_upload.html -->
{% extends 'catalog/base.html' %}

{% block title %}Upload Prescription - Eyewear Store{% endblock %}

{% block content %}
<div class="prescription-upload-page">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>Upload Your Prescription</h1>
            <p>Take a photo or upload a scan of your prescription</p>
        </div>
        
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Instructions -->
        <div class="upload-instructions">
            <h2>How to Upload:</h2>
            <div class="instructions-grid">
                <div class="instruction-item">
                    <h3>1. Prepare Your Prescription</h3>
                    <p>Make sure your prescription is clearly visible and well-lit</p>
                </div>
                <div class="instruction-item">
                    <h3>2. Take a Photo or Scan</h3>
                    <p>Use your phone camera or scanner to capture the prescription</p>
                </div>
                <div class="instruction-item">
                    <h3>3. Upload Here</h3>
                    <p>Select the file and upload - we'll enter the details for you</p>
                </div>
                <div class="instruction-item">
                    <h3>4. We'll Process It</h3>
                    <p>Our team will review and add the prescription details to your account</p>
                </div>
            </div>
        </div>
        
        <!-- Upload Form -->
        <form method="post" enctype="multipart/form-data" class="upload-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="prescription_type">Prescription Type *</label>
                <select name="prescription_type" id="prescription_type" required>
                    <option value="">-- Select Type --</option>
                    {% for value, label in prescription_types %}
                    <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group file-upload">
                <label for="prescription_file">Upload Prescription File *</label>
                <input type="file" name="prescription_file" id="prescription_file" 
                       accept="image/*,.pdf" required>
                <p class="file-info">Accepted formats: JPG, PNG, PDF (Max 5MB)</p>
                
                <div class="preview-area" id="previewArea" style="display:none;">
                    <img id="preview" src="" alt="Preview">
                </div>
            </div>
            
            <div class="form-group">
                <label for="notes">Additional Notes (Optional)</label>
                <textarea name="notes" id="notes" rows="4" 
                          placeholder="Any special instructions or information we should know..."></textarea>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Upload Prescription</button>
                <a href="{% url 'prescriptions:prescription_list' %}" class="btn btn-outline">Cancel</a>
            </div>
        </form>
        
        <!-- Alternative Option -->
        <div class="alternative-option">
            <h2>Prefer to Enter Manually?</h2>
            <p>If you'd rather enter the prescription details yourself, you can do that too.</p>
            <a href="{% url 'prescriptions:prescription_create' %}" class="btn btn-outline">
                Enter Prescription Manually
            </a>
        </div>
        
        <!-- Help Section -->
        <div class="help-section">
            <h2>Tips for Best Results:</h2>
            <ul>
                <li>Ensure good lighting - avoid shadows and glare</li>
                <li>Keep the prescription flat and straight</li>
                <li>Make sure all text is clearly readable</li>
                <li>Include the doctor's information and date if visible</li>
                <li>If you have multiple pages, upload them separately or combine into one PDF</li>
            </ul>
        </div>
    </div>
</div>

<script>
// Preview uploaded image
document.getElementById('prescription_file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const previewArea = document.getElementById('previewArea');
    const preview = document.getElementById('preview');
    
    if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            previewArea.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        previewArea.style.display = 'none';
    }
});
</script>
{% endblock %}