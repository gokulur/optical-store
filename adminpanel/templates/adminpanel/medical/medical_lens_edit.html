{% extends 'admin-dashboard.html' %}
{% load static %}
{% block content %}

<style>
  .section-title {
    font-size: 1rem;
    font-weight: 700;
    color: #3e4b5b;
    margin-bottom: 1.2rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #f2f4f6;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .card { box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075); border: none; margin-bottom: 20px; }
  .required-star { color: #dc3545; }
  .form-control:focus { border-color: #f6af2d; box-shadow: 0 0 0 0.2rem rgba(246,175,45,0.2); }
  .power-row { background: #f8f9fa; border-radius: 6px; padding: 14px; border: 1px solid #e9ecef; }
  .edit-badge {
    background: linear-gradient(135deg, #f6af2d, #f77825);
    color: white;
    font-size: 0.75rem;
    padding: 3px 10px;
    border-radius: 20px;
    margin-left: 10px;
    vertical-align: middle;
  }
</style>

<div class="main-panel">
  <div class="content-wrapper">

    <!-- Page Header -->
    <div class="page-header d-flex justify-content-between align-items-center mb-4">
      <div>
        <h3 class="mb-1">
          <i class="mdi mdi-pencil-outline"></i>
          Edit Lens Option
          <span class="edit-badge">Editing</span>
        </h3>
        <p class="text-muted mb-0">
          <strong>{{ lens_option.lens_brand.name }}</strong> —
          {{ lens_option.lens_type.name }} —
          Index {{ lens_option.index }}
        </p>
      </div>
      <a href="{% url 'adminpanel:lens_option_list' %}" class="btn btn-outline-secondary">
        <i class="mdi mdi-arrow-left"></i> Back to List
      </a>
    </div>

    <!-- Flash Messages -->
    {% if messages %}
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
      </div>
      {% endfor %}
    {% endif %}

    <form method="POST">
      {% csrf_token %}

      <div class="row">

        <!-- Left Column -->
        <div class="col-lg-8">

          <!-- Brand & Type -->
          <div class="card">
            <div class="card-body">
              <h5 class="section-title"><i class="mdi mdi-tag-outline mr-1"></i> Lens Identity</h5>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="font-weight-bold">Lens Brand <span class="required-star">*</span></label>
                    <select class="form-control" name="lens_brand" required>
                      <option value="">— Select Brand —</option>
                      {% for brand in lens_brands %}
                      <option value="{{ brand.id }}"
                        {% if lens_option.lens_brand.id == brand.id %}selected{% endif %}>
                        {{ brand.name }}
                      </option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="font-weight-bold">Lens Type <span class="required-star">*</span></label>
                    <select class="form-control" name="lens_type" required>
                      <option value="">— Select Type —</option>
                      {% for lt in lens_types %}
                      <option value="{{ lt.id }}"
                        {% if lens_option.lens_type.id == lt.id %}selected{% endif %}>
                        {{ lt.name }}
                      </option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="font-weight-bold">Lens Index <span class="required-star">*</span></label>
                    <select class="form-control" name="index" required>
                      <option value="">— Select Index —</option>
                      {% for idx_val, idx_label in index_choices %}
                      <option value="{{ idx_val }}"
                        {% if lens_option.index == idx_val %}selected{% endif %}>
                        {{ idx_label }}
                      </option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="form-group">
                    <label class="font-weight-bold">Base Price (QAR) <span class="required-star">*</span></label>
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">QAR</span>
                      </div>
                      <input type="number" class="form-control" name="base_price"
                             step="0.01" min="0"
                             value="{{ lens_option.base_price }}" required>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- Power Range -->
          <div class="card">
            <div class="card-body">
              <h5 class="section-title"><i class="mdi mdi-eye-outline mr-1"></i> Prescription Power Range</h5>

              <div class="power-row">
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group mb-0">
                      <label class="font-weight-bold">Minimum Power <span class="required-star">*</span></label>
                      <div class="input-group">
                        <input type="number" class="form-control" name="min_power"
                               step="0.25" value="{{ lens_option.min_power }}" required>
                        <div class="input-group-append">
                          <span class="input-group-text">D</span>
                        </div>
                      </div>
                      <small class="text-muted">Negative value e.g. -6.00</small>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group mb-0">
                      <label class="font-weight-bold">Maximum Power <span class="required-star">*</span></label>
                      <div class="input-group">
                        <input type="number" class="form-control" name="max_power"
                               step="0.25" value="{{ lens_option.max_power }}" required>
                        <div class="input-group-append">
                          <span class="input-group-text">D</span>
                        </div>
                      </div>
                      <small class="text-muted">Positive value e.g. +4.00</small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Current Range Display -->
              <div class="d-flex align-items-center justify-content-center mt-3 py-2 border rounded bg-light">
                <span class="text-muted small mr-2">Current Range:</span>
                <span class="badge badge-danger mr-2">{{ lens_option.min_power }} D</span>
                <i class="mdi mdi-arrow-right text-muted"></i>
                <span class="badge badge-success ml-2">{{ lens_option.max_power }} D</span>
              </div>

            </div>
          </div>

        </div>

        <!-- Right Column -->
        <div class="col-lg-4">

          <div class="card">
            <div class="card-body">
              <h5 class="section-title"><i class="mdi mdi-cogs mr-1"></i> Settings</h5>

              <div class="form-group">
                <div class="form-check">
                  <label class="form-check-label font-weight-bold">
                    <input type="checkbox" class="form-check-input" name="is_active"
                      {% if lens_option.is_active %}checked{% endif %}>
                    Active
                  </label>
                  <small class="d-block text-muted mt-1">Inactive options won't appear at checkout</small>
                </div>
              </div>

              <hr>

              <div class="mt-3">
                <button type="submit" class="btn btn-gradient-warning btn-block btn-lg">
                  <i class="mdi mdi-content-save mr-1"></i> Update Lens Option
                </button>
                <a href="{% url 'adminpanel:lens_option_list' %}" class="btn btn-light btn-block mt-2">
                  Cancel
                </a>
              </div>
            </div>
          </div>

          <!-- Current Summary Card -->
          <div class="card bg-light">
            <div class="card-body">
              <h6 class="font-weight-bold mb-3">
                <i class="mdi mdi-information-outline text-info"></i> Current Option Summary
              </h6>
              <table class="table table-sm table-borderless mb-0 small">
                <tbody>
                  <tr>
                    <td class="text-muted pl-0">Brand:</td>
                    <td class="font-weight-bold">{{ lens_option.lens_brand.name }}</td>
                  </tr>
                  <tr>
                    <td class="text-muted pl-0">Type:</td>
                    <td class="font-weight-bold">{{ lens_option.lens_type.name }}</td>
                  </tr>
                  <tr>
                    <td class="text-muted pl-0">Index:</td>
                    <td><span class="badge badge-info">{{ lens_option.index }}</span></td>
                  </tr>
                  <tr>
                    <td class="text-muted pl-0">Power:</td>
                    <td class="small">{{ lens_option.min_power }} → {{ lens_option.max_power }} D</td>
                  </tr>
                  <tr>
                    <td class="text-muted pl-0">Price:</td>
                    <td class="font-weight-bold text-success">QAR {{ lens_option.base_price }}</td>
                  </tr>
                  <tr>
                    <td class="text-muted pl-0">Status:</td>
                    <td>
                      {% if lens_option.is_active %}
                        <span class="badge badge-success">Active</span>
                      {% else %}
                        <span class="badge badge-secondary">Inactive</span>
                      {% endif %}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Danger Zone -->
          <div class="card border-danger">
            <div class="card-body">
              <h6 class="font-weight-bold text-danger mb-2">
                <i class="mdi mdi-alert-outline"></i> Danger Zone
              </h6>
              <p class="small text-muted mb-2">
                Deleting this option will remove it permanently and may affect existing orders.
              </p>
              <a href="{% url 'adminpanel:lens_option_delete' lens_option.id %}"
                 class="btn btn-outline-danger btn-sm btn-block"
                 onclick="return confirm('Are you sure you want to delete this lens option? This cannot be undone.')">
                <i class="mdi mdi-delete-outline"></i> Delete This Lens Option
              </a>
            </div>
          </div>

        </div>
      </div>

    </form>

  </div>
</div>

{% endblock %}