{% extends 'admin-dashboard.html' %}
{% load static %}
{% block content %}
<style>
  .page-header{background:linear-gradient(135deg,#11998e,#38ef7d);color:white;padding:20px;border-radius:8px;margin-bottom:30px}
  .log-card{background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden;margin-bottom:20px}
  .log-header{background:#1a1a1a;padding:18px 24px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .log-body-content{background:#f8f9fc;border-radius:8px;padding:18px;font-size:.88rem;line-height:1.8;color:#444;white-space:pre-wrap;font-family:monospace;border:1px solid #e8ecf0}
  .info-grid{display:grid;grid-template-columns:1fr 1fr;border-top:1px solid #f5f5f5}
  .info-item{padding:12px 22px;border-bottom:1px solid #f5f5f5;display:flex;flex-direction:column;gap:3px}
  .info-item:nth-child(odd){border-right:1px solid #f5f5f5}
  .info-label{font-size:.68rem;color:#bbb;text-transform:uppercase;letter-spacing:.08em;font-weight:700}
  .info-value{font-size:.84rem;color:#1a1a1a;font-weight:600}
  .ch-pill{display:inline-flex;align-items:center;gap:5px;border-radius:20px;padding:5px 13px;font-size:.72rem;font-weight:700;text-transform:uppercase}
  .ch-email{background:rgba(102,126,234,.25);color:#a5b4fc}
  .ch-sms  {background:rgba(27,207,180,.2);color:#6ee7d0}
  .ns-sent   {background:#e6faf7;color:#0f8c6f}
  .ns-pending{background:#fff8e8;color:#b45309}
  .ns-failed {background:#fff0ef;color:#c0392b}
  .n-status{display:inline-flex;align-items:center;gap:3px;border-radius:20px;padding:4px 11px;font-size:.7rem;font-weight:700}
  .error-box{margin:16px 22px;background:#fff0ef;border-radius:8px;padding:12px 16px;font-size:.82rem;color:#c0392b}
</style>

<div class="main-panel">
  <div class="content-wrapper">

    <div class="page-header d-flex justify-content-between align-items-center">
      <div>
        <h3 class="mb-1"><i class="mdi mdi-email-search-outline"></i> Notification Detail</h3>
        <p class="mb-0 opacity-75">#{{ log.id }} · {{ log.created_at|date:"d M Y, H:i" }}</p>
      </div>
      <a href="{% url 'adminpanel:notification_log_list' %}" class="btn btn-white text-success">
        <i class="mdi mdi-arrow-left"></i> Back to Logs
      </a>
    </div>

    <!-- Related object -->
    {% if log.related_object_type %}
    <div class="alert alert-info d-flex align-items-center justify-content-between flex-wrap mb-4" style="gap:10px;">
      <span><strong>Related:</strong> {{ log.related_object_type|title }} #{{ log.related_object_id }}</span>
      {% if log.related_object_type == 'order' %}
        <a href="{% url 'adminpanel:order_detail' log.related_object_id %}" class="btn btn-sm btn-info text-white">View Order →</a>
      {% elif log.related_object_type == 'booking' %}
        <a href="{% url 'adminpanel:eye_test_detail' log.related_object_id %}" class="btn btn-sm btn-info text-white">View Booking →</a>
      {% endif %}
    </div>
    {% endif %}

    <div class="log-card">

      <!-- Header -->
      <div class="log-header">
        <span class="ch-pill ch-{{ log.channel }}">
          {% if log.channel == 'email' %}
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 8l10 6 10-6"/></svg>
          {% elif log.channel == 'sms' %}
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
          {% else %}
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
          {% endif %}
          {{ log.get_channel_display }}
        </span>
        <div class="d-flex align-items-center gap-3 flex-wrap" style="gap:10px;">
          <small style="color:rgba(255,255,255,.45);">{{ log.created_at|date:"d M Y, H:i" }}</small>
          <span class="n-status ns-{{ log.status }}">
            {% if log.status == 'sent' %}<svg width="7" height="7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>{% endif %}
            {{ log.get_status_display }}
          </span>
        </div>
      </div>

      <!-- Subject -->
      {% if log.subject %}
      <div class="px-4 pt-4">
        <h4 class="font-weight-bold" style="font-size:1.1rem;">{{ log.subject }}</h4>
      </div>
      {% endif %}

      <!-- Body -->
      <div class="px-4 py-3">
        <label class="text-muted font-weight-bold" style="font-size:.73rem;text-transform:uppercase;letter-spacing:.06em;">Message Body</label>
        <div class="log-body-content mt-2">{{ log.body }}</div>
      </div>

      <!-- Error -->
      {% if log.error_message %}
      <div class="error-box">
        <div class="font-weight-bold mb-1" style="font-size:.73rem;text-transform:uppercase;">Error Details</div>
        {{ log.error_message }}
      </div>
      {% endif %}

      <!-- Info Grid -->
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Recipient</span>
          <span class="info-value">{{ log.recipient }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">User</span>
          <span class="info-value">{{ log.user.get_full_name|default:log.user.email }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Channel</span>
          <span class="info-value">{{ log.get_channel_display }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Template</span>
          <span class="info-value">{{ log.template.name|default:"—" }}</span>
        </div>
        {% if log.sent_at %}
        <div class="info-item">
          <span class="info-label">Sent At</span>
          <span class="info-value">{{ log.sent_at|date:"d M Y, H:i" }}</span>
        </div>
        {% endif %}
        <div class="info-item">
          <span class="info-label">Status</span>
          <span class="info-value">{{ log.get_status_display }}</span>
        </div>
      </div>
    </div>

    <a href="{% url 'adminpanel:notification_log_list' %}" class="btn btn-light">
      <i class="mdi mdi-arrow-left"></i> Back to Logs
    </a>

  </div>
</div>
{% endblock %}