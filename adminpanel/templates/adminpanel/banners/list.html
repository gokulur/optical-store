{% extends 'admin-dashboard.html' %}
{% load static %}
{% block content %}
<style>
  .form-control:focus { border-color: #b66dff; box-shadow: 0 0 0 0.2rem rgba(182,109,255,0.25); }
  .card { box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075); }
  .btn-gradient-primary { background: linear-gradient(to right, #da8cff, #9a55ff); border: 0; color: white; }
  .btn-gradient-primary:hover { background: linear-gradient(to right, #9a55ff, #da8cff); color: white; }
  .page-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
  .custom-file-label::after { content: "Browse"; }
  .section-card { border-radius: 10px; padding: 20px; margin-bottom: 20px; }
  .section-card.blue   { background: #e8f0fe; border: 1px solid #c5d5fb; }
  .section-card.green  { background: #e8f5e9; border: 1px solid #a5d6a7; }
  .section-card.orange { background: #fff3e0; border: 1px solid #ffcc80; }
  .section-card.grey   { background: #f5f5f5; border: 1px solid #e0e0e0; }
  .section-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 14px; }
  .image-drop-zone { border: 2px dashed #c5d5fb; border-radius: 10px; padding: 20px; background: #f8fbff; min-height: 110px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; cursor: pointer; transition: border-color 0.2s; }
  .image-drop-zone:hover { border-color: #9a55ff; }
  .image-drop-zone img { max-width: 100%; max-height: 160px; border-radius: 8px; display: none; margin-bottom: 8px; }
  .slide-preview-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 30px 25px; color: #fff; min-height: 180px; position: relative; overflow: hidden; transition: all 0.3s; }
  .slide-preview-box .preview-title { font-size: 1.6rem; font-weight: 600; margin-bottom: 8px; text-shadow: 1px 1px 4px rgba(0,0,0,0.3); }
  .slide-preview-box .preview-desc { font-size: 0.85rem; opacity: 0.9; margin-bottom: 16px; }
  .slide-preview-box .preview-btn { display: inline-block; background: rgba(255,255,255,0.2); border: 1.5px solid rgba(255,255,255,0.7); border-radius: 8px; padding: 7px 18px; font-size: 0.8rem; font-weight: 600; color: #fff; }
  .slide-preview-box .preview-label { position: absolute; top: 12px; right: 12px; background: rgba(255,255,255,0.2); border-radius: 6px; padding: 3px 10px; font-size: 11px; font-weight: 600; }
  .gradient-presets { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
  .gradient-chip { width: 36px; height: 36px; border-radius: 8px; cursor: pointer; border: 3px solid transparent; transition: all 0.2s; }
  .gradient-chip:hover, .gradient-chip.active { border-color: #333; transform: scale(1.1); }
</style>

<div class="main-panel">
  <div class="content-wrapper">

    <div class="page-header">
      <h3 class="mb-2"><i class="mdi mdi-plus-circle"></i> Add Hero Carousel Slide</h3>
      <p class="mb-0">Each form submission = one new slide in the homepage <code>xo-carousel</code></p>
    </div>

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb bg-transparent p-0 mb-4">
        <li class="breadcrumb-item"><a href="{% url 'adminpanel:dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'adminpanel:banner_list' %}">Hero Banners</a></li>
        <li class="breadcrumb-item active">Add Slide</li>
      </ol>
    </nav>

    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
      {{ message }}
      <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
    </div>
    {% endfor %}
    {% endif %}

    <form method="POST" enctype="multipart/form-data" id="bannerForm">
      {% csrf_token %}
      <div class="row">

        <!-- ── LEFT COLUMN ── -->
        <div class="col-md-7">
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-4"><i class="mdi mdi-text"></i> Slide Content</h5>

              <!-- Internal name -->
              <div class="form-group">
                <label class="font-weight-bold">Internal Title (Admin Only) <span class="text-danger">*</span></label>
                <input type="text" class="form-control form-control-lg" name="title" id="title" placeholder="e.g. Slide 1 – Vision Matters" required>
                <small class="text-muted">Not shown on site — for your reference only</small>
              </div>

              <!-- Slide heading (shown on site) -->
              <div class="section-card blue">
                <p class="section-label text-primary"><i class="mdi mdi-format-title"></i> Slide Text (shown on homepage)</p>
                <div class="form-group mb-3">
                  <label class="font-weight-bold">Heading <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" name="slide_heading" id="slide_heading"
                         placeholder="e.g. Your Vision Matters More"
                         oninput="updatePreview()">
                  <small class="text-muted">Maps to <code>slideshow-v56__title</code> in your template</small>
                </div>
                <div class="form-group mb-3">
                  <label class="font-weight-bold">Description</label>
                  <textarea class="form-control" name="slide_description" id="slide_description" rows="3"
                            placeholder="e.g. Discover advanced eye care at Al Ameen Optics..."
                            oninput="updatePreview()"></textarea>
                  <small class="text-muted">Maps to <code>slideshow-v56__description</code></small>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group mb-0">
                      <label class="font-weight-bold">CTA Button Text</label>
                      <input type="text" class="form-control" name="cta_text" id="cta_text"
                             placeholder="e.g. Read More / Shop Now"
                             oninput="updatePreview()">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group mb-0">
                      <label class="font-weight-bold">CTA Button URL</label>
                      <input type="text" class="form-control" name="link_url" id="link_url"
                             placeholder="/about/ or /catalog/">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Link type (hidden, used by view) -->
              <div class="form-group mt-3">
                <label class="font-weight-bold">Link Type</label>
                <select class="form-control" name="link_type">
                  <option value="">-- None --</option>
                  {% for value, label in link_type_choices %}
                  <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>

              <!-- Banner type & placement -->
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="font-weight-bold">Banner Type <span class="text-danger">*</span></label>
                    <select class="form-control" name="banner_type" required>
                      <option value="">-- Select --</option>
                      {% for value, label in banner_types %}
                      <option value="{{ value }}" {% if value == 'homepage' %}selected{% endif %}>{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="font-weight-bold">Placement <span class="text-danger">*</span></label>
                    <select class="form-control" name="placement" required>
                      <option value="">-- Select --</option>
                      {% for value, label in placement_choices %}
                      <option value="{{ value }}" {% if value == 'main_slider' %}selected{% endif %}>{{ label }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- Schedule & Settings -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-4"><i class="mdi mdi-cog"></i> Settings & Schedule</h5>

              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="font-weight-bold">Display Order</label>
                    <input type="number" class="form-control" name="display_order" value="0" min="0">
                    <small class="text-muted">0 = first slide</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="font-weight-bold">Slide Duration (sec)</label>
                    <input type="number" class="form-control" name="slide_duration" id="slide_duration_input" value="5" min="1" max="30">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="font-weight-bold d-block">Options</label>
                    <div class="form-check mt-2">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="is_active" checked>
                        <span>Active (Live)</span>
                        <i class="input-helper"></i>
                      </label>
                    </div>
                    <div class="form-check mt-1">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="auto_slide" checked>
                        <span>Auto-slide</span>
                        <i class="input-helper"></i>
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section-card orange">
                <p class="section-label" style="color:#e65100;"><i class="mdi mdi-calendar-clock"></i> Schedule (optional)</p>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group mb-0">
                      <label class="font-weight-bold small">Start Date & Time</label>
                      <input type="datetime-local" class="form-control" name="start_date">
                      <small class="text-muted">Leave blank = show immediately</small>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group mb-0">
                      <label class="font-weight-bold small">End Date & Time</label>
                      <input type="datetime-local" class="form-control" name="end_date">
                      <small class="text-muted">Leave blank = no expiry</small>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- ── RIGHT COLUMN ── -->
        <div class="col-md-5">

          <!-- Live Preview -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3"><i class="mdi mdi-eye"></i> Live Preview</h5>
              <div class="slide-preview-box" id="slidePreviewBox">
                <span class="preview-label" id="previewLabel">Slide preview</span>
                <div class="preview-title" id="previewTitle">Your slide heading</div>
                <div class="preview-desc" id="previewDesc">Slide description will appear here...</div>
                <span class="preview-btn" id="previewBtn">Read More</span>
              </div>
              <p class="text-muted mt-2 mb-1" style="font-size:12px;">Background gradient fallback:</p>
              <div class="gradient-presets">
                <div class="gradient-chip active" style="background:linear-gradient(135deg,#667eea,#764ba2);" data-gradient="linear-gradient(135deg,#667eea 0%,#764ba2 100%)" title="Purple"></div>
                <div class="gradient-chip" style="background:linear-gradient(135deg,#f093fb,#f5576c);" data-gradient="linear-gradient(135deg,#f093fb 0%,#f5576c 100%)" title="Pink"></div>
                <div class="gradient-chip" style="background:linear-gradient(135deg,#4facfe,#00f2fe);" data-gradient="linear-gradient(135deg,#4facfe 0%,#00f2fe 100%)" title="Blue"></div>
                <div class="gradient-chip" style="background:linear-gradient(135deg,#43e97b,#38f9d7);" data-gradient="linear-gradient(135deg,#43e97b 0%,#38f9d7 100%)" title="Green"></div>
                <div class="gradient-chip" style="background:linear-gradient(135deg,#fa709a,#fee140);" data-gradient="linear-gradient(135deg,#fa709a 0%,#fee140 100%)" title="Sunset"></div>
                <div class="gradient-chip" style="background:linear-gradient(135deg,#2c3e50,#34495e);" data-gradient="linear-gradient(135deg,#2c3e50 0%,#34495e 100%)" title="Dark"></div>
              </div>
            </div>
          </div>

          <!-- Images -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3"><i class="mdi mdi-image"></i> Slide Images</h5>

              <!-- Desktop -->
              <div class="form-group">
                <label class="font-weight-bold">Desktop Image <span class="text-danger">*</span></label>
                <div class="image-drop-zone" id="desktopDropZone" onclick="document.getElementById('image_desktop').click()">
                  <img id="desktopPreview" alt="">
                  <i class="mdi mdi-monitor-screenshot" style="font-size:36px;color:#ccc;" id="desktopIcon"></i>
                  <p class="text-muted mb-0 mt-1" id="desktopHint">Click to upload desktop image</p>
                  <small class="text-muted">Recommended: <strong>1920×700px</strong> · Used in <code>slideshow-bg</code></small>
                </div>
                <input type="file" id="image_desktop" name="image_desktop" accept="image/*" style="display:none"
                       onchange="previewImg(event,'desktopPreview','desktopIcon','desktopHint')" required>
              </div>

              <!-- Mobile -->
              <div class="form-group">
                <label class="font-weight-bold">Mobile Image <small class="text-muted">(optional)</small></label>
                <div class="image-drop-zone" style="min-height:80px;" onclick="document.getElementById('image_mobile').click()">
                  <img id="mobilePreview" alt="" style="max-height:80px;">
                  <i class="mdi mdi-cellphone" style="font-size:26px;color:#ccc;" id="mobileIcon"></i>
                  <small class="text-muted" id="mobileHint">768×500px · maps to <code>--img-mobile</code></small>
                </div>
                <input type="file" id="image_mobile" name="image_mobile" accept="image/*" style="display:none"
                       onchange="previewImg(event,'mobilePreview','mobileIcon','mobileHint')">
              </div>

            </div>
          </div>

        </div>
      </div>

      <!-- Submit -->
      <div class="row">
        <div class="col-12">
          <hr>
          <button type="submit" class="btn btn-gradient-primary btn-lg mr-2">
            <i class="mdi mdi-check"></i> Save Slide
          </button>
          <a href="{% url 'adminpanel:banner_list' %}" class="btn btn-light btn-lg">
            <i class="mdi mdi-close"></i> Cancel
          </a>
        </div>
      </div>
    </form>

  </div>
</div>

<script>
  // ── Live preview ──
  function updatePreview() {
    const heading = document.getElementById('slide_heading').value || 'Your slide heading';
    const desc    = document.getElementById('slide_description').value || 'Slide description will appear here...';
    const btn     = document.getElementById('cta_text').value || 'Read More';
    const label   = document.getElementById('title').value || 'Slide preview';
    document.getElementById('previewTitle').textContent = heading;
    document.getElementById('previewDesc').textContent  = desc;
    document.getElementById('previewBtn').textContent   = btn;
    document.getElementById('previewLabel').textContent = label;
  }
  document.getElementById('title').addEventListener('input', updatePreview);

  // ── Gradient presets ──
  document.querySelectorAll('.gradient-chip').forEach(chip => {
    chip.addEventListener('click', function() {
      document.querySelectorAll('.gradient-chip').forEach(c => c.classList.remove('active'));
      this.classList.add('active');
      document.getElementById('slidePreviewBox').style.background = this.dataset.gradient;
    });
  });

  // ── Image preview ──
  function previewImg(event, previewId, iconId, hintId) {
    const file = event.target.files[0];
    if (!file) return;
    const preview = document.getElementById(previewId);
    const reader  = new FileReader();
    reader.onload = e => {
      preview.src = e.target.result;
      preview.style.display = 'block';
      document.getElementById(iconId).style.display = 'none';
      document.getElementById(hintId).textContent = file.name;
    };
    reader.readAsDataURL(file);
  }

  // ── Form validation ──
  document.getElementById('bannerForm').addEventListener('submit', function(e) {
    const title     = document.getElementById('title').value.trim();
    const desktop   = document.getElementById('image_desktop').files.length;
    const bannerType = document.querySelector('[name="banner_type"]').value;
    const placement  = document.querySelector('[name="placement"]').value;
    if (!title || !desktop || !bannerType || !placement) {
      e.preventDefault();
      alert('Please fill: Internal Title, Banner Type, Placement, and upload a Desktop Image.');
    }
  });
</script>
{% endblock %}