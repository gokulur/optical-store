{% extends 'admin-dashboard.html' %}
{% load static %}
{% block content %}

<style>
  .page-header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
</style>

<div class="main-panel">
  <div class="content-wrapper">

    <div class="page-header">
      <div class="d-flex justify-content-between align-items-center w-100">
        <div>
          <h3 class="mb-1"><i class="mdi mdi-bag-personal"></i> Accessories</h3>
          <p class="mb-0 opacity-75">Cases, cords, cleaning kits, pouches &amp; more</p>
        </div>
        <a href="{% url 'adminpanel:accessories_add' %}" class="btn btn-white text-info font-weight-bold">
          <i class="mdi mdi-plus"></i> Add Accessory
        </a>
      </div>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
          {{ message }}<button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
        </div>
      {% endfor %}
    {% endif %}

    <!-- Stats -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card text-center p-3" style="border-left:4px solid #4facfe;">
          <h4 class="font-weight-bold mb-0">{{ total_count }}</h4>
          <small class="text-muted">Total Accessories</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-center p-3" style="border-left:4px solid #ffc107;">
          <h4 class="font-weight-bold mb-0 text-warning">{{ low_stock_count }}</h4>
          <small class="text-muted">Low Stock</small>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-center p-3" style="border-left:4px solid #dc3545;">
          <h4 class="font-weight-bold mb-0 text-danger">{{ out_of_stock_count }}</h4>
          <small class="text-muted">Out of Stock</small>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
      <div class="card-body py-3">
        <form method="GET" class="form-inline flex-wrap" style="gap:10px;">
          <input type="text" name="search" class="form-control" placeholder="Search name or SKU..." value="{{ search }}">
          <select name="brand" class="form-control">
            <option value="">All Brands</option>
            {% for b in brands %}
              <option value="{{ b.id }}" {% if current_brand == b.id|stringformat:"s" %}selected{% endif %}>{{ b.name }}</option>
            {% endfor %}
          </select>
          <select name="stock_status" class="form-control">
            <option value="">All Stock</option>
            <option value="in_stock" {% if stock_status == 'in_stock' %}selected{% endif %}>In Stock</option>
            <option value="low_stock" {% if stock_status == 'low_stock' %}selected{% endif %}>Low Stock</option>
            <option value="out_of_stock" {% if stock_status == 'out_of_stock' %}selected{% endif %}>Out of Stock</option>
          </select>
          <button type="submit" class="btn btn-gradient-primary">Filter</button>
          <a href="{% url 'adminpanel:accessories_list' %}" class="btn btn-light">Reset</a>
        </form>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Product</th>
                <th>SKU</th>
                <th>Brand</th>
                <th>Price (QAR)</th>
                <th>Stock</th>
                <th>Status</th>
                <th class="text-right">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for product in products %}
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    {% with product.images.first as img %}
                      {% if img %}
                        <img src="{{ img.image.url }}" alt="" style="width:42px;height:42px;object-fit:cover;border-radius:6px;" class="mr-2">
                      {% else %}
                        <div class="mr-2" style="width:42px;height:42px;background:#d0f0ff;border-radius:6px;display:flex;align-items:center;justify-content:center;">
                          <i class="mdi mdi-bag-personal text-info"></i>
                        </div>
                      {% endif %}
                    {% endwith %}
                    <div>
                      <span class="font-weight-bold">{{ product.name }}</span>
                      {% if product.is_featured %}<span class="badge badge-warning ml-1" style="font-size:10px;">Featured</span>{% endif %}
                    </div>
                  </div>
                </td>
                <td><code>{{ product.sku }}</code></td>
                <td>{{ product.brand.name|default:"â€”" }}</td>
                <td class="font-weight-bold">{{ product.base_price }}</td>
                <td>
                  {% if product.stock_quantity == 0 %}
                    <span class="badge badge-danger">Out of Stock</span>
                  {% elif product.stock_quantity <= 5 %}
                    <span class="badge badge-warning">Low: {{ product.stock_quantity }}</span>
                  {% else %}
                    <span class="badge badge-success">{{ product.stock_quantity }}</span>
                  {% endif %}
                </td>
                <td>
                  {% if product.is_active %}
                    <span class="badge badge-success">Active</span>
                  {% else %}
                    <span class="badge badge-secondary">Inactive</span>
                  {% endif %}
                </td>
                <td class="text-right">
                  <a href="{% url 'adminpanel:accessories_edit' product.id %}" class="btn btn-inverse-warning btn-sm btn-icon" title="Edit"><i class="mdi mdi-pencil"></i></a>
                  <a href="{% url 'adminpanel:accessories_delete' product.id %}" class="btn btn-inverse-danger btn-sm btn-icon" title="Delete"><i class="mdi mdi-delete"></i></a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="text-center py-5">
                  <i class="mdi mdi-bag-personal text-muted" style="font-size:3rem;"></i>
                  <p class="mt-2 text-muted">No accessories found.</p>
                  <a href="{% url 'adminpanel:accessories_add' %}" class="btn btn-gradient-primary btn-sm">Add First Accessory</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        {% if products.has_other_pages %}
        <nav class="mt-3">
          <ul class="pagination justify-content-center">
            {% if products.has_previous %}<li class="page-item"><a class="page-link" href="?page={{ products.previous_page_number }}&search={{ search }}">Prev</a></li>{% endif %}
            {% for n in products.paginator.page_range %}
              <li class="page-item {% if n == products.number %}active{% endif %}"><a class="page-link" href="?page={{ n }}&search={{ search }}">{{ n }}</a></li>
            {% endfor %}
            {% if products.has_next %}<li class="page-item"><a class="page-link" href="?page={{ products.next_page_number }}&search={{ search }}">Next</a></li>{% endif %}
          </ul>
        </nav>
        {% endif %}
      </div>
    </div>

  </div>
</div>
{% endblock %}