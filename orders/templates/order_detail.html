{% extends 'catalog/base.html' %}
{% block title %}Order #{{ order.order_number }}{% endblock %}
{% block content %}
<div class="order-detail-page">
    <div class="container">
        <h1>Order #{{ order.order_number }}</h1>
        <div class="order-status-bar"><span class="status-badge status-{{ order.status }}">{{ order.get_status_display
                }}</span><span class="order-date">Placed on {{ order.created_at|date:"F j, Y" }}</span></div>
        <div class="order-grid">
            <div class="order-main">
                <section class="order-section">
                    <h2>Order Items</h2>{% for item in order_items %}<div class="order-item"><img
                            src="{{ item.product.images.first.image.url }}" alt="{{ item.product_name }}">
                        <div class="item-details">
                            <h3>{{ item.product_name }}</h3>{% if item.variant_details %}<p>{{
                                item.variant_details.color }}</p>{% endif %}<p>Qty: {{ item.quantity }} Ã— {{
                                item.unit_price }} QAR</p>{% if item.lens_option_name %}<p>Lens: {{
                                item.lens_option_name }}</p>{% endif %}
                        </div><span class="item-total">{{ item.subtotal }} QAR</span>
                    </div>{% endfor %}
                </section>
                <section class="order-section">
                    <h2>Shipping Address</h2>
                    <p>{{ order.customer_name }}</p>
                    <p>{{ order.shipping_address_line1 }}</p>
                    <p>{{ order.shipping_city }}, {{ order.shipping_country }}</p>
                    <p>{{ order.customer_phone }}</p>
                </section>
            </div>
            <div class="order-sidebar">
                <div class="summary-card">
                    <h3>Order Summary</h3>
                    <div class="summary-row"><span>Subtotal:</span><span>{{ order.subtotal }} QAR</span></div>
                    <div class="summary-row"><span>Shipping:</span><span>{{ order.shipping_amount }} QAR</span></div>
                    <div class="summary-row"><span>Tax:</span><span>{{ order.tax_amount }} QAR</span></div>
                    <div class="summary-row total"><strong>Total:</strong><strong>{{ order.total_amount }} QAR</strong>
                    </div>
                </div>
                <div class="actions-card">{% if order.status in 'pending,confirmed' %}<form method="post"
                        action="{% url 'orders:cancel_order' order.order_number %}"
                        onsubmit="return confirm('Cancel this order?');">{% csrf_token %}<button type="submit"
                            class="btn btn-danger btn-block">Cancel Order</button></form>{% endif %}<a
                        href="{% url 'orders:track_order' order.order_number %}" class="btn btn-outline btn-block">Track
                        Order</a><a href="{% url 'orders:reorder' order.order_number %}"
                        class="btn btn-outline btn-block">Reorder</a></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}